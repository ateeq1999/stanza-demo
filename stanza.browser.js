window.XMPP=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=21)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));function i(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}c((i=i.apply(e,t||[])).next())}))}},function(e,t,n){"use strict";var i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},i.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},i.getDescription=function(e){var t=i.splitSections(e);return t&&t[0]},i.getMediaSections=function(e){var t=i.splitSections(e);return t.shift(),t},i.matchPrefix=function(e,t){return i.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},i.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:n[t[i]]=t[i+1]}return n},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},i.parseIceOptions=function(e){return e.substr(14).split(" ")},i.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},i.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t,n={},i=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(t=i[r].trim().split("="))[0].trim()]=t[1];return n},i.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},i.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},i.getMid=function(e){var t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},i.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},i.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:i.matchPrefix(e+t,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},i.getIceParameters=function(e,t){var n=i.splitLines(e);return{usernameFragment:(n=n.concat(i.splitLines(t))).filter((function(e){return 0===e.indexOf("a=ice-ufrag:")}))[0].substr(12),password:n.filter((function(e){return 0===e.indexOf("a=ice-pwd:")}))[0].substr(10)}},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=i.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var s=n[r],a=i.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(a){var o=i.parseRtpMap(a),c=i.matchPrefix(e,"a=fmtp:"+s+" ");switch(o.parameters=c.length?i.parseFmtp(c[0]):{},o.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(i.parseRtcpFb),t.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(o.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(i.parseExtmap(e))})),t},i.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=i.writeRtpMap(e),n+=i.writeFmtp(e),n+=i.writeRtcpFb(e)}));var r=0;return t.codecs.forEach((function(e){e.maxptime>r&&(r=e.maxptime)})),r>0&&(n+="a=maxptime:"+r+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=i.writeExtmap(e)})),n},i.parseRtpEncodingParameters=function(e){var t,n=[],r=i.parseRtpParameters(e),s=-1!==r.fecMechanisms.indexOf("RED"),a=-1!==r.fecMechanisms.indexOf("ULPFEC"),o=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=o.length>0&&o[0].ssrc,l=i.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));l.length>0&&l[0].length>1&&l[0][0]===c&&(t=l[0][1]),r.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(i.rtx={ssrc:t}),n.push(i),s&&((i=JSON.parse(JSON.stringify(i))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},n.push(i))}})),0===n.length&&c&&n.push({ssrc:c});var u=i.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=u}))),n},i.parseRtcpParameters=function(e){var t={},n=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var r=i.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=0===r.length;var s=i.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t},i.parseMsid=function(e){var t,n=i.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var r=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return r.length>0?{stream:(t=r[0].value.split(" "))[0],track:t[1]}:void 0},i.parseSctpDescription=function(e){var t,n=i.parseMLine(e),r=i.matchPrefix(e,"a=max-message-size:");r.length>0&&(t=parseInt(r[0].substr(19),10)),isNaN(t)&&(t=65536);var s=i.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(i.matchPrefix(e,"a=sctpmap:").length>0){var a=i.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},i.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(e,t,n){var r=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||i.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,n,r){var s=i.writeRtpDescription(e.kind,t);if(s+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),s+="a=mid:"+e.mid+"\r\n",e.direction?s+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var a="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";s+="a="+a,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),s},i.getDirection=function(e,t){for(var n=i.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){return i.splitLines(e)[0].split(" ")[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},i.parseMLine=function(e){var t=i.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},i.parseOLine=function(e){var t=i.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},i.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=i.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},e.exports=i},function(e,t,n){(function(e,i){var r;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(s){t&&t.nodeType,e&&e.nodeType;var a="object"==typeof i&&i;a.global!==a&&a.window!==a&&a.self;var o,c=2147483647,l=36,u=1,p=26,d=38,h=700,f=72,m=128,g="-",b=/^xn--/,y=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},_=l-u,S=Math.floor,x=String.fromCharCode;function j(e){throw new RangeError(w[e])}function k(e,t){for(var n=e.length,i=[];n--;)i[n]=t(e[n]);return i}function T(e,t){var n=e.split("@"),i="";return n.length>1&&(i=n[0]+"@",e=n[1]),i+k((e=e.replace(v,".")).split("."),t).join(".")}function I(e){for(var t,n,i=[],r=0,s=e.length;r<s;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<s?56320==(64512&(n=e.charCodeAt(r++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),r--):i.push(t);return i}function E(e){return k(e,(function(e){var t="";return e>65535&&(t+=x((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=x(e)})).join("")}function O(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function C(e,t,n){var i=0;for(e=n?S(e/h):e>>1,e+=S(e/t);e>_*p>>1;i+=l)e=S(e/_);return S(i+(_+1)*e/(e+d))}function R(e){var t,n,i,r,s,a,o,d,h,b,y,v=[],w=e.length,_=0,x=m,k=f;for((n=e.lastIndexOf(g))<0&&(n=0),i=0;i<n;++i)e.charCodeAt(i)>=128&&j("not-basic"),v.push(e.charCodeAt(i));for(r=n>0?n+1:0;r<w;){for(s=_,a=1,o=l;r>=w&&j("invalid-input"),((d=(y=e.charCodeAt(r++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:l)>=l||d>S((c-_)/a))&&j("overflow"),_+=d*a,!(d<(h=o<=k?u:o>=k+p?p:o-k));o+=l)a>S(c/(b=l-h))&&j("overflow"),a*=b;k=C(_-s,t=v.length+1,0==s),S(_/t)>c-x&&j("overflow"),x+=S(_/t),_%=t,v.splice(_++,0,x)}return E(v)}function q(e){var t,n,i,r,s,a,o,d,h,b,y,v,w,_,k,T=[];for(v=(e=I(e)).length,t=m,n=0,s=f,a=0;a<v;++a)(y=e[a])<128&&T.push(x(y));for(i=r=T.length,r&&T.push(g);i<v;){for(o=c,a=0;a<v;++a)(y=e[a])>=t&&y<o&&(o=y);for(o-t>S((c-n)/(w=i+1))&&j("overflow"),n+=(o-t)*w,t=o,a=0;a<v;++a)if((y=e[a])<t&&++n>c&&j("overflow"),y==t){for(d=n,h=l;!(d<(b=h<=s?u:h>=s+p?p:h-s));h+=l)k=d-b,_=l-b,T.push(x(O(b+k%_,0))),d=S(k/_);T.push(x(O(d,0))),s=C(n,w,i==r),n=0,++i}++n,++t}return T.join("")}o={version:"1.4.1",ucs2:{decode:I,encode:E},decode:R,encode:q,toASCII:function(e){return T(e,(function(e){return y.test(e)?"xn--"+q(e):e}))},toUnicode:function(e){return T(e,(function(e){return b.test(e)?R(e.slice(4).toLowerCase()):e}))}},void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)}()}).call(this,n(24)(e),n(3))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,s=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,n,i){var r,s,a,o;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]),void 0===a)a=s[t]=n,++e._eventsCount;else if("function"==typeof a?a=s[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),(r=l(e))>0&&a.length>r&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,o=c,console&&console.warn&&console.warn(o)}return e}function p(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,s(this.listener,this.target,e))}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=p.bind(i);return r.listener=n,i.wrapFn=r,r}function h(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):m(r,r.length)}function f(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var l=c.length,u=m(c,l);for(n=0;n<l;++n)s(u[n],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,i,r,s,a;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){a=n[s].listener,r=s;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,s=Object.keys(n);for(i=0;i<s.length;++i)"removeListener"!==(r=s[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(e,t,n){"use strict";var i=n(10),r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=p;var s=n(6);s.inherits=n(7);var a=n(15),o=n(18);s.inherits(p,a);for(var c=r(o.prototype),l=0;l<c.length;l++){var u=c[l];p.prototype[u]||(p.prototype[u]=o.prototype[u])}function p(e){if(!(this instanceof p))return new p(e);a.call(this,e),o.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||i.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(p.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(p.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),p.prototype._destroy=function(e,t){this.push(null),this.end(),i.nextTick(t,e)}},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,n(8).Buffer)},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var i=n(22),r=n(23),s=n(14);function a(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return p(this,e)}return l(this,e,t,n)}function l(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=d(e,t);return e}(e,t,n,i):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|f(t,n),r=(e=o(e,i)).write(t,n);r!==i&&(e=e.slice(0,r));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|h(t.length);return 0===(e=o(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?o(e,0):d(e,t);if("Buffer"===t.type&&s(t.data))return d(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function p(e,t){if(u(t),e=o(e,t<0?0:0|h(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|h(t.length);e=o(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function h(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(i)return U(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return E(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return k(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function g(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function b(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=c.from(t,i)),c.isBuffer(t))return 0===t.length?-1:y(e,t,n,i,r);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,i,r){var s,a=1,o=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,o/=2,c/=2,n/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var u=-1;for(s=n;s<o;s++)if(l(e,s)===l(t,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===c)return u*a}else-1!==u&&(s-=s-u),u=-1}else for(n+c>o&&(n=o-c),s=n;s>=0;s--){for(var p=!0,d=0;d<c;d++)if(l(e,s+d)!==l(t,d)){p=!1;break}if(p)return s}return-1}function v(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");i>s/2&&(i=s/2);for(var a=0;a<i;++a){var o=parseInt(t.substr(2*a,2),16);if(isNaN(o))return a;e[n+a]=o}return a}function w(e,t,n,i){return $(U(t,e.length-n),e,n,i)}function _(e,t,n,i){return $(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function S(e,t,n,i){return _(e,t,n,i)}function x(e,t,n,i){return $(z(t),e,n,i)}function j(e,t,n,i){return $(function(e,t){for(var n,i,r,s=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),i=n>>8,r=n%256,s.push(r),s.push(i);return s}(t,e.length-n),e,n,i)}function k(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function T(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var s,a,o,c,l=e[r],u=null,p=l>239?4:l>223?3:l>191?2:1;if(r+p<=n)switch(p){case 1:l<128&&(u=l);break;case 2:128==(192&(s=e[r+1]))&&(c=(31&l)<<6|63&s)>127&&(u=c);break;case 3:s=e[r+1],a=e[r+2],128==(192&s)&&128==(192&a)&&(c=(15&l)<<12|(63&s)<<6|63&a)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:s=e[r+1],a=e[r+2],o=e[r+3],128==(192&s)&&128==(192&a)&&128==(192&o)&&(c=(15&l)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&c<1114112&&(u=c)}null===u?(u=65533,p=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),r+=p}return function(e){var t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);var n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=I));return n}(i)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return l(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,i){return u(t),t<=0?o(e,t):void 0!==n?"string"==typeof i?o(e,t).fill(n,i):o(e,t).fill(n):o(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return p(null,e)},c.allocUnsafeSlow=function(e){return p(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,s=Math.min(n,i);r<s;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=c.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var a=e[n];if(!c.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,r),r+=a.length}return i},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?T(this,0,e):m.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,i,r){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var s=(r>>>=0)-(i>>>=0),a=(n>>>=0)-(t>>>=0),o=Math.min(s,a),l=this.slice(i,r),u=e.slice(t,n),p=0;p<o;++p)if(l[p]!==u[p]){s=l[p],a=u[p];break}return s<a?-1:a<s?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return b(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return b(this,e,t,n,!1)},c.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":return _(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return x(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function E(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function O(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function C(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",s=t;s<n;++s)r+=B(e[s]);return r}function R(e,t,n){for(var i=e.slice(t,n),r="",s=0;s<i.length;s+=2)r+=String.fromCharCode(i[s]+256*i[s+1]);return r}function q(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,n,i,r,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<s)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function A(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,s=Math.min(e.length-n,2);r<s;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function P(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,s=Math.min(e.length-n,4);r<s;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function F(e,t,n,i,r,s){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(e,t,n,i,s){return s||F(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function L(e,t,n,i,s){return s||F(e,0,n,8),r.write(e,t,n,i,52,8),n+8}c.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var r=t-e;n=new c(r,void 0);for(var s=0;s<r;++s)n[s]=this[s+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||q(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return i},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||q(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},c.prototype.readUInt8=function(e,t){return t||q(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||q(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||q(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||q(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||q(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||q(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||q(e,t,this.length);for(var i=t,r=1,s=this[e+--i];i>0&&(r*=256);)s+=this[e+--i]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return t||q(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||q(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||q(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||q(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||q(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||q(e,4,this.length),r.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||q(e,4,this.length),r.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||q(e,8,this.length),r.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||q(e,8,this.length),r.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||N(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,s=0;for(this[t]=255&e;++s<n&&(r*=256);)this[t+s]=e/r&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||N(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,s=1;for(this[t+r]=255&e;--r>=0&&(s*=256);)this[t+r]=e/s&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):A(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):A(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):P(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);N(this,e,t,n,r-1,-r)}var s=0,a=1,o=0;for(this[t]=255&e;++s<n&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+n},c.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);N(this,e,t,n,r-1,-r)}var s=n-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):A(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):A(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return M(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return M(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return L(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return L(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,s=i-n;if(this===e&&n<t&&t<i)for(r=s-1;r>=0;--r)e[r+t]=this[r+n];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(r=0;r<s;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},c.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!c.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var a=c.isBuffer(e)?e:U(new c(e,i).toString()),o=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%o]}return this};var D=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var n;t=t||1/0;for(var i=e.length,r=null,s=[],a=0;a<i;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&s.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&s.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function z(e){return i.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function $(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}}).call(this,n(3))},function(e,t){var n,i,r=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,l=[],u=!1,p=-1;function d(){u&&c&&(u=!1,c.length?l=c.concat(l):p=-1,l.length&&h())}function h(){if(!u){var e=o(d);u=!0;for(var t=l.length;t;){for(c=l,l=[];++p<t;)c&&c[p].run();p=-1,t=l.length}c=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new f(e,t)),1!==l.length||u||o(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";(function(t){void 0===t||!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,n,i,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var s,a,o=arguments.length;switch(o){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,n)}));case 3:return t.nextTick((function(){e.call(null,n,i)}));case 4:return t.nextTick((function(){e.call(null,n,i,r)}));default:for(s=new Array(o-1),a=0;a<s.length;)s[a++]=arguments[a];return t.nextTick((function(){e.apply(null,s)}))}}}:e.exports=t}).call(this,n(9))},function(e,t,n){(t=e.exports=n(15)).Stream=t,t.Readable=t,t.Writable=n(18),t.Duplex=n(5),t.Transform=n(20),t.PassThrough=n(32)},function(e,t,n){"use strict";function i(e){return function(...t){var n=t.pop();return e.call(this,t,n)}}n.d(t,"a",(function(){return W}));var r="function"==typeof setImmediate&&setImmediate,s="object"==typeof process&&"function"==typeof process.nextTick;function a(e){setTimeout(e,0)}function o(e){return(t,...n)=>e(()=>t(...n))}var c=o(r?setImmediate:s?process.nextTick:a);function l(e){return d(e)?function(...t){const n=t.pop();return u(e.apply(this,t),n)}:i((function(t,n){var i;try{i=e.apply(this,t)}catch(e){return n(e)}if(i&&"function"==typeof i.then)return u(i,n);n(null,i)}))}function u(e,t){return e.then(e=>{p(t,null,e)},e=>{p(t,e&&e.message?e:new Error(e))})}function p(e,t,n){try{e(t,n)}catch(e){c(e=>{throw e},e)}}function d(e){return"AsyncFunction"===e[Symbol.toStringTag]}function h(e){if("function"!=typeof e)throw new Error("expected a function");return d(e)?l(e):e}function f(e,t=e.length){if(!t)throw new Error("arity is undefined");function n(...n){return"function"==typeof n[t-1]?e.apply(this,n):new Promise((i,r)=>{n[t-1]=(e,...t)=>{if(e)return r(e);i(t.length>1?t:t[0])},e.apply(this,n)})}return Object.defineProperty(n,"name",{value:`awaitable(${e.name})`}),n}function m(e){return function(t,...n){return f((function(i){var r=this;return e(t,(e,t)=>{h(e).apply(r,n.concat(t))},i)}))}}function g(e,t,n,i){t=t||[];var r=[],s=0,a=h(n);return e(t,(e,t,n)=>{var i=s++;a(e,(e,t)=>{r[i]=t,n(e)})},e=>{i(e,r)})}function b(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0}const y={};function v(e){function t(...t){if(null!==e){var n=e;e=null,n.apply(this,t)}}return Object.assign(t,e),t}function w(e){if(b(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t,n,i,r,s=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()}(e);return s?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(s):(n=(t=e)?Object.keys(t):[],i=-1,r=n.length,function(){var e=n[++i];return i<r?{value:t[e],key:e}:null})}function _(e){return function(...t){if(null===e)throw new Error("Callback was already called.");var n=e;e=null,n.apply(this,t)}}function S(e,t,n,i){let r=!1,s=!1,a=!1,o=0,c=0;function l(){o>=t||a||r||(a=!0,e.next().then(({value:e,done:t})=>{if(!s&&!r){if(a=!1,t)return r=!0,void(o<=0&&i(null));o++,n(e,c,u),c++,l()}}).catch(p))}function u(e,t){if(o-=1,!s)return e?p(e):!1===e?(r=!0,void(s=!0)):t===y||r&&o<=0?(r=!0,i(null)):void l()}function p(e){s||(a=!1,r=!0,i(e))}l()}var x=e=>(t,n,i)=>{if(i=v(i),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return i(null);if(function(e){return"AsyncGenerator"===e[Symbol.toStringTag]}(t))return S(t,e,n,i);if(function(e){return"function"==typeof e[Symbol.asyncIterator]}(t))return S(t[Symbol.asyncIterator](),e,n,i);var r=w(t),s=!1,a=!1,o=0,c=!1;function l(e,t){if(!a)if(o-=1,e)s=!0,i(e);else if(!1===e)s=!0,a=!0;else{if(t===y||s&&o<=0)return s=!0,i(null);c||u()}}function u(){for(c=!0;o<e&&!s;){var t=r();if(null===t)return s=!0,void(o<=0&&i(null));o+=1,n(t.value,t.key,_(l))}c=!1}u()};var j=f((function(e,t,n,i){return x(t)(e,h(n),i)}),4);function k(e,t,n){n=v(n);var i=0,r=0,{length:s}=e,a=!1;function o(e,t){!1===e&&(a=!0),!0!==a&&(e?n(e):++r!==s&&t!==y||n(null))}for(0===s&&n(null);i<s;i++)t(e[i],i,_(o))}function T(e,t,n){return j(e,1/0,t,n)}var I=f((function(e,t,n){return(b(e)?k:T)(e,h(t),n)}),3);var E=f((function(e,t,n){return g(I,e,t,n)}),3);m(E);var O=f((function(e,t,n){return j(e,1,t,n)}),3);var C=f((function(e,t,n){return g(O,e,t,n)}),3);m(C);Symbol("promiseCallback");class R{constructor(){this.head=this.tail=null,this.length=0}removeLink(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,e.prev=e.next=null,this.length-=1,e}empty(){for(;this.head;)this.shift();return this}insertAfter(e,t){t.prev=e,t.next=e.next,e.next?e.next.prev=t:this.tail=t,e.next=t,this.length+=1}insertBefore(e,t){t.prev=e.prev,t.next=e,e.prev?e.prev.next=t:this.head=t,e.prev=t,this.length+=1}unshift(e){this.head?this.insertBefore(this.head,e):q(this,e)}push(e){this.tail?this.insertAfter(this.tail,e):q(this,e)}shift(){return this.head&&this.removeLink(this.head)}pop(){return this.tail&&this.removeLink(this.tail)}toArray(){return[...this]}*[Symbol.iterator](){for(var e=this.head;e;)yield e.data,e=e.next}remove(e){for(var t=this.head;t;){var{next:n}=t;e(t)&&this.removeLink(t),t=n}return this}}function q(e,t){e.length=1,e.head=e.tail=t}function N(e,t,n){if(null==t)t=1;else if(0===t)throw new RangeError("Concurrency must not be zero");var i=h(e),r=0,s=[];const a={error:[],drain:[],saturated:[],unsaturated:[],empty:[]};function o(e,t){return e?t?void(a[e]=a[e].filter(e=>e!==t)):a[e]=[]:Object.keys(a).forEach(e=>a[e]=[])}function l(e,...t){a[e].forEach(e=>e(...t))}var u=!1;function p(e,t,n,i){if(null!=i&&"function"!=typeof i)throw new Error("task callback must be a function");var r,s;function a(e,...t){return e?n?s(e):r():t.length<=1?r(t[0]):void r(t)}b.started=!0;var o={data:e,callback:n?a:i||a};if(t?b._tasks.unshift(o):b._tasks.push(o),u||(u=!0,c(()=>{u=!1,b.process()})),n||!i)return new Promise((e,t)=>{r=e,s=t})}function d(e){return function(t,...n){r-=1;for(var i=0,a=e.length;i<a;i++){var o=e[i],c=s.indexOf(o);0===c?s.shift():c>0&&s.splice(c,1),o.callback(t,...n),null!=t&&l("error",t,o.data)}r<=b.concurrency-b.buffer&&l("unsaturated"),b.idle()&&l("drain"),b.process()}}function f(e){return!(0!==e.length||!b.idle())&&(c(()=>l("drain")),!0)}const m=e=>t=>{if(!t)return new Promise((t,n)=>{!function(e,t){const n=(...i)=>{o(e,n),t(...i)};a[e].push(n)}(e,(e,i)=>{if(e)return n(e);t(i)})});o(e),function(e,t){a[e].push(t)}(e,t)};var g=!1,b={_tasks:new R,*[Symbol.iterator](){yield*b._tasks[Symbol.iterator]()},concurrency:t,payload:n,buffer:t/4,started:!1,paused:!1,push(e,t){if(Array.isArray(e)){if(f(e))return;return e.map(e=>p(e,!1,!1,t))}return p(e,!1,!1,t)},pushAsync(e,t){if(Array.isArray(e)){if(f(e))return;return e.map(e=>p(e,!1,!0,t))}return p(e,!1,!0,t)},kill(){o(),b._tasks.empty()},unshift(e,t){if(Array.isArray(e)){if(f(e))return;return e.map(e=>p(e,!0,!1,t))}return p(e,!0,!1,t)},unshiftAsync(e,t){if(Array.isArray(e)){if(f(e))return;return e.map(e=>p(e,!0,!0,t))}return p(e,!0,!0,t)},remove(e){b._tasks.remove(e)},process(){if(!g){for(g=!0;!b.paused&&r<b.concurrency&&b._tasks.length;){var e=[],t=[],n=b._tasks.length;b.payload&&(n=Math.min(n,b.payload));for(var a=0;a<n;a++){var o=b._tasks.shift();e.push(o),s.push(o),t.push(o.data)}r+=1,0===b._tasks.length&&l("empty"),r===b.concurrency&&l("saturated");var c=_(d(e));i(t,c)}g=!1}},length:()=>b._tasks.length,running:()=>r,workersList:()=>s,idle:()=>b._tasks.length+r===0,pause(){b.paused=!0},resume(){!1!==b.paused&&(b.paused=!1,c(b.process))}};return Object.defineProperties(b,{saturated:{writable:!1,value:m("saturated")},unsaturated:{writable:!1,value:m("unsaturated")},empty:{writable:!1,value:m("empty")},drain:{writable:!1,value:m("drain")},error:{writable:!1,value:m("error")}}),b}f((function(e,t,n,i){i=v(i);var r=h(n);return O(e,(e,n,i)=>{r(t,e,(e,n)=>{t=n,i(e)})},e=>i(e,t))}),4);var A=f((function(e,t,n,i){return g(x(t),e,n,i)}),4);var P=f((function(e,t,n,i){var r=h(n);return A(e,t,(e,t)=>{r(e,(e,...n)=>e?t(e):t(e,n))},(e,t)=>{for(var n=[],r=0;r<t.length;r++)t[r]&&(n=n.concat(...t[r]));return i(e,n)})}),4);f((function(e,t,n){return P(e,1/0,t,n)}),3);f((function(e,t,n){return P(e,1,t,n)}),3);function F(e,t){return(n,i,r,s)=>{var a,o=!1;const c=h(r);n(i,(n,i,r)=>{c(n,(i,s)=>i||!1===i?r(i):e(s)&&!a?(o=!0,a=t(!0,n),r(null,y)):void r())},e=>{if(e)return s(e);s(null,o?a:t(!1))})}}f((function(e,t,n){return F(e=>e,(e,t)=>t)(I,e,t,n)}),3);f((function(e,t,n,i){return F(e=>e,(e,t)=>t)(x(t),e,n,i)}),4);f((function(e,t,n){return F(e=>e,(e,t)=>t)(x(1),e,t,n)}),3);function M(e){return(t,...n)=>h(t)(...n,(t,...n)=>{"object"==typeof console&&(t?console.error&&console.error(t):console[e]&&n.forEach(t=>console[e](t)))})}M("dir");f((function(e,t,n){n=_(n);var i,r=h(e),s=h(t);function a(e,...t){if(e)return n(e);!1!==e&&(i=t,s(...t,o))}function o(e,t){return e?n(e):!1!==e?t?void r(a):n(null,...i):void 0}return o(null,!0)}),3);function L(e){return(t,n,i)=>e(t,i)}f((function(e,t,n){return I(e,L(h(t)),n)}),3);var D=f((function(e,t,n,i){return x(t)(e,L(h(n)),i)}),4);var B=f((function(e,t,n){return D(e,1,t,n)}),3);function U(e){return d(e)?e:function(...t){var n=t.pop(),i=!0;t.push((...e)=>{i?c(()=>n(...e)):n(...e)}),e.apply(this,t),i=!1}}f((function(e,t,n){return F(e=>!e,e=>!e)(I,e,t,n)}),3);f((function(e,t,n,i){return F(e=>!e,e=>!e)(x(t),e,n,i)}),4);f((function(e,t,n){return F(e=>!e,e=>!e)(O,e,t,n)}),3);function z(e,t,n,i){var r=new Array(t.length);e(t,(e,t,i)=>{n(e,(e,n)=>{r[t]=!!n,i(e)})},e=>{if(e)return i(e);for(var n=[],s=0;s<t.length;s++)r[s]&&n.push(t[s]);i(null,n)})}function $(e,t,n,i){var r=[];e(t,(e,t,i)=>{n(e,(n,s)=>{if(n)return i(n);s&&r.push({index:t,value:e}),i(n)})},e=>{if(e)return i(e);i(null,r.sort((e,t)=>e.index-t.index).map(e=>e.value))})}function Q(e,t,n,i){return(b(t)?z:$)(e,t,h(n),i)}f((function(e,t,n){return Q(I,e,t,n)}),3);f((function(e,t,n,i){return Q(x(t),e,n,i)}),4);f((function(e,t,n){return Q(O,e,t,n)}),3);f((function(e,t){var n=_(t),i=h(U(e));return function e(t){if(t)return n(t);!1!==t&&i(e)}()}),2);f((function(e,t,n,i){var r=h(n);return A(e,t,(e,t)=>{r(e,(n,i)=>n?t(n):t(n,{key:i,val:e}))},(e,t)=>{for(var n={},{hasOwnProperty:r}=Object.prototype,s=0;s<t.length;s++)if(t[s]){var{key:a}=t[s],{val:o}=t[s];r.call(n,a)?n[a].push(o):n[a]=[o]}return i(e,n)})}),4);M("log");f((function(e,t,n,i){i=v(i);var r={},s=h(n);return x(t)(e,(e,t,n)=>{s(e,t,(e,i)=>{if(e)return n(e);r[t]=i,n(e)})},e=>i(e,r))}),4);o(s?process.nextTick:r?setImmediate:a),f((e,t,n)=>{var i=b(t)?[]:{};e(t,(e,t,n)=>{h(e)((e,...r)=>{r.length<2&&([r]=r),i[t]=r,n(e)})},e=>n(e,i))},3);function V(e,t){var n=h(e);return N((e,t)=>{n(e[0],t)},t,1)}class G{constructor(){this.heap=[],this.pushCount=Number.MIN_SAFE_INTEGER}get length(){return this.heap.length}empty(){return this.heap=[],this}percUp(e){let t;for(;e>0&&J(this.heap[e],this.heap[t=H(e)]);){let n=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=n,e=t}}percDown(e){let t;for(;(t=1+(e<<1))<this.heap.length&&(t+1<this.heap.length&&J(this.heap[t+1],this.heap[t])&&(t+=1),!J(this.heap[e],this.heap[t]));){let n=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=n,e=t}}push(e){e.pushCount=++this.pushCount,this.heap.push(e),this.percUp(this.heap.length-1)}unshift(e){return this.heap.push(e)}shift(){let[e]=this.heap;return this.heap[0]=this.heap[this.heap.length-1],this.heap.pop(),this.percDown(0),e}toArray(){return[...this]}*[Symbol.iterator](){for(let e=0;e<this.heap.length;e++)yield this.heap[e].data}remove(e){let t=0;for(let n=0;n<this.heap.length;n++)e(this.heap[n])||(this.heap[t]=this.heap[n],t++);this.heap.splice(t);for(let e=H(this.heap.length-1);e>=0;e--)this.percDown(e);return this}}function H(e){return(e+1>>1)-1}function J(e,t){return e.priority!==t.priority?e.priority<t.priority:e.pushCount<t.pushCount}function W(e,t){var n=V(e,t);return n._tasks=new G,n.push=function(e,t=0,i=(()=>{})){if("function"!=typeof i)throw new Error("task callback must be a function");if(n.started=!0,Array.isArray(e)||(e=[e]),0===e.length&&n.idle())return c(()=>n.drain());for(var r=0,s=e.length;r<s;r++){var a={data:e[r],priority:t,callback:i};n._tasks.push(a)}c(n.process)},delete n.unshift,n}f((function(e,t){if(t=v(t),!Array.isArray(e))return t(new TypeError("First argument to race must be an array of functions"));if(!e.length)return t();for(var n=0,i=e.length;n<i;n++)h(e[n])(t)}),2);function Y(e,t,n,i){const r=h(n);return Q(e,t,(e,t)=>{r(e,(e,n)=>{t(e,!n)})},i)}f((function(e,t,n){return Y(I,e,t,n)}),3);f((function(e,t,n,i){return Y(x(t),e,n,i)}),4);f((function(e,t,n){return Y(O,e,t,n)}),3);f((function(e,t,n){return F(Boolean,e=>e)(I,e,t,n)}),3);f((function(e,t,n,i){return F(Boolean,e=>e)(x(t),e,n,i)}),4);f((function(e,t,n){return F(Boolean,e=>e)(O,e,t,n)}),3);f((function(e,t,n){var i=h(t);return E(e,(e,t)=>{i(e,(n,i)=>{if(n)return t(n);t(n,{value:e,criteria:i})})},(e,t)=>{if(e)return n(e);n(null,t.sort(r).map(e=>e.value))});function r(e,t){var n=e.criteria,i=t.criteria;return n<i?-1:n>i?1:0}}),3);f((function(e,t){var n,i=null;return B(e,(e,t)=>{h(e)((e,...r)=>{if(!1===e)return t(e);r.length<2?[n]=r:n=r,i=e,t(e?null:{})})},()=>t(i,n))}));f((function(e,t,n){n=_(n);var i=h(t),r=h(e),s=[];function a(e,...t){if(e)return n(e);s=t,!1!==e&&r(o)}function o(e,t){return e?n(e):!1!==e?t?void i(a):n(null,...s):void 0}return r(o)}),3);f((function(e,t){if(t=v(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var n=0;function i(t){h(e[n++])(...t,_(r))}function r(r,...s){if(!1!==r)return r||n===e.length?t(r,...s):void i(s)}i([])}))},function(e,t,n){var i=n(8),r=i.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(s(i,t),t.Buffer=a),s(r,a),a.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";(function(t,i){var r=n(10);e.exports=v;var s,a=n(14);v.ReadableState=y;n(4).EventEmitter;var o=function(e,t){return e.listeners(t).length},c=n(16),l=n(13).Buffer,u=t.Uint8Array||function(){};var p=n(6);p.inherits=n(7);var d=n(25),h=void 0;h=d&&d.debuglog?d.debuglog("stream"):function(){};var f,m=n(26),g=n(17);p.inherits(v,c);var b=["error","close","destroy","pause","resume"];function y(e,t){e=e||{};var i=t instanceof(s=s||n(5));this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,a=e.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i&&(a||0===a)?a:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(f||(f=n(19).StringDecoder),this.decoder=new f(e.encoding),this.encoding=e.encoding)}function v(e){if(s=s||n(5),!(this instanceof v))return new v(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function w(e,t,n,i,r){var s,a=e._readableState;null===t?(a.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,j(e)}(e,a)):(r||(s=function(e,t){var n;i=t,l.isBuffer(i)||i instanceof u||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var i;return n}(a,t)),s?e.emit("error",s):a.objectMode||t&&t.length>0?("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===l.prototype||(t=function(e){return l.from(e)}(t)),i?a.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):_(e,a,t,!0):a.ended?e.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!n?(t=a.decoder.write(t),a.objectMode||0!==t.length?_(e,a,t,!1):T(e,a)):_(e,a,t,!1))):i||(a.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(a)}function _(e,t,n,i){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&j(e)),T(e,t)}Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),v.prototype.destroy=g.destroy,v.prototype._undestroy=g.undestroy,v.prototype._destroy=function(e,t){this.push(null),t(e)},v.prototype.push=function(e,t){var n,i=this._readableState;return i.objectMode?n=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=l.from(e,t),t=""),n=!0),w(this,e,t,!1,n)},v.prototype.unshift=function(e){return w(this,e,null,!0,!1)},v.prototype.isPaused=function(){return!1===this._readableState.flowing},v.prototype.setEncoding=function(e){return f||(f=n(19).StringDecoder),this._readableState.decoder=new f(e),this._readableState.encoding=e,this};var S=8388608;function x(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=S?e=S:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function j(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(h("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?r.nextTick(k,e):k(e))}function k(e){h("emit readable"),e.emit("readable"),C(e)}function T(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(I,e,t))}function I(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(h("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function E(e){h("readable nexttick read 0"),e.read(0)}function O(e,t){t.reading||(h("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),C(e),t.flowing&&!t.reading&&e.read(0)}function C(e){var t=e._readableState;for(h("flow",t.flowing);t.flowing&&null!==e.read(););}function R(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var i;e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):i=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,i=1,r=n.data;e-=r.length;for(;n=n.next;){var s=n.data,a=e>s.length?s.length:e;if(a===s.length?r+=s:r+=s.slice(0,e),0===(e-=a)){a===s.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(a));break}++i}return t.length-=i,r}(e,t):function(e,t){var n=l.allocUnsafe(e),i=t.head,r=1;i.data.copy(n),e-=i.data.length;for(;i=i.next;){var s=i.data,a=e>s.length?s.length:e;if(s.copy(n,n.length-e,0,a),0===(e-=a)){a===s.length?(++r,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=s.slice(a));break}++r}return t.length-=r,n}(e,t);return i}(e,t.buffer,t.decoder),n);var n}function q(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,r.nextTick(N,t,e))}function N(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function A(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}v.prototype.read=function(e){h("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return h("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?q(this):j(this),null;if(0===(e=x(e,t))&&t.ended)return 0===t.length&&q(this),null;var i,r=t.needReadable;return h("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&h("length less than watermark",r=!0),t.ended||t.reading?h("reading or ended",r=!1):r&&(h("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=x(n,t))),null===(i=e>0?R(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&q(this)),null!==i&&this.emit("data",i),i},v.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},v.prototype.pipe=function(e,t){var n=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1,h("pipe count=%d opts=%j",s.pipesCount,t);var c=(!t||!1!==t.end)&&e!==i.stdout&&e!==i.stderr?u:v;function l(t,i){h("onunpipe"),t===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,h("cleanup"),e.removeListener("close",b),e.removeListener("finish",y),e.removeListener("drain",p),e.removeListener("error",g),e.removeListener("unpipe",l),n.removeListener("end",u),n.removeListener("end",v),n.removeListener("data",m),d=!0,!s.awaitDrain||e._writableState&&!e._writableState.needDrain||p())}function u(){h("onend"),e.end()}s.endEmitted?r.nextTick(c):n.once("end",c),e.on("unpipe",l);var p=function(e){return function(){var t=e._readableState;h("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,C(e))}}(n);e.on("drain",p);var d=!1;var f=!1;function m(t){h("ondata"),f=!1,!1!==e.write(t)||f||((1===s.pipesCount&&s.pipes===e||s.pipesCount>1&&-1!==A(s.pipes,e))&&!d&&(h("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,f=!0),n.pause())}function g(t){h("onerror",t),v(),e.removeListener("error",g),0===o(e,"error")&&e.emit("error",t)}function b(){e.removeListener("finish",y),v()}function y(){h("onfinish"),e.removeListener("close",b),v()}function v(){h("unpipe"),n.unpipe(e)}return n.on("data",m),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?a(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",b),e.once("finish",y),e.emit("pipe",n),s.flowing||(h("pipe resume"),n.resume()),e},v.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var i=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<r;s++)i[s].emit("unpipe",this,n);return this}var a=A(t.pipes,e);return-1===a?this:(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},v.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&j(this):r.nextTick(E,this))}return n},v.prototype.addListener=v.prototype.on,v.prototype.resume=function(){var e=this._readableState;return e.flowing||(h("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(O,e,t))}(this,e)),this},v.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this},v.prototype.wrap=function(e){var t=this,n=this._readableState,i=!1;for(var r in e.on("end",(function(){if(h("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(r){(h("wrapped data"),n.decoder&&(r=n.decoder.write(r)),n.objectMode&&null==r)||(n.objectMode||r&&r.length)&&(t.push(r)||(i=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var s=0;s<b.length;s++)e.on(b[s],this.emit.bind(this,b[s]));return this._read=function(t){h("wrapped _read",t),i&&(i=!1,e.resume())},this},Object.defineProperty(v.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),v._fromList=R}).call(this,n(3),n(9))},function(e,t,n){e.exports=n(4).EventEmitter},function(e,t,n){"use strict";var i=n(10);function r(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,s=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return s||a?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i.nextTick(r,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(i.nextTick(r,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";(function(t,i,r){var s=n(10);function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var i=e.entry;e.entry=null;for(;i;){var r=i.callback;t.pendingcb--,r(n),i=i.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=y;var o,c=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?i:s.nextTick;y.WritableState=b;var l=n(6);l.inherits=n(7);var u={deprecate:n(30)},p=n(16),d=n(13).Buffer,h=r.Uint8Array||function(){};var f,m=n(17);function g(){}function b(e,t){o=o||n(5),e=e||{};var i=t instanceof o;this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,l=e.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i&&(l||0===l)?l:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var p=!1===e.decodeStrings;this.decodeStrings=!p,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,r=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,r){--t.pendingcb,n?(s.nextTick(r,i),s.nextTick(j,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(r(i),e._writableState.errorEmitted=!0,e.emit("error",i),j(e,t))}(e,n,i,t,r);else{var a=S(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||_(e,n),i?c(w,e,n,a,r):w(e,n,a,r)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function y(e){if(o=o||n(5),!(f.call(y,this)||this instanceof o))return new y(e);this._writableState=new b(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),p.call(this)}function v(e,t,n,i,r,s,a){t.writelen=i,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(r,t.onwrite):e._write(r,s,t.onwrite),t.sync=!1}function w(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),j(e,t)}function _(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,r=new Array(i),s=t.corkedRequestsFree;s.entry=n;for(var o=0,c=!0;n;)r[o]=n,n.isBuf||(c=!1),n=n.next,o+=1;r.allBuffers=c,v(e,t,!0,t.length,r,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,u=n.encoding,p=n.callback;if(v(e,t,!1,t.objectMode?1:l.length,l,u,p),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function S(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function x(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),j(e,t)}))}function j(e,t){var n=S(t);return n&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,s.nextTick(x,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}l.inherits(y,p),b.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(b.prototype,"buffer",{get:u.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!f.call(this,e)||this===y&&(e&&e._writableState instanceof b)}})):f=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,n){var i,r=this._writableState,a=!1,o=!r.objectMode&&(i=e,d.isBuffer(i)||i instanceof h);return o&&!d.isBuffer(e)&&(e=function(e){return d.from(e)}(e)),"function"==typeof t&&(n=t,t=null),o?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=g),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),s.nextTick(t,n)}(this,n):(o||function(e,t,n,i){var r=!0,a=!1;return null===n?a=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),s.nextTick(i,a),r=!1),r}(this,r,e,n))&&(r.pendingcb++,a=function(e,t,n,i,r,s){if(!n){var a=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=d.from(t,n));return t}(t,i,r);i!==a&&(n=!0,r="buffer",i=a)}var o=t.objectMode?1:i.length;t.length+=o;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:r,isBuf:n,callback:s,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else v(e,t,!1,o,i,r,s);return c}(this,r,o,e,t,n)),a},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||_(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,n){t.ending=!0,j(e,t),n&&(t.finished?s.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,i,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=m.destroy,y.prototype._undestroy=m.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(9),n(28).setImmediate,n(3))},function(e,t,n){"use strict";var i=n(31).Buffer,r=i.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(i.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=l,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=u,this.end=p,t=3;break;default:return this.write=d,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function p(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}t.StringDecoder=s,s.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},s.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},s.prototype.text=function(e,t){var n=function(e,t,n){var i=t.length-1;if(i<n)return 0;var r=a(t[i]);if(r>=0)return r>0&&(e.lastNeed=r-1),r;if(--i<n||-2===r)return 0;if((r=a(t[i]))>=0)return r>0&&(e.lastNeed=r-2),r;if(--i<n||-2===r)return 0;if((r=a(t[i]))>=0)return r>0&&(2===r?r=0:e.lastNeed=r-3),r;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var i=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";e.exports=a;var i=n(5),r=n(6);function s(e,t){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(!i)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),i(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function a(e){if(!(this instanceof a))return new a(e);i.call(this,e),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){c(e,t,n)})):c(this,null,null)}function c(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}r.inherits=n(7),r.inherits(a,i),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,i.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var n=this;i.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},function(e,t,n){"use strict";n.r(t),function(e,i){n.d(t,"Client",(function(){return wo})),n.d(t,"Constants",(function(){return _s})),n.d(t,"JID",(function(){return G})),n.d(t,"JXT",(function(){return Oi})),n.d(t,"Jingle",(function(){return Vs})),n.d(t,"Namespaces",(function(){return bi})),n.d(t,"RTT",(function(){return So})),n.d(t,"SASL",(function(){return kr})),n.d(t,"Stanzas",(function(){return ho})),n.d(t,"Utils",(function(){return Fr})),n.d(t,"VERSION",(function(){return xo})),n.d(t,"core",(function(){return fa})),n.d(t,"createClient",(function(){return jo})),n.d(t,"getHostMeta",(function(){return js}));var r=n(0),s=n(4),a=n(2),o=n.n(a),c=n(11),l=n(1),u=n(12);const p={"A.1":{r:"hk:if|le:lf|nf:nv|qg:qv|rg:rj|rm:rp|rr:rt|rv:s3|vn:vv|17m:17n|17q:17v|18g:19g|1an:1ao|1cb:1cg|1e5:1ef|1fb:1ff|1fl:1gb|1gd:1gq|1gs:1gu|1hr:1hv|1im:1iv|1ne:1nf|1pd:1pf|1qb:1rv|1ti:280|29q:29r|2ae:2af|2al:2an|2bh:2c0|2cd:2ce|2ch:2ci|2dj:2dl|2dq:2dr|2e5:2e6|2e9:2ea|2ee:2em|2eo:2er|2f4:2f5|2fr:2g1|2g3:2g4|2gb:2ge|2gh:2gi|2hq:2hr|2i3:2i6|2i9:2ia|2ie:2io|2iv:2j5|2jl:2k0|2lq:2lr|2me:2mf|2mh:2mv|2n1:2n5|2ng:2o0|2od:2oe|2oh:2oi|2pk:2pl|2pq:2pr|2q4:2q6|2q9:2qa|2qe:2ql|2qo:2qr|2r2:2r5|2rh:2s1|2sb:2sd|2sm:2so|2t0:2t2|2t5:2t7|2tb:2td|2tq:2tt|2u3:2u5|2ue:2um|2uo:2v6|2vj:300|31q:31t|32e:32k|32n:32v|332:335|33g:341|35q:35t|36e:36k|36n:36t|372:375|37g:381|39q:39t|3a4:3a5|3ae:3am|3ao:3av|3b2:3b5|3bg:3c1|3cn:3cp|3du:3dv|3e7:3e9|3eb:3ee|3f0:3fh|3fl:3g0|3hr:3hu|3is:3k0|3k5:3k6|3kb:3kc|3ke:3kj|3l8:3l9|3lu:3lv|3me:3mf|3mq:3mr|3mu:3nv|3rb:3rg|3sc:3sf|3ud:3ue|3ug:3vv|41j:41l|41q:41v|42q:44v|466:46f|47p:47q|47s:47v|4aq:4au|4d3:4d7|4fq:4fv|4ie:4if|4iu:4iv|4ke:4kf|4lm:4ln|4m6:4m7|4om:4on|4qr:4r0|4rt:4sv|4vl:500|5jn:5jv|5kt:5kv|5nh:5nv|5ol:5ov|5pn:5pv|5qk:5qv|5rk:5rv|5ut:5uv|5va:5vv|60q:60v|63o:63v|65a:7fv|7ks:7kv|7nq:7nv|7om:7on|7ou:7ov|7q6:7q7|7qe:7qf|7ru:7rv|7uk:7ul|7vg:7vh|82j:82m|82o:82u|834:839|83i:83j|84f:84v|85i:86f|87b:87v|89r:89s|8ac:8ai|8c4:8cf|8uf:8vv|917:91v|92b:92v|9gk:9gl|9ju:9jv|9ka:9o0|9oa:9ob|9qj:9ql|9qv:9r0|9sl:9sn|9tv:9uf|9vc:9vf|ao0:bjv|bnk:bnv|bum:bvf|bvs:bvv|c4n:c4o|c80:c84|c9d:c9g|cdo:cff|cgt:cgv|ci4:cig|cjs:cju|cmc:cmf|crn:crq|cuu:cuv|jdm:jfv|17t6:17vv|194d:194f|1967:1avv|1lt4:1lvv|1uhe:1uhf|1ujb:1unv|1uo7:1uoi|1uoo:1uos|1uti:1uui|1va0:1vaf|1vcg:1vch|1ve8:1vef|1vft:1vfv|1vgg:1vgv|1vh4:1vhf|1vi7:1vi8|1vjc:1vjf|1vnt:1vnu|1vtv:1vu1|1vu8:1vu9|1vug:1vuh|1vuo:1vup|1vut:1vuv|1vvf:1vvo|2000:20nv|20p4:20pf|20qb:20vv|2116:2117|212e:3jvv|3k7m:3k7v|3k97:3k99|3keu:3kvv|3l50:3l51|3l53:3l54|3l57:3l58|3l8b:3l8c|3la7:3la9|3ll4:3ll7|3lua:3lud|3m00:3vvt|59mn:5tvv|5ugu:5vvt|6000:7vvt|8000:9vvt|a000:bvvt|c000:dvvt|e000:fvvt|g000:hvvt|i000:jvvt|k000:lvvt|m000:nvvt|o000:pvvt|q000:rvvt|s002:s00v|s040:tvvt",s:"9p8|9qc|9qe|9qn|9tg|147|bkq|3l2l|3l4t|3l5d|3l5q|3l5s|3l61|3l64|3l86|3l8l|3l8t|3l9q|3l9v|3la5|3lah|16f|c20|ccf|cnv|cvv|1b0|1c8|1d2|1dq|1h0|1nv|1oe|284|2c4|2d9|2dh|2dt|2eu|2h9|2hh|2hk|2hn|2ht|2it|2k4|2kc|2ke|2ki|2l9|2lh|2lk|2m6|2ma|2o4|2p9|2ph|2qu|2s4|2sh|2sr|2st|2tm|2u9|304|30d|30h|319|31k|325|329|344|34d|34h|359|35k|365|369|36v|384|38d|38h|399|3a9|3c4|3di|3ds|3el|3en|3k3|3k9|3ko|3l0|3l4|3l6|3lc|3lq|3m5|3m7|3q8|3so|3tt|412|418|41b|4g7|4i7|4i9|4in|4ip|4k7|4k9|4lf|4lh|4lv|4m1|4mf|4mn|4nf|4of|4oh|4ov|4q7|h1|5od|5rd|5rh|60f|1upn|1upt|1upv|1uq2|1uq5|1vij|1vj7|1vjl|1vo0|1vv7|20ov|7qo|7qq|7qs|7qu|7tl|7u5|7us|7vl|7vv|sb|sd|s000|t2|97v|uf|9go|9o5"},"B.1":{r:"60b:60d|80b:80d|1vg0:1vgf",s:"5d|606|1vnv|830|qf"},"B.2":{m:"5l:ts|6v:3j;3j|9g:39;o7|a9:ls;3e|bv:3j|fg:3a;oc|q5:tp|rq:10;tp|sg:tp;o8;o1|tg:u5;o8;o1|u2:u3|ug:ti|uh:to|ui:u5|uj:ud|uk:ub|ul:u6|um:u0|vg:tq|vh:u1|vi:u3|vl:tl|1c7:1b5;1c2|7km:38;ph|7kn:3k;o8|7ko:3n;oa|7kp:3p;oa|7kq:31;lu|7kr:7j1|7qg:u5;oj|7qi:u5;oj;o0|7qk:u5;oj;o1|7qm:u5;oj;q2|7s0:7o0;tp|7s1:7o1;tp|7s2:7o2;tp|7s3:7o3;tp|7s4:7o4;tp|7s5:7o5;tp|7s6:7o6;tp|7s7:7o7;tp|7s8:7o0;tp|7s9:7o1;tp|7sa:7o2;tp|7sb:7o3;tp|7sc:7o4;tp|7sd:7o5;tp|7se:7o6;tp|7sf:7o7;tp|7sg:7p0;tp|7sh:7p1;tp|7si:7p2;tp|7sj:7p3;tp|7sk:7p4;tp|7sl:7p5;tp|7sm:7p6;tp|7sn:7p7;tp|7so:7p0;tp|7sp:7p1;tp|7sq:7p2;tp|7sr:7p3;tp|7ss:7p4;tp|7st:7p5;tp|7su:7p6;tp|7sv:7p7;tp|7t0:7r0;tp|7t1:7r1;tp|7t2:7r2;tp|7t3:7r3;tp|7t4:7r4;tp|7t5:7r5;tp|7t6:7r6;tp|7t7:7r7;tp|7t8:7r0;tp|7t9:7r1;tp|7ta:7r2;tp|7tb:7r3;tp|7tc:7r4;tp|7td:7r5;tp|7te:7r6;tp|7tf:7r7;tp|7ti:7rg;tp|7tj:th;tp|7tk:tc;tp|7tm:th;q2|7tn:th;q2;tp|7ts:th;tp|7tu:tp|7u2:7rk;tp|7u3:tn;tp|7u4:te;tp|7u6:tn;q2|7u7:tn;q2;tp|7uc:tn;tp|7ui:tp;o8;o0|7uj:tp;o8;o1|7um:tp;q2|7un:tp;o8;q2|7v2:u5;o8;o0|7v3:u5;o8;o1|7v4:u1;oj|7v6:u5;q2|7v7:u5;o8;q2|7vi:7rs;tp|7vj:u9;tp|7vk:ue;tp|7vm:u9;q2|7vn:u9;q2;tp|7vs:u9;tp|858:3i;3j|882:33|883:5g;33|887:ir|889:5g;36|88b:38|88c:38|88d:38|88g:39|88h:39|88i:3c|88l:3e|88m:3e;3f|88p:3g|88q:3h|88r:3i|88s:3i|88t:3i|890:3j;3d|891:3k;35;3c|892:3k;3d|894:3q|898:3q|89c:32|89d:33|89g:35|89h:36|89j:3d|89u:tj|89v:u0|8a5:34|crh:38;3g;31|crj:31;3l|crl:3f;3m|cs0:3g;31|cs1:3e;31|cs2:ts;31|cs3:3d;31|cs4:3b;31|cs5:3b;32|cs6:3d;32|cs7:37;32|csa:3g;36|csb:3e;36|csc:ts;36|csg:38;3q|csh:3b;38;3q|csi:3d;38;3q|csj:37;38;3q|csk:3k;38;3q|ct9:3g;31|cta:3b;3g;31|ctb:3d;3g;31|ctc:37;3g;31|ctk:3g;3m|ctl:3e;3m|ctm:ts;3m|ctn:3d;3m|cto:3b;3m|ctp:3d;3m|ctq:3g;3n|ctr:3e;3n|cts:ts;3n|ctt:3d;3n|ctu:3b;3n|ctv:3d;3n|cu0:3b;u9|cu1:3d;u9|cu3:32;3h|cu6:33;8gl;3b;37|cu7:33;3f;1e|cu8:34;32|cu9:37;3p|cub:38;3g|cud:3b;3b|cue:3b;3d|cun:3g;38|cup:3g;3g;3d|cuq:3g;3i|cus:3j;3m|cut:3n;32|1uo0:36;36|1uo1:36;39|1uo2:36;3c|1uo3:36;36;39|1uo4:36;36;3c|1uo5:3j;3k|1uo6:3j;3k|1uoj:1bk;1bm|1uok:1bk;1b5|1uol:1bk;1bb|1uom:1bu;1bm|1uon:1bk;1bd|3l00:31|3l01:32|3l02:33|3l03:34|3l04:35|3l05:36|3l06:37|3l07:38|3l08:39|3l09:3a|3l0a:3b|3l0b:3c|3l0c:3d|3l0d:3e|3l0e:3f|3l0f:3g|3l0g:3h|3l0h:3i|3l0i:3j|3l0j:3k|3l0k:3l|3l0l:3m|3l0m:3n|3l0n:3o|3l0o:3p|3l0p:3q|3l1k:31|3l1l:32|3l1m:33|3l1n:34|3l1o:35|3l1p:36|3l1q:37|3l1r:38|3l1s:39|3l1t:3a|3l1u:3b|3l1v:3c|3l20:3d|3l21:3e|3l22:3f|3l23:3g|3l24:3h|3l25:3i|3l26:3j|3l27:3k|3l28:3l|3l29:3m|3l2a:3n|3l2b:3o|3l2c:3p|3l2d:3q|3l38:31|3l39:32|3l3a:33|3l3b:34|3l3c:35|3l3d:36|3l3e:37|3l3f:38|3l3g:39|3l3h:3a|3l3i:3b|3l3j:3c|3l3k:3d|3l3l:3e|3l3m:3f|3l3n:3g|3l3o:3h|3l3p:3i|3l3q:3j|3l3r:3k|3l3s:3l|3l3t:3m|3l3u:3n|3l3v:3o|3l40:3p|3l41:3q|3l4s:31|3l4u:33|3l4v:34|3l52:37|3l55:3a|3l56:3b|3l59:3e|3l5a:3f|3l5b:3g|3l5c:3h|3l5e:3j|3l5f:3k|3l5g:3l|3l5h:3m|3l5i:3n|3l5j:3o|3l5k:3p|3l5l:3q|3l6g:31|3l6h:32|3l6i:33|3l6j:34|3l6k:35|3l6l:36|3l6m:37|3l6n:38|3l6o:39|3l6p:3a|3l6q:3b|3l6r:3c|3l6s:3d|3l6t:3e|3l6u:3f|3l6v:3g|3l70:3h|3l71:3i|3l72:3j|3l73:3k|3l74:3l|3l75:3m|3l76:3n|3l77:3o|3l78:3p|3l79:3q|3l84:31|3l85:32|3l87:34|3l88:35|3l89:36|3l8a:37|3l8d:3a|3l8e:3b|3l8f:3c|3l8g:3d|3l8h:3e|3l8i:3f|3l8j:3g|3l8k:3h|3l8m:3j|3l8n:3k|3l8o:3l|3l8p:3m|3l8q:3n|3l8r:3o|3l8s:3p|3l9o:31|3l9p:32|3l9r:34|3l9s:35|3l9t:36|3l9u:37|3la0:39|3la1:3a|3la2:3b|3la3:3c|3la4:3d|3la6:3f|3laa:3j|3lab:3k|3lac:3l|3lad:3m|3lae:3n|3laf:3o|3lag:3p|3lbc:31|3lbd:32|3lbe:33|3lbf:34|3lbg:35|3lbh:36|3lbi:37|3lbj:38|3lbk:39|3lbl:3a|3lbm:3b|3lbn:3c|3lbo:3d|3lbp:3e|3lbq:3f|3lbr:3g|3lbs:3h|3lbt:3i|3lbu:3j|3lbv:3k|3lc0:3l|3lc1:3m|3lc2:3n|3lc3:3o|3lc4:3p|3lc5:3q|3ld0:31|3ld1:32|3ld2:33|3ld3:34|3ld4:35|3ld5:36|3ld6:37|3ld7:38|3ld8:39|3ld9:3a|3lda:3b|3ldb:3c|3ldc:3d|3ldd:3e|3lde:3f|3ldf:3g|3ldg:3h|3ldh:3i|3ldi:3j|3ldj:3k|3ldk:3l|3ldl:3m|3ldm:3n|3ldn:3o|3ldo:3p|3ldp:3q|3lek:31|3lel:32|3lem:33|3len:34|3leo:35|3lep:36|3leq:37|3ler:38|3les:39|3let:3a|3leu:3b|3lev:3c|3lf0:3d|3lf1:3e|3lf2:3f|3lf3:3g|3lf4:3h|3lf5:3i|3lf6:3j|3lf7:3k|3lf8:3l|3lf9:3m|3lfa:3n|3lfb:3o|3lfc:3p|3lfd:3q|3lg8:31|3lg9:32|3lga:33|3lgb:34|3lgc:35|3lgd:36|3lge:37|3lgf:38|3lgg:39|3lgh:3a|3lgi:3b|3lgj:3c|3lgk:3d|3lgl:3e|3lgm:3f|3lgn:3g|3lgo:3h|3lgp:3i|3lgq:3j|3lgr:3k|3lgs:3l|3lgt:3m|3lgu:3n|3lgv:3o|3lh0:3p|3lh1:3q|3lhs:31|3lht:32|3lhu:33|3lhv:34|3li0:35|3li1:36|3li2:37|3li3:38|3li4:39|3li5:3a|3li6:3b|3li7:3c|3li8:3d|3li9:3e|3lia:3f|3lib:3g|3lic:3h|3lid:3i|3lie:3j|3lif:3k|3lig:3l|3lih:3m|3lii:3n|3lij:3o|3lik:3p|3lil:3q|3ljg:31|3ljh:32|3lji:33|3ljj:34|3ljk:35|3ljl:36|3ljm:37|3ljn:38|3ljo:39|3ljp:3a|3ljq:3b|3ljr:3c|3ljs:3d|3ljt:3e|3lju:3f|3ljv:3g|3lk0:3h|3lk1:3i|3lk2:3j|3lk3:3k|3lk4:3l|3lk5:3m|3lk6:3n|3lk7:3o|3lk8:3p|3lk9:3q|3ll8:th|3ll9:ti|3lla:tj|3llb:tk|3llc:tl|3lld:tm|3lle:tn|3llf:to|3llg:tp|3llh:tq|3lli:tr|3llj:ts|3llk:tt|3lll:tu|3llm:tv|3lln:u0|3llo:u1|3llp:to|3llq:u3|3llr:u4|3lls:u5|3llt:u6|3llu:u7|3llv:u8|3lm0:u9|3lmj:u3|3ln2:th|3ln3:ti|3ln4:tj|3ln5:tk|3ln6:tl|3ln7:tm|3ln8:tn|3ln9:to|3lna:tp|3lnb:tq|3lnc:tr|3lnd:ts|3lne:tt|3lnf:tu|3lng:tv|3lnh:u0|3lni:u1|3lnj:to|3lnk:u3|3lnl:u4|3lnm:u5|3lnn:u6|3lno:u7|3lnp:u8|3lnq:u9|3lod:u3|3los:th|3lot:ti|3lou:tj|3lov:tk|3lp0:tl|3lp1:tm|3lp2:tn|3lp3:to|3lp4:tp|3lp5:tq|3lp6:tr|3lp7:ts|3lp8:tt|3lp9:tu|3lpa:tv|3lpb:u0|3lpc:u1|3lpd:to|3lpe:u3|3lpf:u4|3lpg:u5|3lph:u6|3lpi:u7|3lpj:u8|3lpk:u9|3lq7:u3|3lqm:th|3lqn:ti|3lqo:tj|3lqp:tk|3lqq:tl|3lqr:tm|3lqs:tn|3lqt:to|3lqu:tp|3lqv:tq|3lr0:tr|3lr1:ts|3lr2:tt|3lr3:tu|3lr4:tv|3lr5:u0|3lr6:u1|3lr7:to|3lr8:u3|3lr9:u4|3lra:u5|3lrb:u6|3lrc:u7|3lrd:u8|3lre:u9|3ls1:u3|3lsg:th|3lsh:ti|3lsi:tj|3lsj:tk|3lsk:tl|3lsl:tm|3lsm:tn|3lsn:to|3lso:tp|3lsp:tq|3lsq:tr|3lsr:ts|3lss:tt|3lst:tu|3lsu:tv|3lsv:u0|3lt0:u1|3lt1:to|3lt2:u3|3lt3:u4|3lt4:u5|3lt5:u6|3lt6:u7|3lt7:u8|3lt8:u9|3ltr:u3",r:"23:2c|2i:2k|2m:2q|60:6m|6o:6u|bo:bp|c1:c2|c6:c7|c9:cb|ce:ch|cj:ck|cm:co|cs:ct|cv:d0|d6:d7|de:df|dh:dj|dn:do|e4:e5|e7:e8|ea:eb|fh:fi|fm:fo|s8:sa|se:sf|sh:t1|t3:tb|100:11f|19h:1am|7o8:7of|7oo:7ot|7p8:7pf|7po:7pv|7q8:7qd|7r8:7rf|7to:7tr|7u8:7ub|7uo:7ur|7v8:7vc|7vo:7vr|89a:89b|8b0:8bf|95m:96f|1vp1:1vpq|2100:2115",s:"v8|va|vc|ve|vk|130|132|134|136|138|13a|13c|13e|13g|13i|13k|13m|13o|13q|13s|13u|140|14a|14c|14e|14g|14i|14k|14m|14o|14q|14s|14u|150|152|154|156|158|15a|15c|15e|15g|15i|15k|15m|15o|15q|15s|15u|161|163|165|167|169|16b|16d|16g|16i|16k|16m|16o|16q|16s|16u|170|172|174|176|178|17a|17c|17e|17g|17i|17k|17o|180|182|184|186|188|18a|18c|18e|80|82|84|86|88|8a|8c|8e|8g|8i|8k|8m|8o|8q|8s|8u|90|92|94|96|98|9a|9c|9e|9i|9k|9m|9p|9r|9t|9v|a1|a3|a5|a7|aa|ac|ae|ag|ai|ak|am|ao|aq|as|au|b0|b2|b4|b6|b8|ba|bc|be|bg|bi|bk|bm|br|bt|c4|d2|d4|d9|dc|dl|ds|ed|ef|eh|ej|el|en|ep|er|eu|f0|f2|f4|f6|f8|fa|fc|fe|fk|fq|fs|fu|g0|g2|g4|g6|g8|ga|gc|ge|gg|gi|gk|gm|go|gq|gs|gu|h0|h2|h4|h6|h8|ha|hc|he|hg|hi|21|22|7g0|7g2|7g4|7g6|7g8|7ga|7gc|7ge|7gg|7gi|2d|7gk|7gm|7go|7gq|7gs|7gu|7h0|7h2|7h4|7h6|7h8|7ha|7hc|7he|7hg|7hi|7hk|7hm|7ho|7hq|7hs|7hu|7i0|7i2|7i4|7i6|7i8|7ia|7ic|7ie|7ig|7ii|7ik|7im|7io|7iq|7is|7iu|7j0|7j2|7j4|7j6|7j8|7ja|7jc|7je|7jg|7ji|7jk|7jm|2e|7jo|7jq|7js|7ju|7k0|7k2|7k4|7k6|7k8|7ka|7kc|7ke|7kg|7ki|7kk|7l0|7l2|7l4|7l6|7l8|7la|7lc|7le|7lg|7li|7lk|7lm|7lo|7lq|7ls|7lu|7m0|7m2|7m4|7m6|7m8|7ma|7mc|7me|7mg|7mi|7mk|7mm|7mo|7mq|2f|7ms|7mu|7n0|7n2|7n4|7n6|7n8|7na|7nc|7ne|7ng|7ni|7nk|7nm|7no|2g|7qp|7qr|7qt|7qv|2h|896|2l|s6|sc|uo|uq|us|uu|v0|v2|v4|v6"},"B.3":{m:"5l:ts|6v:3j;3j|9g:39;o7|a9:ls;3e|bv:3j|fg:3a;oc|q5:tp|sg:tp;o8;o1|tg:u5;o8;o1|u2:u3|ug:ti|uh:to|ul:u6|um:u0|vg:tq|vh:u1|vi:u3|vl:tl|1c7:1b5;1c2|7km:38;ph|7kn:3k;o8|7ko:3n;oa|7kp:3p;oa|7kq:31;lu|7kr:7j1|7qg:u5;oj|7qi:u5;oj;o0|7qk:u5;oj;o1|7qm:u5;oj;q2|7s0:7o0;tp|7s1:7o1;tp|7s2:7o2;tp|7s3:7o3;tp|7s4:7o4;tp|7s5:7o5;tp|7s6:7o6;tp|7s7:7o7;tp|7s8:7o0;tp|7s9:7o1;tp|7sa:7o2;tp|7sb:7o3;tp|7sc:7o4;tp|7sd:7o5;tp|7se:7o6;tp|7sf:7o7;tp|7sg:7p0;tp|7sh:7p1;tp|7si:7p2;tp|7sj:7p3;tp|7sk:7p4;tp|7sl:7p5;tp|7sm:7p6;tp|7sn:7p7;tp|7so:7p0;tp|7sp:7p1;tp|7sq:7p2;tp|7sr:7p3;tp|7ss:7p4;tp|7st:7p5;tp|7su:7p6;tp|7sv:7p7;tp|7t0:7r0;tp|7t1:7r1;tp|7t2:7r2;tp|7t3:7r3;tp|7t4:7r4;tp|7t5:7r5;tp|7t6:7r6;tp|7t7:7r7;tp|7t8:7r0;tp|7t9:7r1;tp|7ta:7r2;tp|7tb:7r3;tp|7tc:7r4;tp|7td:7r5;tp|7te:7r6;tp|7tf:7r7;tp|7ti:7rg;tp|7tj:th;tp|7tk:tc;tp|7tm:th;q2|7tn:th;q2;tp|7ts:th;tp|7tu:tp|7u2:7rk;tp|7u3:tn;tp|7u4:te;tp|7u6:tn;q2|7u7:tn;q2;tp|7uc:tn;tp|7ui:tp;o8;o0|7uj:tp;o8;o1|7um:tp;q2|7un:tp;o8;q2|7v2:u5;o8;o0|7v3:u5;o8;o1|7v4:u1;oj|7v6:u5;q2|7v7:u5;o8;q2|7vi:7rs;tp|7vj:u9;tp|7vk:ue;tp|7vm:u9;q2|7vn:u9;q2;tp|7vs:u9;tp|1uo0:36;36|1uo1:36;39|1uo2:36;3c|1uo3:36;36;39|1uo4:36;36;3c|1uo5:3j;3k|1uo6:3j;3k|1uoj:1bk;1bm|1uok:1bk;1b5|1uol:1bk;1bb|1uom:1bu;1bm|1uon:1bk;1bd",r:"23:2c|2i:2k|2m:2q|60:6m|6o:6u|bo:bp|c1:c2|c6:c7|c9:cb|ce:ch|cj:ck|cm:co|cs:ct|cv:d0|d6:d7|de:df|dh:dj|dn:do|e4:e5|e7:e8|ea:eb|fh:fi|fm:fo|s8:sa|se:sf|sh:t1|t3:tb|100:11f|19h:1am|7o8:7of|7oo:7ot|7p8:7pf|7po:7pv|7q8:7qd|7r8:7rf|7to:7tr|7u8:7ub|7uo:7ur|7v8:7vc|7vo:7vr|89a:89b|8b0:8bf|95m:96f|1vp1:1vpq|2100:2115",s:"v8|va|vc|ve|vk|130|132|134|136|138|13a|13c|13e|13g|13i|13k|13m|13o|13q|13s|13u|140|14a|14c|14e|14g|14i|14k|14m|14o|14q|14s|14u|150|152|154|156|158|15a|15c|15e|15g|15i|15k|15m|15o|15q|15s|15u|161|163|165|167|169|16b|16d|16g|16i|16k|16m|16o|16q|16s|16u|170|172|174|176|178|17a|17c|17e|17g|17i|17k|17o|180|182|184|186|188|18a|18c|18e|80|82|84|86|88|8a|8c|8e|8g|8i|8k|8m|8o|8q|8s|8u|90|92|94|96|98|9a|9c|9e|9i|9k|9m|9p|9r|9t|9v|a1|a3|a5|a7|aa|ac|ae|ag|ai|ak|am|ao|aq|as|au|b0|b2|b4|b6|b8|ba|bc|be|bg|bi|bk|bm|br|bt|c4|d2|d4|d9|dc|dl|ds|ed|ef|eh|ej|el|en|ep|er|eu|f0|f2|f4|f6|f8|fa|fc|fe|fk|fq|fs|fu|g0|g2|g4|g6|g8|ga|gc|ge|gg|gi|gk|gm|go|gq|gs|gu|h0|h2|h4|h6|h8|ha|hc|he|hg|hi|21|22|7g0|7g2|7g4|7g6|7g8|7ga|7gc|7ge|7gg|7gi|2d|7gk|7gm|7go|7gq|7gs|7gu|7h0|7h2|7h4|7h6|7h8|7ha|7hc|7he|7hg|7hi|7hk|7hm|7ho|7hq|7hs|7hu|7i0|7i2|7i4|7i6|7i8|7ia|7ic|7ie|7ig|7ii|7ik|7im|7io|7iq|7is|7iu|7j0|7j2|7j4|7j6|7j8|7ja|7jc|7je|7jg|7ji|7jk|7jm|2e|7jo|7jq|7js|7ju|7k0|7k2|7k4|7k6|7k8|7ka|7kc|7ke|7kg|7ki|7kk|7l0|7l2|7l4|7l6|7l8|7la|7lc|7le|7lg|7li|7lk|7lm|7lo|7lq|7ls|7lu|7m0|7m2|7m4|7m6|7m8|7ma|7mc|7me|7mg|7mi|7mk|7mm|7mo|7mq|2f|7ms|7mu|7n0|7n2|7n4|7n6|7n8|7na|7nc|7ne|7ng|7ni|7nk|7nm|7no|2g|7qp|7qr|7qt|7qv|2h|896|2l|s6|sc|uo|uq|us|uu|v0|v2|v4|v6"},"C.1.1":{s:"10"},"C.1.2":{r:"800:80b",s:"c00|50|5k0|81f|82v"},"C.2.1":{r:"0:v",s:"3v"},"C.2.2":{r:"40:4v|80c:80d|818:819|830:833|83a:83f|1vvp:1vvs|3kbj:3kbq",s:"1mt|1of|60e|1vnv"},"C.3":{r:"1o00:1u7v|u000:vvvt|10000:11vvt"},"C.4":{r:"1veg:1vff|1vvu:1vvv|3vvu:3vvv|5vvu:5vvv|7vvu:7vvv|9vvu:9vvv|bvvu:bvvv|dvvu:dvvv|fvvu:fvvv|hvvu:hvvv|jvvu:jvvv|lvvu:lvvv|nvvu:nvvv|pvvu:pvvv|rvvu:rvvv|tvvu:tvvv|vvvu:vvvv|11vvu:11vvv"},"C.5":{r:"1m00:1nvv"},"C.6":{r:"1vvp:1vvt"},"C.7":{r:"bvg:bvr"},"C.8":{r:"q0:q1|80e:80f|81a:81e|83a:83f"},"C.9":{r:"s010:s03v",s:"s001"},"D.1":{r:"1eg:1fa|1fg:1fk|1h1:1hq|1i0:1ia|1jd:1jf|1jh:1ml|1n5:1n6|1nq:1nu|1o0:1od|1oi:1pc|1s0:1t5|1uov:1up8|1upa:1upm|1upo:1ups|1uq0:1uq1|1uq3:1uq4|1uq6:1uth|1uuj:1v9t|1vag:1vcf|1vci:1ve7|1vfg:1vfs|1vjg:1vjk|1vjm:1vns",s:"1du|1e0|1e3|1gr|1gv|1mt|1og|1th|1uot|1upu|80f"},"D.2":{r:"21:2q|31:3q|60:6m|6o:7m|7o:h0|h2:hj|ig:ld|lg:lo|lr:m1|mg:mh|n0:n4|s8:sa|se:t1|t3:ue|ug:vl|100:142|14a:16e|16g:17l|17o:17p|180:18f|19h:1am|1ap:1av|1b1:1c7|285:29p|29t:2a0|2a9:2ac|2ao:2b1|2b4:2bg|2c2:2c3|2c5:2cc|2cf:2cg|2cj:2d8|2da:2dg|2dm:2dp|2du:2e0|2e7:2e8|2eb:2ec|2es:2et|2ev:2f1|2f6:2fh|2fk:2fq|2g5:2ga|2gf:2gg|2gj:2h8|2ha:2hg|2hi:2hj|2hl:2hm|2ho:2hp|2hu:2i0|2ip:2is|2j6:2jf|2ji:2jk|2k5:2kb|2kf:2kh|2kj:2l8|2la:2lg|2li:2lj|2ll:2lp|2lt:2m0|2mb:2mc|2n6:2nf|2o2:2o3|2o5:2oc|2of:2og|2oj:2p8|2pa:2pg|2pi:2pj|2pm:2pp|2pt:2pu|2q7:2q8|2qb:2qc|2qs:2qt|2qv:2r1|2r6:2rg|2s5:2sa|2se:2sg|2si:2sl|2sp:2sq|2su:2sv|2t3:2t4|2t8:2ta|2te:2tl|2tn:2tp|2tu:2tv|2u1:2u2|2u6:2u8|2ua:2uc|2v7:2vi|301:303|305:30c|30e:30g|30i:318|31a:31j|31l:31p|321:324|330:331|336:33f|342:343|345:34c|34e:34g|34i:358|35a:35j|35l:35p|360:364|367:368|36a:36b|36l:36m|370:371|376:37f|382:383|385:38c|38e:38g|38i:398|39a:39p|39u:3a0|3a6:3a8|3aa:3ac|3b0:3b1|3b6:3bf|3c2:3c3|3c5:3cm|3cq:3dh|3dj:3dr|3e0:3e6|3ef:3eh|3eo:3ev|3fi:3fk|3g1:3hg|3hi:3hj|3i0:3i6|3if:3ir|3k1:3k2|3k7:3k8|3kk:3kn|3kp:3kv|3l1:3l3|3la:3lb|3ld:3lg|3li:3lj|3m0:3m4|3mg:3mp|3ms:3mt|3o0:3on|3oq:3pk|3pu:3q7|3q9:3ra|3s8:3sb|3tu:3u5|3u7:3uc|400:411|413:417|419:41a|420:42n|450:465|46g:47o|480:4ap|4av:4d2|4d8:4fp|4g0:4g6|4g8:4i6|4ia:4id|4ig:4im|4iq:4it|4j0:4k6|4ka:4kd|4kg:4le|4li:4ll|4lo:4lu|4m2:4m5|4m8:4me|4mg:4mm|4mo:4ne|4ng:4oe|4oi:4ol|4oo:4ou|4p0:4q6|4q8:4qq|4r1:4rs|4t0:4vk|501:5jm|5k1:5kq|5l0:5ng|5o0:5oc|5oe:5oh|5p0:5ph|5pl:5pm|5q0:5qh|5r0:5rc|5re:5rg|5s0:5tm|5tu:5u5|5u7:5u8|5uk:5uq|5v0:5v9|60g:60p|610:63n|640:658|7g0:7kr|7l0:7np|7o0:7ol|7oo:7ot|7p0:7q5|7q8:7qd|7qg:7qn|7qv:7rt|7s0:7tk|7tm:7ts|7u2:7u4|7u6:7uc|7ug:7uj|7um:7ur|7v0:7vc|7vi:7vk|7vm:7vs|88a:88j|88p:88t|89a:89d|89f:89h|89j:89p|89t:89v|8a5:8a9|8b0:8c3|8pm:8rq|94s:979|c05:c07|c11:c19|c1h:c1l|c1o:c1s|c21:c4m|c4t:c4v|c51:c7q|c7s:c7v|c85:c9c|c9h:cce|ccg:cdn|cfg:cgs|ch0:ci3|cj0:cjr|cjv:clg|cm0:cmb|cmg:cnu|co0:crm|crr:cut|cv0:cvu|d00:jdl|jg0:17t5|1800:194c|1b00:1lt3|1m00:1uhd|1uhg:1uja|1uo0:1uo6|1uoj:1uon|1vp1:1vpq|1vq1:1vqq|1vr6:1vtu|1vu2:1vu7|1vua:1vuf|1vui:1vun|1vuq:1vus|20o0:20ou|20p0:20p3|20pg:20qa|2100:2115|2118:212d|3k00:3k7l|3k80:3k96|3k9a:3kb6|3kba:3kbi|3kc3:3kc4|3kcc:3kd9|3kde:3ket|3l00:3l2k|3l2m:3l4s|3l4u:3l4v|3l55:3l56|3l59:3l5c|3l5e:3l5p|3l5t:3l60|3l62:3l63|3l65:3l85|3l87:3l8a|3l8d:3l8k|3l8m:3l8s|3l8u:3l9p|3l9r:3l9u|3la0:3la4|3laa:3lag|3lai:3ll3|3ll8:3lu9|4000:59mm|5u00:5ugt|u000:vvvt|10000:11vvt",s:"3l52|3l5r|3la6|1c9|5a|5l|5q|283|2ag|2di|2en|2iu|2k3|2kd|2m9|2mg|2n0|2q0|2qn|2s3|2ss|2un|35u|36u|3an|3dt|3k4|3ka|3kd|3l5|3l7|3lt|3m6|3pm|3po|3rv|3s5|3uf|41c|41h|41o|47r|4i8|4io|4k8|4lg|4m0|4og|5us|ne|7qp|7qr|7qt|7tu|80e|83h|83v|882|887|88l|894|896|898|rq|s6|sc|8sl"}};class d{constructor(e,t){this.singles=new Set,this.ranges=[],this.mappings=new Map;const n=p[e];this.name=e,n?(n.s&&(this.singles=new Set(n.s.split("|").map(e=>parseInt(e,32)))),n.r&&(this.ranges=n.r.split("|").map(e=>{const[t,n]=e.split(":");return[parseInt(t,32),parseInt(n,32)]})),n.m&&(this.mappings=new Map(n.m.split("|").map(e=>{const[t,n]=e.split(":"),i=n.split(";").map(e=>parseInt(e,32));return[parseInt(t,32),i]})))):t&&(this.singles=new Set(t))}contains(e){if(this.singles.has(e))return!0;let t=0,n=this.ranges.length-1;for(;t<=n;){const i=Math.floor((t+n)/2),r=this.ranges[i];if(e<r[0])n=i-1;else{if(!(e>r[1]))return!0;t=i+1}}return!1}hasMapping(e){return this.mappings.has(e)||this.contains(e)}map(e){return this.contains(e)&&!this.mappings.has(e)?String.fromCodePoint(e).toLowerCase().codePointAt(0):this.mappings.get(e)||null}}const h=new d("A.1"),f=new d("B.1"),m=new d("B.2"),g=(new d("B.3"),new d("C.1.1")),b=new d("C.1.2"),y=new d("C.2.1"),v=new d("C.2.2"),w=new d("C.3"),_=new d("C.4"),S=new d("C.5"),x=new d("C.6"),j=new d("C.7"),k=new d("C.8"),T=new d("C.9"),I=new d("D.1"),E=new d("D.2");function O(e,t,n){const i=o.a.ucs2.decode(n);let r=[];for(const n of i){if(!t&&e.unassigned.contains(n))throw new Error("Unassigned codepoint: x"+n.toString(16));let i=!1;for(const t of e.mappings){if(!t.hasMapping(n))continue;i=!0;const e=t.map(n);e&&(Array.isArray(e)?r=r.concat(e):r.push(e))}i||r.push(n)}let s=r;if(e.normalize){const e=o.a.ucs2.encode(r).normalize("NFKC");s=o.a.ucs2.decode(e)}let a=!1,c=!1;for(const n of s){for(const t of e.prohibited)if(t.contains(n))throw new Error("Prohibited code point: x"+n.toString(16));if(!t&&e.unassigned.contains(n))throw new Error("Prohibited code point: x"+n.toString(16));e.bidirectional&&(a=a||I.contains(n),c=c||E.contains(n))}if(e.bidirectional){if(a&&c)throw new Error("String contained both LCat and RandALCat code points");if(a&&(!I.contains(s[0])||!I.contains(s[s.length-1])))throw new Error("String containing RandALCat code points must start and end with RandALCat code points")}return o.a.ucs2.encode(s)}f.map=()=>null,g.contains=e=>32===e,b.map=e=>b.contains(e)?32:null;const C={bidirectional:!0,mappings:[f,m],normalize:!0,prohibited:[b,v,w,_,S,x,j,k,T],unassigned:h};const R=new d("NodePrepProhibited",[34,38,39,47,58,60,62,64]),q={bidirectional:!0,mappings:[f,m],normalize:!0,prohibited:[g,b,y,v,w,_,S,x,j,k,T,R],unassigned:h};const N={bidirectional:!0,mappings:[f],normalize:!0,prohibited:[b,y,v,w,_,S,x,j,k,T],unassigned:h};function A(e,t={}){let n=e.local;t.escaped||(n=$(e.local));const i=t.prepared?e:P({local:n,domain:e.domain,resource:e.resource}),r=n?`${n}@${i.domain}`:i.domain;return i.resource?`${r}/${i.resource}`:r}function P(e){let t=e.local||"",n=e.domain,i=e.resource||"";return t&&(t=function(e,t=!0){return O(q,t,e)}(t)),i&&(i=function(e,t=!0){return O(N,t,e)}(i)),"."===n[n.length-1]&&(n=n.slice(0,n.length-1)),{domain:n=function(e,t=!0){return O(C,t,e)}(n.split(".").map(o.a.toUnicode).join(".")),local:t,resource:i}}function F(e=""){let t="",n="",i="";const r=e.indexOf("/");r>0&&(i=e.slice(r+1),e=e.slice(0,r));const s=e.indexOf("@");s>0&&(t=e.slice(0,s),e=e.slice(s+1));const a=P({domain:n=e,local:t,resource:i});return{bare:A({local:a.local,domain:a.domain},{escaped:!0,prepared:!0}),domain:a.domain,full:A(a,{escaped:!0,prepared:!0}),local:Q(a.local),resource:a.resource}}function M(e,t){const n=new Set;if(n.add(void 0),n.add(""),e){const t=F(e);n.add(t.full),n.add(t.bare),n.add(t.domain)}if(t){const e=F(t);n.add(e.domain),n.add(e.bare),n.add(e.full)}return n}function L(e,t){if(!e||!t)return!1;const n=F(e),i=F(t);return n.local===i.local&&n.domain===i.domain}function D(e){return!!F(e).resource}function B(e=""){return F(e).domain}function U(e=""){return F(e).resource}function z(e=""){return F(e).bare}function $(e=""){return e.replace(/^\s+|\s+$/g,"").replace(/\\5c/g,"\\5c5c").replace(/\\20/g,"\\5c20").replace(/\\22/g,"\\5c22").replace(/\\26/g,"\\5c26").replace(/\\27/g,"\\5c27").replace(/\\2f/g,"\\5c2f").replace(/\\3a/g,"\\5c3a").replace(/\\3c/g,"\\5c3c").replace(/\\3e/g,"\\5c3e").replace(/\\40/g,"\\5c40").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")}function Q(e){return e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")}var V,G=Object.freeze({__proto__:null,create:A,prepare:P,parse:F,allowedResponders:M,equal:function(e,t){if(!e||!t)return!1;const n=F(e),i=F(t);return n.local===i.local&&n.domain===i.domain&&n.resource===i.resource},equalBare:L,isBare:function(e){return!D(e)},isFull:D,getLocal:function(e=""){return F(e).local},getDomain:B,getResource:U,toBare:z,escapeLocal:$,unescapeLocal:Q,parseURI:function(e){const t=new URL(e);if("xmpp:"!==t.protocol)throw new Error("Invalid XMPP URI, wrong protocol: "+t.protocol);const n=t.hostname?t.username?A({domain:decodeURIComponent(t.hostname),local:decodeURIComponent(t.username)},{escaped:!0}):decodeURIComponent(t.hostname):void 0,i=F(decodeURIComponent(n?t.pathname.substr(1):t.pathname)).full,r=t.search&&t.search.indexOf(";")>=1,s=r?t.search.substr(t.search.indexOf(";")+1):"",a=t.search?decodeURIComponent(t.search.substr(1,r?t.search.indexOf(";")-1:void 0)):void 0,o={};for(const e of s.split(";")){const[t,n]=e.split("=").map(decodeURIComponent);if(o[t]){const e=o[t];Array.isArray(e)?e.push(n):o[t]=[e,n]}else o[t]=n}return{action:a,identity:n,jid:i,parameters:o}},toURI:function(e){const t=["xmpp:"],n=(e,n)=>{const i=F(e);i.local&&(t.push(encodeURIComponent($(i.local))),t.push("@")),t.push(encodeURIComponent(i.domain)),n&&i.resource&&(t.push("/"),t.push(encodeURIComponent(i.resource)))};e.identity&&(t.push("//"),n(e.identity,!1),e.jid&&t.push("/")),e.jid&&n(e.jid,!0),e.action&&(t.push("?"),t.push(encodeURIComponent(e.action)));for(let[n,i]of Object.entries(e.parameters||{})){Array.isArray(i)||(i=[i]);for(const e of i)t.push(";"),t.push(encodeURIComponent(n)),void 0!==e&&(t.push("="),t.push(encodeURIComponent(e)))}return t.join("")}});!function(e){e.NotWellFormed="not-well-formed",e.RestrictedXML="restricted-xml",e.AlreadyClosed="already-closed",e.UnknownRoot="unknown-stream-root"}(V||(V={}));class H extends Error{constructor(e){super(e.text),this.isJXTError=!0,this.condition=e.condition,this.text=e.text}static notWellFormed(e){return new H({condition:V.NotWellFormed,text:e})}static restrictedXML(e){return new H({condition:V.RestrictedXML,text:e})}static alreadyClosed(e){return new H({condition:V.AlreadyClosed,text:e})}static unknownRoot(e){return new H({condition:V.UnknownRoot,text:e})}}const J={'"':"&quot;","&":"&amp;","'":"&apos;","<":"&lt;",">":"&gt;"},W={"&amp;":"&","&apos;":"'","&gt;":">","&lt;":"<","&quot;":'"'},Y=/&([a-zA-Z0-9]+|#[0-9]+|#x[0-9a-fA-F]+);/g,K=/&|<|>|"|'/g,X=/&|<|>/g;function Z(e){return J[e]}function ee(e){return e.replace(K,Z)}function te(e){return e.replace(Y,e=>(function(e){if(W[e])return W[e];const t=e.startsWith("&#x"),n=parseInt(e.substring(t?3:2,e.length-1),t?16:10);if(9===n||10===n||13===n||32<=n&&n<=55295||57344<=n&&n<=65533||65536<=n&&n<=1114111)return String.fromCodePoint(n);throw H.restrictedXML("Prohibited entity: "+e)})(e))}function ne(e){return e.replace(X,Z)}function ie(e,t=[],n=""){const i=new Set(e.map(e=>e.toLowerCase()));for(let e of t.map(e=>e.toLowerCase()))if("*"!==e)for(;e.length>0;){if(i.has(e))return e;(e=e.substring(0,e.lastIndexOf("-")).toLowerCase()).lastIndexOf("-")===e.length-2&&(e=e.substring(0,e.lastIndexOf("-")))}return n}class re{constructor(e,t={},n=[]){this.name=e,this.attributes=t,this.children=[],this.optionalNamespaces={};for(const e of n)if("string"!=typeof e){const t=new re(e.name,e.attributes,e.children);t.parent=this,this.children.push(t)}else this.children.push(e)}getName(){return this.name.indexOf(":")>=0?this.name.substr(this.name.indexOf(":")+1):this.name}getNamespace(){if(this.name.indexOf(":")>=0){const e=this.name.substr(0,this.name.indexOf(":"));return this.findNamespaceForPrefix(e)}return this.findNamespaceForPrefix()}getNamespaceContext(){let e={};this.parent&&(e=this.parent.getNamespaceContext());for(const[t,n]of Object.entries(this.attributes))if(t.startsWith("xmlns:")){const i=t.substr(6);e[n]=i}return e}getDefaultNamespace(){return this.attributes.xmlns?this.attributes.xmlns:this.parent?this.parent.getDefaultNamespace():""}getNamespaceRoot(e){if(this.parent){const t=this.parent.getNamespaceRoot(e);if(t)return t}for(const[t,n]of Object.entries(this.attributes))if(t.startsWith("xmlns:")&&n===e)return this;if(this.optionalNamespaces[e])return this}getAttribute(e,t){if(!t)return this.attributes[e];const n=this.getNamespaceContext();return n[t]?this.attributes[[n[t],e].join(":")]:void 0}getChild(e,t){return this.getChildren(e,t)[0]}getChildren(e,t){const n=[];for(const i of this.children)"string"==typeof i||i.getName()!==e||t&&i.getNamespace()!==t||n.push(i);return n}getText(){let e="";for(const t of this.children)"string"==typeof t&&(e+=t);return e}appendChild(e){return this.children.push(e),"string"!=typeof e&&(e.parent=this),e}setAttribute(e,t,n=!1){this.attributes[e]=t||void 0,""===t&&n&&(this.attributes[e]=t)}addOptionalNamespace(e,t){this.optionalNamespaces[t]=e}useNamespace(e,t){return this.optionalNamespaces[t]&&(e=this.optionalNamespaces[t]),this.setAttribute(`xmlns:${e}`,t),e}toJSON(){const e=this.children.map(e=>"string"==typeof e?e:e?e.toJSON():void 0).filter(e=>!!e),t={};for(const e of Object.keys(this.attributes))void 0!==this.attributes[e]&&null!==this.attributes[e]&&(t[e]=this.attributes[e]);return{attributes:t,children:e,name:this.name}}toString(){let e=this.openTag(!0);if(this.children.length){for(const t of this.children)"string"==typeof t?e+=ne(t):t&&(e+=t.toString());e+=this.closeTag()}return e}openTag(e=!1){let t="";t+=`<${this.name}`;for(const e of Object.keys(this.attributes)){const n=this.attributes[e];void 0!==n&&(t+=` ${e}="${ee(n.toString())}"`)}return e&&0===this.children.length?t+="/>":t+=">",t}closeTag(){return`</${this.name}>`}findNamespaceForPrefix(e){if(e){const t="xmlns:"+e;if(this.attributes[t])return this.attributes[t];if(this.parent)return this.parent.findNamespaceForPrefix(e)}else{if(this.attributes.xmlns)return this.attributes.xmlns;if(this.parent)return this.parent.findNamespaceForPrefix()}return""}}const se=new Set(["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul"]),ae=new Set(["style"]),oe=new Map([["a",new Set(["href","style"])],["body",new Set(["style","xml:lang"])],["blockquote",ae],["br",ae],["cite",ae],["em",ae],["img",new Set(["alt","height","src","style","width"])],["li",ae],["ol",ae],["p",ae],["span",ae],["strong",ae],["ul",ae]]),ce=new Map([["font-style",/normal|italic|oblique|inherit/i],["font-weight",/normal|bold|bolder|lighter|inherit|\d\d\d/i],["text-decoration",/none|underline|overline|line-through|blink|inherit/i]]),le=e=>!!e.match(/^(https?|xmpp|cid|mailto|ftps?|im|ircs?|sips?|tel|geo|bitcoin|magnet):/i)&&e,ue=e=>!!e.match(/^[0-9]*$/)&&e,pe={alt:e=>e,height:ue,href:le,src:le,style:e=>{const t=`;${e}`.replace(/\/\*[^*]*\*+([^\/*][^*]*\*+)*\//g,"").replace(/\/\*.*/,"").replace(/\\([a-fA-F0-9]{1,6})\s?/,(e,t)=>String.fromCharCode(parseInt(t,16))).match(/;\s*([a-z\-]+)\s*:\s*([^;]*[^\s;])\s*/g),n=[];if(!t)return!1;for(const e of t){const t=e.match(/^;\s*([a-z\-]+)\s*:\s*([^;]*[^\s])\s*$/);if(!t)continue;const i=ce.get(t[1]);if(i){const e=t[2].match(i);e&&n.push(`${t[1]}:${e[0]}`)}}return!!n.length&&n.join("")},width:ue},de=e=>{if("string"==typeof e)return;let t=[];for(const n of e.children){if(!n)continue;if("string"==typeof n){t.push(n);continue}const e=he(n);Array.isArray(e)?t=t.concat(e):e&&t.push(e)}const n={};return"body"===e.name?(void 0!==e.attributes.xmlns&&(n.xmlns=e.attributes.xmlns),e.attributes.style&&(n.style=e.attributes.style),void 0!==e.attributes["xml:lang"]&&(n["xml:lang"]=e.attributes["xml:lang"]),{attributes:n,children:t,name:"body"}):void 0},he=e=>{if("string"==typeof e)return e;if(!se.has(e.name)){if("script"===e.name)return;return(e=>{let t=[];for(const n of e.children)if("string"==typeof n)t.push(n);else if(n){const e=he(n);e&&(Array.isArray(e)?t=t.concat(e):t.push(e))}return t})(e)}const t=e.children.map(he).filter(e=>void 0!==e),n={};for(const t of Object.keys(e.attributes)){const i=oe.get(e.name);if(!i||!i.has(t))continue;let r=e.attributes[t];r&&((r=pe[t](r))&&(n[t]=r))}return{attributes:n,children:t,name:e.name}};function fe(e){return e>=32}function me(e){return 32===e||10===e||13===e||9===e}function ge(e,t={}){const n=new be(t);let i,r,s=null;if(n.on("text",e=>{r&&r.children.push(e)}),n.on("startElement",(e,t)=>{const n=new re(e,t);i||(i=n),r=r?r.appendChild(n):n}),n.on("endElement",e=>{r&&e===r.name?r.parent?r=r.parent:i||(i=r,r=void 0):n.emit("error",H.notWellFormed())}),n.on("error",e=>{s=e}),n.write(e),n.end(),s)throw s;return i}class be extends s.EventEmitter{constructor(e={}){super(),this.allowComments=!0,this.endTag=!1,this.recordStart=0,this.state=9,this.haveDeclaration=!1,void 0!==e.allowComments&&(this.allowComments=e.allowComments)}write(e){let t=0;for(this.remainder&&(e=this.remainder+e,t=void 0!==this.remainderPos?this.remainderPos:this.remainder.length,this.remainderPos=void 0,this.remainder=void 0);t<e.length;t++){const n=e.charCodeAt(t);switch(this.state){case 9:if(60===n){const n=this.endRecording(e,t);if(n){let e;try{e=te(n)}catch(e){return void this.emit("error",e)}this.emit("text",e)}this.state=8,this.recordStart=t+1,this.attributes={}}break;case 4:if(62===n&&this.lookBehindMatch(e,t,"]]")){const n=this.endRecording(e,t-2);n&&this.emit("text",n),this.state=9}break;case 8:if(47===n&&this.recordStart===t)this.recordStart=t+1,this.endTag=!0;else{if(33===n){if(this.allowComments){const n=this.lookAheadMatch(e,t,"--");if(1===n){this.recordStart=void 0,this.state=5;break}if(0===n)return void this.waitForData(e,t)}const n=this.lookAheadMatch(e,t,"[CDATA[");if(1===n){this.recordStart=t+8,this.state=4;break}return 0===n?void this.waitForData(e,t):void this.emit("error",H.restrictedXML())}if(63===n){if(this.recordStart=void 0,!this.haveDeclaration){const n=this.lookAheadMatch(e,t,"xml",!0);if(1===n){this.recordStart=t+4,this.state=10;break}if(0===n)return void this.waitForData(e,t)}return void this.emit("error",H.restrictedXML())}fe(n)&&!me(n)&&47!==n&&62!==n&&60!==n||(this.tagName=this.endRecording(e,t),t--,this.state=7)}break;case 5:62===n&&(this.lookBehindMatch(e,t,"--")||this.lookBehindMatch(e,t,"]]"))&&(this.state=9);break;case 10:if((120===n||88===n)&&this.lookBehindMatch(e,t,"?",!0))break;if((109===n||77===n)&&this.lookBehindMatch(e,t,"?x",!0))break;if((108===n||78===n)&&this.lookBehindMatch(e,t,"?xm",!0))break;if(me(n)){this.haveDeclaration=!0,this.state=6;break}return void this.emit("error",H.restrictedXML());case 6:62===n&&this.lookBehindMatch(e,t,"?")&&(this.state=9);break;case 7:62===n||60===n?(this.handleTagOpening(this.endTag,this.tagName,this.attributes),this.tagName=void 0,this.attributes=void 0,this.endTag=!1,this.selfClosing=!1,this.state=9,this.recordStart=t+1):47===n?this.selfClosing=!0:fe(n)&&32!==n&&(this.recordStart=t,this.state=1);break;case 1:fe(n)&&!me(n)&&61!==n||(this.attributeName=this.endRecording(e,t),61===n?this.state=2:(t--,this.state=0));break;case 0:if(me(n))break;if(61===n){this.state=2;break}return void this.emit("error",H.notWellFormed());case 2:if(me(n))break;if(34===n||39===n){this.attributeQuote=n,this.state=3,this.recordStart=t+1;break}return void this.emit("error",H.notWellFormed());case 3:if(n===this.attributeQuote){let n;try{n=te(this.endRecording(e,t))}catch(e){return void this.emit("error",e)}if(void 0!==this.attributes[this.attributeName])return void this.emit("error",H.notWellFormed());this.attributes[this.attributeName]=n,this.attributeName=void 0,this.state=7}}}void 0!==this.recordStart&&this.recordStart<=e.length&&(this.remainder=e.slice(this.recordStart),this.recordStart=0)}end(e){e&&this.write(e),this.write=()=>void 0}endRecording(e,t){if(void 0!==this.recordStart){const n=e.slice(this.recordStart,t);return this.recordStart=void 0,n}return""}handleTagOpening(e,t,n){e?this.emit("endElement",t):(this.emit("startElement",t,n),this.selfClosing&&this.emit("endElement",t))}waitForData(e,t){this.remainder=e.substr(t),this.remainderPos=t}lookAheadMatch(e,t,n,i=!1){const r=n.length;let s=e.substr(t+1,r);return i&&(s=s.toLowerCase()),s.length===r&&s===n?1:s.length<r&&n.startsWith(s)?0:-1}lookBehindMatch(e,t,n,i=!1){return!(t-n.length<0)&&(i?e.substr(t-n.length,n.length).toLowerCase()===n:e.substr(t-n.length,n.length)===n)}}function ye(e,t,n,i){if(i){e=e||i.getNamespace();const n=i.getNamespaceRoot(e);if(n){t=`${n.useNamespace("",e)}:${t}`}}const r=new re(t);return t.indexOf(":")<0&&(!n||e!==n)&&r.setAttribute("xmlns",e),r}function ve(e,t){return(e.getAttribute("xml:lang")||t||"").toLowerCase()}function we(e,t){const n=[];for(const i of e)n.push(ve(i,t.lang));let i;return(i=t.resolveLanguage?t.resolveLanguage(n,t.acceptLanguages||[],t.lang):t.lang)||""}function _e(e,t,n,i){const r=e.getChildren(n,t),s=ve(e);return r.length?i?r.filter(e=>{if(ve(e,s)===i)return!0}):r:[]}function Se(e,t,n,i){t=t||e.getNamespace();const r=_e(e,t,n,i);if(r.length)return r[0];const s=ye(t,n,e.getDefaultNamespace(),e),a=ve(e,i);return i&&a!==i&&s.setAttribute("xml:lang",i),e.appendChild(s),s}function xe(e){return{importer(t){const n=t.getAttribute(e.name,e.namespace);return n?e.parseValue(n):e.dynamicDefault?e.dynamicDefault(n):e.staticDefault},exporter(t,n){if(void 0===n)return;const i=e.writeValue(n);if(i||e.emitEmpty)if(e.namespace&&e.prefix){let n;const r=t.getNamespaceRoot(e.namespace);if(r)n=r.useNamespace(e.prefix,e.namespace);else{const i=t.getNamespaceContext();i[e.namespace]||(n=t.useNamespace(e.prefix,e.namespace),i[e.namespace]=n)}t.setAttribute(`${n}:${e.name}`,i,e.emitEmpty)}else t.setAttribute(e.name,i,e.emitEmpty)}}}function je(e,t){return(n,i,r={})=>(r=Object.assign({staticDefault:i},r),xe(Object.assign(Object.assign({name:n},e),t?t(r):r)))}function ke(e,t){return(n,i,r,s,a={})=>(a=Object.assign({staticDefault:s},a),xe(Object.assign(Object.assign({name:r,namespace:i,prefix:n},e),t?t(a):a)))}function Te(e){const t=e.converter||xe(Object.assign(Object.assign({},e),{namespace:e.attributeNamespace}));return{importer(n,i){const r=n.getChild(e.element,e.namespace||n.getNamespace());return r?t.importer(r,i):e.dynamicDefault?e.dynamicDefault():e.staticDefault},exporter(n,i,r){if(void 0!==i){const s=Se(n,e.namespace||n.getNamespace(),e.element);t.exporter(s,i,r)}}}}function Ie(e,t){return(n,i,r,s,a={})=>(a=Object.assign({staticDefault:s},a),Te(Object.assign(Object.assign({element:i,name:r,namespace:n},e),t?t(a):a)))}function Ee(e){return{importer(t){const n=t.getText();return n?e.parseValue(n):e.dynamicDefault?e.dynamicDefault(n):e.staticDefault},exporter(t,n){if(void 0===n)return;const i=e.writeValue(n);i&&t.children.push(i)}}}function Oe(e){const t=Ee(e);return{importer(n,i){const r=_e(n,e.namespace||n.getNamespace(),e.element),s=we(r,i);if(!r.length)return e.dynamicDefault?e.dynamicDefault():e.staticDefault;if(e.matchLanguage)for(const e of r)if(ve(e,i.lang)===s)return t.importer(e,i);return t.importer(r[0],i)},exporter(n,i,r){if(void 0!==i){const s=Se(n,e.namespace||n.getNamespace(),e.element,e.matchLanguage?r.lang:void 0);t.exporter(s,i,r)}}}}const Ce={parseValue:e=>e,writeValue:e=>e},Re={parseValue:e=>parseInt(e,10),writeValue:e=>e.toString()},qe={parseValue:e=>parseFloat(e),writeValue:e=>e.toString()},Ne={parseValue:e=>"true"===e||"1"===e||"false"!==e&&"0"!==e&&void 0,writeValue:e=>e?"1":"0"},Ae={parseValue:e=>new Date(e),writeValue:e=>"string"==typeof e?e:e.toISOString()},Pe={parseValue:e=>JSON.parse(e),writeValue:e=>JSON.stringify(e)},Fe=(t="utf8")=>({parseValue:n=>("base64"===t&&"="===n&&(n=""),e.from(n.trim(),t)),writeValue:n=>{let i;return i="string"==typeof n?e.from(n).toString(t):n?n.toString(t):"","base64"===t&&(i=i||"="),i}}),Me={parseValue:e=>{let t=-1;"-"===e.charAt(0)&&(t=1,e=e.slice(1));const n=e.split(":");return(60*parseInt(n[0],10)+parseInt(n[1],10))*t},writeValue:e=>{if("string"==typeof e)return e;{let t="-";e<0&&(e=-e,t="+");const n=e/60,i=e%60;return t+=(n<10?"0":"")+n+":"+(i<10?"0":"")+i}}},Le=je(Ce,e=>Object.assign({dynamicDefault:e.emitEmpty?t=>""===t?"":e.staticDefault:void 0},e)),De=je(Ne),Be=je(Re),Ue=je(qe),ze=je(Ae),$e=ke(Ce),Qe=ke(Ne),Ve=ke(Re),Ge=ke(qe),He=ke(Ae),Je=Ie(Ce),We=Ie(Ne),Ye=Ie(Re),Ke=Ie(qe),Xe=Ie(Ae),Ze=e=>Ee(Object.assign({staticDefault:e},Ce)),et=(e="utf8")=>Ee(Object.assign({},Fe(e)));function tt(){return{importer:(e,t)=>ve(e,t.lang),exporter(e,t,n){t&&t.toLowerCase()!==n.lang?e.setAttribute("xml:lang",t):e.setAttribute("xml:lang",void 0)}}}const nt=(e,t,n)=>Oe(Object.assign({element:t,matchLanguage:!0,namespace:e,staticDefault:n},Ce)),it=(e,t,n="utf8")=>Oe(Object.assign({element:t,matchLanguage:!0,namespace:e},Fe(n))),rt=(e,t)=>Oe(Object.assign({element:t,namespace:e},Ae)),st=(e,t,n)=>Oe(Object.assign({element:t,namespace:e,staticDefault:n},Re)),at=(e,t,n)=>Oe(Object.assign({element:t,namespace:e,staticDefault:n},qe)),ot=(e,t)=>Oe(Object.assign({element:t,namespace:e},Pe));function ct(e,t){return Oe(Object.assign({element:t,namespace:e,staticDefault:0},Me))}function lt(e,t){return{importer(n){if(n.getChild(t,e||n.getNamespace()))return!0},exporter(n,i){i&&Se(n,e||n.getNamespace(),t)}}}const ut=(e,t,n)=>{if(!n)return;let i=t;for(const t of e)i=Se(i,t.namespace||i.getNamespace(),t.element);i.children.push(n.toString())};function pt(e,t){return{importer(n){let i=n;for(const n of e)if(!(i=i.getChild(n.element,n.namespace||i.getNamespace())))return t;return i.getText()||t},exporter(t,n){ut(e,t,n)}}}function dt(e,t){return{importer(n){let i=n;for(const t of e)if(!(i=i.getChild(t.element,t.namespace||i.getNamespace())))return;const r=i.getText();return r?parseInt(r,10):t||void 0},exporter(t,n){ut(e,t,n)}}}function ht(e){return{importer(t){let n=t;for(const t of e)if(!(n=n.getChild(t.element,t.namespace||n.getNamespace())))return!1;return!0},exporter(t,n){if(!n)return;let i=t;for(const t of e)i=Se(i,t.namespace||i.getNamespace(),t.element)}}}function ft(e,t,n){const i=new Map,r=new Map;for(const e of t)"string"==typeof e?(i.set(e,e),r.set(e,e)):(i.set(e[1],e[0]),r.set(e[0],e[1]));return{importer(t){for(const n of t.children)if("string"!=typeof n&&n.getNamespace()===(e||t.getNamespace())&&i.has(n.getName()))return i.get(n.getName());return n},exporter(t,n){Se(t,e,r.get(n))}}}function mt(e,t,n,i){const r=new Set(t),s=new Set(n);return{importer(t){for(const n of t.children)if("string"!=typeof n&&n.getNamespace()===(e||t.getNamespace())&&r.has(n.getName())){for(const i of n.children)if("string"!=typeof i&&i.getNamespace()===(e||t.getNamespace())&&s.has(i.getName()))return[n.getName(),i.getName()];return[n.getName()]}return i},exporter(t,n){const i=Se(t,e,n[0]);n[1]&&Se(i,e,n[1])}}}function gt(e,t){return{importer(n,i){const r=[],s=_e(n,e||n.getNamespace(),t),a=we(s,i);for(const e of s)ve(e,i.lang)===a&&r.push(e.getText());return r},exporter(n,i,r){for(const s of i){const i=ye(e||n.getNamespace(),t,r.namespace,n);i.children.push(s),n.appendChild(i)}}}}function bt(e,t,n){return{importer(i){const r=[],s=i.getChildren(t,e||i.getNamespace());for(const e of s){const t=e.getAttribute(n);void 0!==t&&r.push(t)}return r},exporter(i,r,s){for(const a of r){const r=ye(e||i.getNamespace(),t,s.namespace,i);r.setAttribute(n,a),i.appendChild(r)}}}}function yt(e,t,n){return{importer(i){const r=[],s=i.getChildren(t,e||i.getNamespace());for(const e of s){const t=e.getAttribute(n);void 0!==t&&r.push(parseInt(t,10))}return r},exporter(i,r,s){for(const a of r){const r=ye(e||i.getNamespace(),t,s.namespace,i);r.setAttribute(n,a.toString()),i.appendChild(r)}}}}function vt(e,t){return{importer(n,i){const r=[],s=_e(n,e||n.getNamespace(),t),a=new Set;for(const e of s){const t=e.getText();if(t){const n=ve(e,i.lang);if(a.has(n))continue;r.push({lang:n,value:t}),a.add(n)}}return a.size>0?r:void 0},exporter(n,i,r){for(const s of i){const i=s.value;if(i){const a=ye(e||n.getNamespace(),t,r.namespace,n);s.lang!==r.lang&&a.setAttribute("xml:lang",s.lang),a.children.push(i),n.appendChild(a)}}}}}function wt(e,t){const n=new Map,i=new Map;for(const e of t)"string"==typeof e?(n.set(e,e),i.set(e,e)):(n.set(e[1],e[0]),i.set(e[0],e[1]));return{importer(t){const i=[];for(const r of t.children)"string"!=typeof r&&r.getNamespace()===(e||t.getNamespace())&&n.has(r.getName())&&i.push(n.get(r.getName()));return i},exporter(t,n){for(const r of n)Se(t,e,i.get(r))}}}function _t(e,t,n,i=!1){return{importer(r,s){const a=r.getChild(t,e||r.getNamespace());if(!a)return;const o=[];for(const e of a.children)if("string"!=typeof e&&s.registry.getImportKey(e)===n){const t=s.registry.import(e);t&&o.push(t)}return i?o:o[0]},exporter(i,r,s){let a=[];a=Array.isArray(r)?r:[r];const o=[];for(const t of a){const r=s.registry.export(n,t,Object.assign(Object.assign({},s),{namespace:e||i.getNamespace()||void 0}));r&&o.push(r)}if(o.length){const n=Se(i,e||i.getNamespace(),t);for(const e of o)n.appendChild(e)}}}}function St(e){return{exporter:()=>void 0,importer:()=>e}}function xt(e,t,n){return{importer(i,r){if(n&&(!r.sanitizers||!r.sanitizers[n]))return;const s=_e(i,e||i.getNamespace(),t),a=we(s,r);for(const e of s)if(ve(e,r.lang)===a)return n?r.sanitizers[n](e.toJSON()):e.toJSON();return s[0]?n?r.sanitizers[n](s[0].toJSON()):s[0].toJSON():void 0},exporter(i,r,s){if("string"==typeof r){r=ge(`<${t} xmlns="${e||i.getNamespace()}">${r}</${t}>`).toJSON()}if(r&&n){if(!s.sanitizers||!s.sanitizers[n])return;r=s.sanitizers[n](r)}if(!r)return;const a=Se(i,e||i.getNamespace(),t,s.lang);for(const e of r.children)"string"==typeof e?a.appendChild(e):e&&a.appendChild(new re(e.name,e.attributes,e.children))}}}function jt(e,t,n){return{importer(i,r){if(n&&(!r.sanitizers||!r.sanitizers[n]))return;const s=[],a=new Set,o=_e(i,e||i.getNamespace(),t);for(const e of o){let t=e.toJSON();if(n&&(t=r.sanitizers[n](t)),t){const n=ve(e,r.lang);if(a.has(n))continue;s.push({lang:n,value:t}),a.add(n)}}return a.size>0?s:void 0},exporter(i,r,s){for(const a of r){let r=a.value;if("string"==typeof r){r=ge(`<${t} xmlns="${e||i.getNamespace()}">${r}</${t}>`).toJSON()}if(r&&n){if(!s.sanitizers||!s.sanitizers[n])continue;r=s.sanitizers[n](r)}if(r){const n=ye(e||i.getNamespace(),t,s.namespace,i);i.appendChild(n),a.lang!==s.lang&&n.setAttribute("xml:lang",a.lang);for(const e of r.children)"string"==typeof e?n.appendChild(e):n.appendChild(new re(e.name,e.attributes,e.children))}}}}}function kt(e,t,n,i){return{importer(r,s){const a={},o=_e(r,e,t),c=Le(n).importer,l=Le(i).importer;for(const e of o)a[c(e,s)]=l(e,s);return a},exporter(r,s,a){const o=Le(n).exporter,c=Le(i).exporter,l=e||r.getNamespace();for(const[e,n]of Object.entries(s)){const i=ye(l,t,a.namespace,r);o(i,e,a),s[e]&&c(i,n,a),r.appendChild(i)}}}}class Tt{constructor(){this.parents=new Set,this.placeholder=!1,this.typeField="",this.defaultType="",this.languageField="lang",this.typeValues=new Map,this.typeOrders=new Map,this.importers=new Map,this.exporters=new Map,this.children=new Map,this.childrenIndex=new Map,this.implicitChildren=new Set,this.contexts=new Map}addChild(e,t,n=!1,i,r){const s={multiple:n||!1,name:e,selector:i,translator:t},a=this.children.get(e);if(!a){s.translator.parents.add(this),this.children.set(e,s);for(const[n]of t.importers)this.implicitChildren.has(n)||this.childrenIndex.set(n,e);return void(r&&this.implicitChildren.add(r))}const o=a.translator;a.multiple=n,i&&a.selector&&i!==a.selector&&(a.selector=void 0);for(const[n,i]of t.importers)o.updateDefinition({contexts:t.contexts,element:i.element,exporterOrdering:new Map,exporters:new Map,importerOrdering:i.fieldOrders,importers:i.fields,namespace:i.namespace,optionalNamespaces:new Map,type:o.typeValues.get(n)}),this.implicitChildren.has(n)||this.childrenIndex.set(n,e);for(const[e,n]of t.exporters)o.updateDefinition({contexts:t.contexts,element:n.element,exporterOrdering:n.fieldOrders,exporters:n.fields,importerOrdering:new Map,importers:new Map,namespace:n.namespace,optionalNamespaces:n.optionalNamespaces,type:e})}addContext(e,t,n,i,r,s=!1){t&&(e=`${e}[${t}]`);let a=this.contexts.get(e);a||(a={typeField:"",typeValues:new Map}),s&&(a.impliedType=r),a.typeField=n||"",a.typeValues.set(i,r),this.contexts.set(e,a)}getChild(e){const t=this.children.get(e);if(t)return t.translator}getImportKey(e){return this.childrenIndex.get(`{${e.getNamespace()}}${e.getName()}`)}updateDefinition(e){const t=`{${e.namespace}}${e.element}`,n=this.importers.get(t)||{element:e.element,fieldOrders:new Map,fields:new Map,namespace:e.namespace};for(const[t,i]of e.importers)n.fields.set(t,i);for(const[t,i]of e.importerOrdering)n.fieldOrders.set(t,i);this.importers.set(t,n);const i=this.exporters.get(e.type||this.defaultType)||{element:e.element,fieldOrders:new Map,fields:new Map,namespace:e.namespace,optionalNamespaces:e.optionalNamespaces};for(const[t,n]of e.exporters)i.fields.set(t,n);for(const[t,n]of e.exporterOrdering)i.fieldOrders.set(t,n);for(const[t,n]of e.optionalNamespaces)i.optionalNamespaces.set(t,n);this.exporters.set(e.type||this.defaultType,i);for(const[t,n]of e.contexts){const e=this.contexts.get(t)||{impliedType:void 0,typeField:n.typeField,typeValues:new Map};e.typeField||(e.typeField=n.typeField),e.impliedType||(e.impliedType=n.impliedType);for(const[t,i]of n.typeValues)e.typeValues.set(t,i);this.contexts.set(t,e)}if(e.type)this.typeValues.set(t,e.type),e.typeOrder&&this.typeOrders.set(e.type,e.typeOrder);else if(this.typeField&&!e.type){for(const[,t]of this.importers){for(const[n,i]of e.importers)t.fields.set(n,i);for(const[n,i]of e.importerOrdering)t.fieldOrders.set(n,i)}for(const[,t]of this.exporters){for(const[n,i]of e.exporters)t.fields.set(n,i);for(const[n,i]of e.exporterOrdering)t.fieldOrders.set(n,i)}}}replaceWith(e){for(const[t,n]of this.children)e.children.set(t,n);for(const[t,n]of this.childrenIndex)e.childrenIndex.set(t,n);for(const[t,n]of this.contexts)e.contexts.set(t,n);for(const t of this.implicitChildren)e.implicitChildren.add(t);for(const t of this.parents)for(const n of t.children.values())n.translator===this&&(n.translator=e);this.parents=new Set}import(e,t){const n=`{${e.getNamespace()}}${e.getName()}`,i={},r=this.importers.get(n);if(!r)return;const s=this.typeValues.get(n),a=t.path||"";let o;if(t.pathSelector&&(o=this.contexts.get(`${a}[${t.pathSelector}]`)),o||(o=this.contexts.get(a)),o){if(!o.impliedType){const e=o.typeValues.get(n);e&&(i[o.typeField]=e)}}else this.typeField&&s&&s!==this.defaultType&&(i[this.typeField]=s);const c=Object.assign(Object.assign({},t),{data:i,importer:r,lang:(e.getAttribute("xml:lang")||t.lang||"").toLowerCase(),pathSelector:s,translator:this}),l=[...r.fieldOrders.entries()].sort((e,t)=>e[1]>t[1]?-1:e[1]<t[1]?1:0),u=l.filter(e=>e[1]>=0),p=l.filter(e=>e[1]<0);for(const[n]of u){const s=r.fields.get(n);c.path=`${t.path}.${n}`;const a=s(e,c);null!=a&&(i[n]=a)}for(const n of e.children){if("string"==typeof n)continue;const e=`{${n.getNamespace()}}${n.getName()}`,r=this.childrenIndex.get(e);if(!r)continue;c.path=`${t.path}.${r}`;const{translator:a,multiple:o,selector:l}=this.children.get(r);if(!l||l===s){const e=a.import(n,c);void 0!==e&&(o?(i[r]||(i[r]=[]),i[r].push(e)):i[r]?i[r]=a.resolveCollision(i[r],e):i[r]=e)}}for(const[n]of p){const s=r.fields.get(n);c.path=`${t.path}.${n}`;const a=s(e,c);null!=a&&(i[n]=a)}return i}export(e,t){if(!e)return;let n=this.defaultType;const i=t.path||"";let r;t.pathSelector&&(r=this.contexts.get(`${i}[${t.pathSelector}]`)),r||(r=this.contexts.get(i)),r?n=r.impliedType||e[r.typeField]||this.defaultType:this.typeField&&(n=e[this.typeField]||this.defaultType);const s=this.exporters.get(n);if(!s)return;const a=ye(s.namespace,s.element,t.namespace,t.element);t.element&&(a.parent=t.element);for(const[e,t]of s.optionalNamespaces)a.addOptionalNamespace(e,t);const o=Object.assign(Object.assign({},t),{data:e,element:a,exporter:s,lang:(e[this.languageField]||t.lang||"").toLowerCase(),namespace:a.getDefaultNamespace(),pathSelector:n,translator:this}),c=s.fields.get(this.languageField);c&&c(a,e[this.languageField],t);const l=Object.keys(e);l.sort((e,t)=>{return(s.fieldOrders.get(e)||1e5)-(s.fieldOrders.get(t)||1e5)});for(const i of l){if(i===this.languageField)continue;const r=e[i],c=s.fields.get(i);if(c){c(a,r,o);continue}const l=this.children.get(i);if(!l)continue;o.path=`${t.path?t.path+".":""}${i}`;const{translator:u,multiple:p,selector:d}=l;if(!d||d===n){let e;e=p?r:[r];for(const t of e){const e=u.export(t,o);e&&a.appendChild(e)}}}return a}resolveCollision(e,t){return(this.typeOrders.get(e[this.typeField]||this.defaultType)||0)<=(this.typeOrders.get(t[this.typeField]||this.defaultType)||0)?e:t}}class It{constructor(){this.languageResolver=ie,this.translators=new Map,this.root=new Tt}setLanguageResolver(e){this.languageResolver=e}import(e,t={registry:this}){if(!this.hasTranslator(e.getNamespace(),e.getName()))return;return t.acceptLanguages?t.acceptLanguages=t.acceptLanguages.map(e=>e.toLowerCase()):t.acceptLanguages=[],t.lang&&(t.lang=t.lang.toLowerCase()),t.resolveLanguage||(t.resolveLanguage=this.languageResolver),t.path=this.getImportKey(e),t.sanitizers||(t.sanitizers={xhtmlim:de}),this.getOrCreateTranslator(e.getNamespace(),e.getName()).import(e,Object.assign(Object.assign({},t),{registry:this}))}export(e,t,n={registry:this}){n.acceptLanguages?n.acceptLanguages=n.acceptLanguages.map(e=>e.toLowerCase()):n.acceptLanguages=[],n.lang&&(n.lang=n.lang.toLowerCase()),n.sanitizers||(n.sanitizers={xhtmlim:de}),n.path=e;const i=e.split(".").filter(e=>""!==e);let r=this.root;for(const e of i){const t=r.getChild(e);if(!t)return;r=t}return r.export(t,Object.assign(Object.assign({},n),{registry:this}))}getImportKey(e,t=""){const n=t?this.walkToTranslator(t.split(".")):this.root;if(n)return n.getImportKey(e)}define(e){if(Array.isArray(e)){for(const t of e)"object"==typeof t?this.define(t):t(this);return}if("object"!=typeof e)return void e(this);const t=e;t.aliases=t.aliases||[],t.path&&!t.aliases.includes(t.path)&&t.aliases.push(t.path);const n=t.aliases.map(e=>"string"==typeof e?{path:e}:e).sort((e,t)=>{const n=e.path.split(".").length;return t.path.split(".").length-n});let i;if(this.hasTranslator(t.namespace,t.element)&&(i=this.getOrCreateTranslator(t.namespace,t.element)),!i){let e;for(const t of n){const n=this.walkToTranslator(t.path.split("."));if(n&&!n.placeholder){i=n;break}n&&(e=n)}e&&!i&&((i=e).placeholder=!1)}i||(i=this.getOrCreateTranslator(t.namespace,t.element)),this.indexTranslator(t.namespace,t.element,i);const r=t.fields||{},s=new Map,a=new Map,o=new Map,c=new Map;t.typeField&&(i.typeField=t.typeField),t.defaultType&&(i.defaultType=t.defaultType),t.languageField&&(i.languageField=t.languageField);for(const e of Object.keys(r)){const t=r[e];s.set(e,t.importer),o.set(e,t.importOrder||t.order||0),a.set(e,t.exporter),c.set(e,t.exportOrder||t.order||0)}if(t.childrenExportOrder)for(const[e,n]of Object.entries(t.childrenExportOrder))c.set(e,n||0);const l=new Map;for(const[e,n]of Object.entries(t.optionalNamespaces||{}))l.set(e,n);i.updateDefinition({contexts:new Map,element:t.element,exporterOrdering:c,exporters:a,importerOrdering:o,importers:s,namespace:t.namespace,optionalNamespaces:l,type:t.type,typeOrder:t.typeOrder});for(const e of n)"string"==typeof e?this.alias(t.namespace,t.element,e):this.alias(t.namespace,t.element,e.path,e.multiple,e.selector,e.contextField,t.type,e.impliedType);for(const e of n){const t=this.walkToTranslator(e.path.split("."));t&&t!==i&&t.replaceWith(i)}}alias(e,t,n,i=!1,r,s,a,o=!1){const c=this.getOrCreateTranslator(e,t);c.placeholder=!1;const l=n.split(".").filter(e=>""!==e),u=l.pop(),p=this.walkToTranslator(l,!0),d=`{${e}}${t}`;a&&(s||o)&&c.addContext(n,r,s,d,a,o),p.addChild(u,c,i,r,d)}walkToTranslator(e,t=!1){let n=this.root;for(const i of e){let e=n.getChild(i);if(!e){if(!t)return;(e=new Tt).placeholder=!0,n.addChild(i,e)}n=e}return n}hasTranslator(e,t){return this.translators.has(`{${e}}${t}`)}getOrCreateTranslator(e,t){let n=this.translators.get(`{${e}}${t}`);return n||(n=new Tt,this.indexTranslator(e,t,n)),n}indexTranslator(e,t,n){this.translators.set(`{${e}}${t}`,n)}}const Et="urn:ietf:params:xml:ns:xmpp-bind",Ot="jabber:client",Ct="urn:ietf:params:xml:ns:xmpp-sasl",Rt="urn:ietf:params:xml:ns:xmpp-session",qt="urn:ietf:params:xml:ns:xmpp-stanzas",Nt="http://etherx.jabber.org/streams",At="urn:ietf:params:xml:ns:xmpp-streams",Pt="urn:ietf:params:xml:ns:xmpp-tls",Ft="urn:ietf:params:xml:ns:xmpp-framing",Mt="jabber:x:data",Lt="jabber:iq:privacy",Dt="http://jabber.org/protocol/disco#info",Bt="http://jabber.org/protocol/disco#items",Ut="http://jabber.org/protocol/address",zt="http://jabber.org/protocol/muc",$t="http://jabber.org/protocol/muc#admin",Qt="http://jabber.org/protocol/muc#owner",Vt="http://jabber.org/protocol/muc#user",Gt="http://jabber.org/protocol/ibb",Ht="http://jabber.org/protocol/commands",Jt="vcard-temp",Wt="http://jabber.org/protocol/rsm",Yt="http://jabber.org/protocol/pubsub",Kt="http://jabber.org/protocol/pubsub#errors",Xt="http://jabber.org/protocol/pubsub#event",Zt="http://jabber.org/protocol/pubsub#owner",en="http://jabber.org/protocol/bytestreams",tn="jabber:x:oob",nn="http://www.w3.org/1999/xhtml",rn="http://jabber.org/protocol/xhtml-im",sn="http://jabber.org/protocol/geoloc",an="urn:xmpp:avatar:data",on="urn:xmpp:avatar:metadata",cn="http://jabber.org/protocol/chatstates",ln="jabber:iq:version",un="http://jabber.org/protocol/mood",pn="http://jabber.org/protocol/activity",dn="http://jabber.org/protocol/tune",hn="http://jabber.org/protocol/xdata-validate",fn="http://jabber.org/protocol/httpbind",mn="http://jabber.org/protocol/shim",gn="http://jabber.org/protocol/compress",bn="http://jabber.org/protocol/xdata-layout",yn="http://jabber.org/protocol/rosterx",vn="urn:xmpp:alt-connections:websocket",wn="urn:xmpp:alt-connections:xbosh",_n=e=>`${e}+notify`,Sn="urn:xmpp:jingle:1",xn="urn:xmpp:jingle:apps:rtp:1",jn="urn:xmpp:jingle:apps:rtp:info:1",kn="urn:xmpp:jingle:apps:rtp:audio",Tn="urn:xmpp:jingle:apps:rtp:video",In="http://jabber.org/protocol/nick",En="urn:xmpp:jingle:transports:ice-udp:1",On="urn:xmpp:jingle:transports:raw-udp:1",Cn="urn:xmpp:receipts",Rn="urn:xmpp:sm:3",qn="urn:xmpp:ping",Nn="urn:xmpp:time",An="urn:xmpp:delay",Pn="urn:xmpp:media-element",Fn="urn:xmpp:attention:0",Mn="urn:xmpp:bob",Ln="urn:xmpp:jingle:apps:file-transfer:3",Dn="urn:xmpp:jingle:apps:file-transfer:5",Bn="urn:xmpp:jingle:apps:xmlstream:0",Un="jabber:x:conference",zn="urn:xmpp:jingle:transports:s5b:1",$n="urn:xmpp:jingle:transports:ibb:1",Qn="urn:xmpp:carbons:2",Vn="urn:xmpp:jingle:apps:rtp:rtcp-fb:0",Gn="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",Hn="urn:xmpp:forward:0",Jn="urn:xmpp:hashes:1",Wn="urn:xmpp:hashes:2",Yn=e=>`urn:xmpp:hash-function-text-names:${e}`,Kn="urn:xmpp:rtt:0",Xn="urn:xmpp:message-correct:0",Zn="urn:xmpp:psa",ei="urn:xmpp:mam:2",ti="urn:xmpp:hats:0",ni="urn:xmpp:idle:1",ii="urn:xmpp:jingle:apps:dtls:0",ri="urn:xmpp:chat-markers:0",si="urn:xmpp:hints",ai="urn:xmpp:json:0",oi="urn:xmpp:jingle:apps:grouping:0",ci="urn:xmpp:jingle:apps:rtp:ssma:0",li="urn:xmpp:jingle:transports:dtls-sctp:1",ui="urn:xmpp:push:0",pi="urn:xmpp:http:upload:0",di="urn:xmpp:jingle:transports:ice:0",hi="urn:xmpp:reference:0",fi="urn:xmpp:eme:0",mi="eu.siacs.conversations.axolotl",gi="http://docs.oasis-open.org/ns/xri/xrd-1.0";var bi=Object.freeze({__proto__:null,NS_BIND:Et,NS_CLIENT:Ot,NS_SASL:Ct,NS_SERVER:"jabber:server",NS_SESSION:Rt,NS_STANZAS:qt,NS_STREAM:Nt,NS_STREAMS:At,NS_STARTTLS:Pt,NS_ROSTER:"jabber:iq:roster",NS_ROSTER_VERSIONING:"urn:xmpp:features:rosterver",NS_SUBSCRIPTION_PREAPPROVAL:"urn:xmpp:features:pre-approval",NS_FRAMING:Ft,NS_DATAFORM:Mt,NS_RPC:"jabber:iq:rpc",NS_LAST_ACTIVITY:"jabber:iq:last",NS_PRIVACY:Lt,NS_LEGACY_CHAT_EVENTS:"jabber:x:event",NS_DISCO_INFO:Dt,NS_DISCO_ITEMS:Bt,NS_ADDRESS:Ut,NS_MUC:zt,NS_MUC_ADMIN:$t,NS_MUC_OWNER:Qt,NS_MUC_USER:Vt,NS_IBB:Gt,NS_BOOKMARKS:"storage:bookmarks",NS_PRIVATE:"jabber:iq:private",NS_ADHOC_COMMANDS:Ht,NS_VCARD_TEMP:Jt,NS_SEARCH:"jabber:iq:search",NS_RSM:Wt,NS_PUBSUB:Yt,NS_PUBSUB_ERRORS:Kt,NS_PUBSUB_EVENT:Xt,NS_PUBSUB_OWNER:Zt,NS_SOCKS5:en,NS_OOB:tn,NS_OOB_TRANSFER:"jabber:iq:oob",NS_HTTP_AUTH:"http://jabber.org/protocol/http-auth",NS_XHTML:nn,NS_XHTML_IM:rn,NS_REGISTER:"jabber:iq:register",NS_INBAND_REGISTRATION:"http://jabber.org/features/iq-register",NS_AMP:"http://jabber.org/protocol/amp",NS_GEOLOC:sn,NS_ROSTER_DELIMITER:"roster:delimiter",NS_AVATAR_DATA:an,NS_AVATAR_METADATA:on,NS_CHAT_STATES:cn,NS_VERSION:ln,NS_MOOD:un,NS_ACTIVITY:pn,NS_COMPONENT:"jabber:component:accept",NS_DISCO_LEGACY_CAPS:"http://jabber.org/protocol/caps",NS_TUNE:dn,NS_DATAFORM_VALIDATION:hn,NS_BOSH:fn,NS_SHIM:mn,NS_COMPRESSION_FEATURE:"http://jabber.org/features/compress",NS_COMPRESSION:gn,NS_DATAFORM_LAYOUT:bn,NS_ROSTER_EXCHANGE:yn,NS_ROSTER_NOTES:"storage:rosternotes",NS_REACH_0:"urn:xmpp:reach:0",NS_VCARD_TEMP_UPDATE:"vcard-temp:x:update",NS_ALT_CONNECTIONS_WEBSOCKET:vn,NS_ALT_CONNECTIONS_XBOSH:wn,NS_CAPTCHA:"urn:xmpp:captcha",NS_PEP_NOTIFY:_n,NS_JINGLE_1:Sn,NS_JINGLE_ERRORS_1:"urn:xmpp:jingle:errors:1",NS_JINGLE_RTP_1:xn,NS_JINGLE_RTP_ERRORS_1:"urn:xmpp:jingle:apps:rtp:errors:1",NS_JINGLE_RTP_INFO_1:jn,NS_JINGLE_RTP_AUDIO:kn,NS_JINGLE_RTP_VIDEO:Tn,NS_LANG_TRANS:"urn:xmpp:langtrans",NS_LANG_TRANS_ITEMS:"urn:xmpp:langtrans:items",NS_NICK:In,NS_JINGLE_ICE_UDP_1:En,NS_JINGLE_RAW_UDP_1:On,NS_RECEIPTS:Cn,NS_INVISIBLE_0:"urn:xmpp:invisible:0",NS_BLOCKING:"urn:xmpp:blocking",NS_BLOCKING_ERRORS:"urn:xmpp:blocking:errors",NS_SMACKS_3:Rn,NS_PING:qn,NS_TIME:Nn,NS_DELAY:An,NS_BOSH_XMPP:"urn:xmpp:xbosh",NS_DISCO_EXTERNAL_1:"urn:xmpp:extdisco:1",NS_DATAFORM_MEDIA:Pn,NS_ATTENTION_0:Fn,NS_BOB:Mn,NS_SOFTWARE_INFO:"urn:xmpp:dataforms:softwareinfo",NS_JINGLE_FILE_TRANSFER_3:Ln,NS_JINGLE_FILE_TRANSFER_4:"urn:xmpp:jingle:apps:file-transfer:4",NS_JINGLE_FILE_TRANSFER_5:Dn,NS_JINGLE_XML_0:Bn,NS_MUC_DIRECT_INVITE:Un,NS_SEC_LABEL_0:"urn:xmpp:sec-label:0",NS_SEC_LABEL_CATALOG_2:"urn:xmpp:sec-label:catalog:2",NS_SEC_LABEL_ESS_0:"urn:xmpp:sec-label:ess:0",NS_JINGLE_SOCKS5_1:zn,NS_JINGLE_IBB_1:$n,NS_JINGLE_RTP_ZRTP_1:"urn:xmpp:jingle:apps:rtp:zrtp:1",NS_THUMBS_0:"urn:xmpp:thumbs:0",NS_THUMBS_1:"urn:xmpp:thumbs:1",NS_DECLOAKING_0:"urn:xmpp:decloaking:0",NS_CARBONS_2:Qn,NS_JINGLE_RTP_RTCP_FB_0:Vn,NS_JINGLE_RTP_HDREXT_0:Gn,NS_FORWARD_0:Hn,NS_HASHES_1:Jn,NS_HASHES_2:Wn,NS_HASH_NAME:Yn,NS_RTT_0:Kn,NS_MUC_UNIQUE:"http://jabber.org/protocol/muc#unique",NS_CORRECTION_0:Xn,NS_PSA:Zn,NS_MAM_TMP:"urn:xmpp:mam:tmp",NS_MAM_0:"urn:xmpp:mam:0",NS_MAM_1:"urn:xmpp:mam:1",NS_MAM_2:ei,NS_HATS_0:ti,NS_IDLE_1:ni,NS_JINGLE_DTLS_0:ii,NS_CHAT_MARKERS_0:ri,NS_HINTS:si,NS_JSON_0:ai,NS_JINGLE_GROUPING_0:oi,NS_JINGLE_RTP_SSMA_0:ci,NS_JINGLE_DTLS_SCTP_1:li,NS_CSI_0:"urn:xmpp:csi:0",NS_JINGLE_MSG_INITIATE_0:"urn:xmpp:jingle:jingle-message:0",NS_DELEGATION_1:"urn:xmpp:delegation:1",NS_PUSH_0:ui,NS_JINGLE_PUB_1:"urn:xmpp:jinglepub:1",NS_SID_0:"urn:xmpp:sid:0",NS_HTTP_UPLOAD_0:pi,NS_JINGLE_HTTP_0:"urn:xmpp:jingle:transports:http:0",NS_JINGLE_HTTP_UPLOAD_0:"urn:xmpp:jingle:transports:http:upload:0",NS_JINGLE_ICE_0:di,NS_REFERENCE_0:hi,NS_EME_0:fi,NS_SPOILER_0:"urn:xmppp:spoiler:0",NS_OMEMO_AXOLOTL:mi,NS_OMEMO_AXOLOTL_DEVICELIST:"eu.siacs.conversations.axolotl.devicelist",NS_OMEMO_AXOLOTL_BUNDLES:"eu.siacs.conversations.axolotl.bundles",NS_OMEMO_AXOLOTL_BUNDLE:e=>`eu.siacs.conversations.axolotl.bundles:${e}`,NS_XRD:gi,NS_JINGLE_RTP_MSID_0:"urn:xmpp:jingle:apps:rtp:msid:0"});const yi=Le,vi=Je,wi=nt;function _i(e,t,n){return{aliases:Array.isArray(n)?n:[n],element:t,fields:{},namespace:e}}function Si(e){return{element:"message",fields:e,namespace:Ot}}function xi(e){return{element:"presence",fields:e,namespace:Ot}}function ji(e){return{element:"iq",fields:e,namespace:Ot}}function ki(e){return{element:"features",fields:e,namespace:Nt}}function Ti(e){return{element:"error",fields:e,namespace:qt,path:"stanzaError"}}function Ii(e){return[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}]}class Ei extends c.Transform{constructor(e){super({objectMode:!0}),this.closedStream=!1,this.wrappedStream=!1,this.registry=e.registry,this.acceptLanguages=e.acceptLanguages||[],e.wrappedStream&&(this.wrappedStream=!0,this.rootImportKey=e.rootKey),this.parser=new be({allowComments:e.allowComments}),this.parser.on("error",e=>{this.destroy(e)}),this.parser.on("startElement",(e,t)=>{if(this.destroyed)return;if(this.closedStream)return this.destroy(H.alreadyClosed());const n=new re(e,t),i=this.registry.getImportKey(n);if(this.wrappedStream&&!this.rootElement){if(this.rootImportKey&&i!==this.rootImportKey)return this.destroy(H.unknownRoot());const e=this.registry.import(n,{acceptLanguages:this.acceptLanguages,lang:this.lang});return e?(this.rootElement=n,void this.push({event:"stream-start",kind:i,stanza:e,xml:n})):this.destroy(H.notWellFormed())}this.currentElement?this.currentElement=this.currentElement.appendChild(n):this.currentElement=n}),this.parser.on("endElement",e=>{if(!this.destroyed){if(this.wrappedStream&&!this.currentElement)return this.rootElement&&e===this.rootElement.name?(this.closedStream=!0,this.push({event:"stream-end",kind:this.rootImportKey,stanza:{},xml:this.rootElement}),this.end()):(this.closedStream=!0,this.destroy(H.notWellFormed()));if(!this.currentElement||e!==this.currentElement.name)return this.closedStream=!0,this.destroy(H.notWellFormed());if(this.currentElement.parent)this.currentElement=this.currentElement.parent;else{this.wrappedStream&&(this.currentElement.parent=this.rootElement);const e=this.registry.getImportKey(this.currentElement),t=this.registry.import(this.currentElement,{acceptLanguages:this.acceptLanguages,lang:this.lang});t&&this.push({kind:e,stanza:t,xml:this.currentElement}),this.currentElement=void 0}}}),this.parser.on("text",e=>{this.currentElement&&this.currentElement.children.push(e)})}_transform(e,t,n){this.parser.write(e.toString()),n()}}var Oi=Object.freeze({__proto__:null,Registry:It,Translator:Tt,XMLElement:re,define:function(e){return t=>{t.define(e)}},Parser:be,parse:ge,StreamParser:Ei,escapeXML:ee,unescapeXML:te,escapeXMLText:ne,basicLanguageResolver:ie,createElement:ye,getLang:ve,getTargetLang:we,findAll:_e,findOrCreate:Se,attribute:Le,booleanAttribute:De,integerAttribute:Be,floatAttribute:Ue,dateAttribute:ze,namespacedAttribute:$e,namespacedBooleanAttribute:Qe,namespacedIntegerAttribute:Ve,namespacedFloatAttribute:Ge,namespacedDateAttribute:He,childAttribute:Je,childBooleanAttribute:We,childIntegerAttribute:Ye,childFloatAttribute:Ke,childDateAttribute:Xe,text:Ze,textJSON:()=>Ee(Object.assign({},Pe)),textBuffer:et,languageAttribute:tt,childLanguageAttribute:(e,t)=>Te(Object.assign({converter:tt(),element:t,name:"xml:lang",namespace:e},Ce)),childText:nt,childTextBuffer:it,childDate:rt,childInteger:st,childFloat:at,childJSON:ot,childTimezoneOffset:ct,childBoolean:lt,deepChildText:pt,deepChildInteger:dt,deepChildBoolean:ht,childEnum:ft,childDoubleEnum:mt,multipleChildText:gt,multipleChildAttribute:bt,multipleChildIntegerAttribute:yt,childAlternateLanguageText:vt,multipleChildAlternateLanguageText:function(e,t){return{importer(n,i){const r=[],s=new Map;let a=!1;const o=_e(n,e||n.getNamespace(),t);for(const e of o){const t=e.getText();if(t){const n=ve(e,i.lang);let o=s.get(n);o||(o=[],s.set(n,o),r.push({lang:n,value:o})),o.push(t),a=!0}}return a?r:void 0},exporter(n,i,r){for(const s of i)for(const i of s.value){const a=ye(e||n.getNamespace(),t,r.namespace,n);s.lang!==r.lang&&a.setAttribute("xml:lang",s.lang),a.children.push(i),n.appendChild(a)}}}},multipleChildEnum:wt,splicePath:_t,staticValue:St,childRawElement:function(e,t,n){return{importer(i,r){if(n&&(!r.sanitizers||!r.sanitizers[n]))return;const s=i.getChild(t,e||i.getNamespace());return s?n?r.sanitizers[n](s.toJSON()):s.toJSON():void 0},exporter(i,r,s){if("string"==typeof r){r=ge(`<${t} xmlns="${e||i.getNamespace()}">${r}</${t}>`).toJSON()}if(n){if(!s.sanitizers||!s.sanitizers[n])return;r=s.sanitizers[n](r)}r&&i.appendChild(new re(r.name,r.attributes,r.children))}}},childLanguageRawElement:xt,childAlternateLanguageRawElement:jt,parameterMap:kt,JIDAttribute:yi,childJIDAttribute:vi,childJID:wi,addAlias:_i,extendMessage:Si,extendPresence:xi,extendIQ:ji,extendStreamFeatures:ki,extendStanzaError:Ti,pubsubItemContentAliases:Ii});class Ci extends c.Transform{constructor(t,n,i="be"){super(),this._block=e.alloc(t),this._finalSize=n,this._blockSize=t,this._bigEndian="be"===i,this._len=0}_transform(e,t,n){let i=null;try{this.update(e,t)}catch(e){i=e}n(i)}_flush(e){let t=null;try{this.push(this.digest())}catch(e){t=e}e(t)}update(t,n){"string"==typeof t&&(n=n||"utf8",t=e.from(t,n));const i=this._block,r=this._blockSize,s=t.length;let a=this._len;for(let e=0;e<s;){const n=a%r,o=Math.min(s-e,r-n);for(let r=0;r<o;r++)i[n+r]=t[e+r];e+=o,(a+=o)%r==0&&this._update(i)}return this._len+=s,this}digest(e){const t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));const n=8*this._len;if(n<=4294967295)this._bigEndian?(this._block.writeUInt32BE(0,this._blockSize-8),this._block.writeUInt32BE(n,this._blockSize-4)):(this._block.writeUInt32LE(n,this._blockSize-8),this._block.writeUInt32LE(0,this._blockSize-4));else{const e=(4294967295&n)>>>0,t=(n-e)/4294967296;this._bigEndian?(this._block.writeUInt32BE(t,this._blockSize-8),this._block.writeUInt32BE(e,this._blockSize-4)):(this._block.writeUInt32LE(e,this._blockSize-8),this._block.writeUInt32LE(t,this._blockSize-4))}this._update(this._block);const i=this._hash();return e?i.toString(e):i}_update(e){throw new Error("_update must be implemented by subclass")}_hash(){throw new Error("_update must be implemented by subclass")}}function Ri(e,t){return e<<t|e>>>32-t}function qi(e,t,n,i,r,s,a){return Ri(e+(t&n|~t&i)+r+s|0,a)+t|0}function Ni(e,t,n,i,r,s,a){return Ri(e+(t&i|n&~i)+r+s|0,a)+t|0}function Ai(e,t,n,i,r,s,a){return Ri(e+(t^n^i)+r+s|0,a)+t|0}function Pi(e,t,n,i,r,s,a){return Ri(e+(n^(t|~i))+r+s|0,a)+t|0}const Fi=[1518500249,1859775393,-1894007588,-899497514];function Mi(e){return e<<5|e>>>27}function Li(e){return e<<30|e>>>2}function Di(e,t,n,i){return 0===e?t&n|~t&i:2===e?t&n|t&i|n&i:t^n^i}class Bi extends Ci{constructor(){super(64,56),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this._w=new Array(80)}_update(e){const t=this._w;let n,i=0|this._a,r=0|this._b,s=0|this._c,a=0|this._d,o=0|this._e;for(n=0;n<16;++n)t[n]=e.readInt32BE(4*n);for(;n<80;++n)t[n]=(c=t[n-3]^t[n-8]^t[n-14]^t[n-16])<<1|c>>>31;var c;for(let e=0;e<80;++e){const n=~~(e/20),c=Mi(i)+Di(n,r,s,a)+o+t[e]+Fi[n]|0;o=a,a=s,s=Li(r),r=i,i=c}this._a=i+this._a|0,this._b=r+this._b|0,this._c=s+this._c|0,this._d=a+this._d|0,this._e=o+this._e|0}_hash(){const t=e.allocUnsafe(20);return t.writeInt32BE(0|this._a,0),t.writeInt32BE(0|this._b,4),t.writeInt32BE(0|this._c,8),t.writeInt32BE(0|this._d,12),t.writeInt32BE(0|this._e,16),t}}const Ui=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function zi(e,t,n){return n^e&(t^n)}function $i(e,t,n){return e&t|n&(e|t)}function Qi(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function Vi(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function Gi(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}class Hi extends Ci{constructor(){super(64,56),this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this._w=new Array(64)}_update(e){const t=this._w;let n,i=0|this._a,r=0|this._b,s=0|this._c,a=0|this._d,o=0|this._e,c=0|this._f,l=0|this._g,u=0|this._h;for(n=0;n<16;++n)t[n]=e.readInt32BE(4*n);for(;n<64;++n)t[n]=0|(((p=t[n-2])>>>17|p<<15)^(p>>>19|p<<13)^p>>>10)+t[n-7]+Gi(t[n-15])+t[n-16];var p;for(let e=0;e<64;++e){const n=u+Vi(o)+zi(o,c,l)+Ui[e]+t[e]|0,p=Qi(i)+$i(i,r,s)|0;u=l,l=c,c=o,o=a+n|0,a=s,s=r,r=i,i=n+p|0}this._a=i+this._a|0,this._b=r+this._b|0,this._c=s+this._c|0,this._d=a+this._d|0,this._e=o+this._e|0,this._f=c+this._f|0,this._g=l+this._g|0,this._h=u+this._h|0}_hash(){const t=e.allocUnsafe(32);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t.writeInt32BE(this._h,28),t}}const Ji=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function Wi(e,t,n){return n^e&(t^n)}function Yi(e,t,n){return e&t|n&(e|t)}function Ki(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function Xi(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function Zi(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function er(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function tr(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function nr(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function ir(e,t){return e>>>0<t>>>0?1:0}class rr extends Ci{constructor(){super(128,112),this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this._w=new Array(160)}_update(e){const t=this._w;let n,i,r=0|this._ah,s=0|this._bh,a=0|this._ch,o=0|this._dh,c=0|this._eh,l=0|this._fh,u=0|this._gh,p=0|this._hh,d=0|this._al,h=0|this._bl,f=0|this._cl,m=0|this._dl,g=0|this._el,b=0|this._fl,y=0|this._gl,v=0|this._hl,w=0;for(w=0;w<32;w+=2)t[w]=e.readInt32BE(4*w),t[w+1]=e.readInt32BE(4*w+4);for(;w<160;w+=2){let e=t[w-30],r=t[w-30+1];const s=Zi(e,r),a=er(r,e),o=tr(e=t[w-4],r=t[w-4+1]),c=nr(r,e),l=t[w-14],u=t[w-14+1],p=t[w-32],d=t[w-32+1];n=(n=(n=s+l+ir(i=a+u|0,a)|0)+o+ir(i=i+c|0,c)|0)+p+ir(i=i+d|0,d)|0,t[w]=n,t[w+1]=i}for(let e=0;e<160;e+=2){n=t[e],i=t[e+1];const w=Yi(r,s,a),_=Yi(d,h,f),S=Ki(r,d),x=Ki(d,r),j=Xi(c,g),k=Xi(g,c),T=Ji[e],I=Ji[e+1],E=Wi(c,l,u),O=Wi(g,b,y);let C=v+k|0,R=p+j+ir(C,v)|0;R=(R=(R=R+E+ir(C=C+O|0,O)|0)+T+ir(C=C+I|0,I)|0)+n+ir(C=C+i|0,i)|0;const q=x+_|0,N=S+w+ir(q,x)|0;p=u,v=y,u=l,y=b,l=c,b=g,c=o+R+ir(g=m+C|0,m)|0,o=a,m=f,a=s,f=h,s=r,h=d,r=R+N+ir(d=C+q|0,C)|0}this._al=this._al+d|0,this._bl=this._bl+h|0,this._cl=this._cl+f|0,this._dl=this._dl+m|0,this._el=this._el+g|0,this._fl=this._fl+b|0,this._gl=this._gl+y|0,this._hl=this._hl+v|0,this._ah=this._ah+r+ir(this._al,d)|0,this._bh=this._bh+s+ir(this._bl,h)|0,this._ch=this._ch+a+ir(this._cl,f)|0,this._dh=this._dh+o+ir(this._dl,m)|0,this._eh=this._eh+c+ir(this._el,g)|0,this._fh=this._fh+l+ir(this._fl,b)|0,this._gh=this._gh+u+ir(this._gl,y)|0,this._hh=this._hh+p+ir(this._hl,v)|0}_hash(){const t=e.allocUnsafe(64);function n(e,n,i){t.writeInt32BE(e,i),t.writeInt32BE(n,i+4)}return n(this._ah,this._al,0),n(this._bh,this._bl,8),n(this._ch,this._cl,16),n(this._dh,this._dl,24),n(this._eh,this._el,32),n(this._fh,this._fl,40),n(this._gh,this._gl,48),n(this._hh,this._hl,56),t}}const sr=new Map([["md5",class extends Ci{constructor(){super(64,56,"le"),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._m=new Array(16)}_update(e){const t=this._m;for(let n=0;n<16;++n)t[n]=e.readInt32LE(4*n);let n=this._a,i=this._b,r=this._c,s=this._d;n=qi(n,i,r,s,t[0],3614090360,7),s=qi(s,n,i,r,t[1],3905402710,12),r=qi(r,s,n,i,t[2],606105819,17),i=qi(i,r,s,n,t[3],3250441966,22),n=qi(n,i,r,s,t[4],4118548399,7),s=qi(s,n,i,r,t[5],1200080426,12),r=qi(r,s,n,i,t[6],2821735955,17),i=qi(i,r,s,n,t[7],4249261313,22),n=qi(n,i,r,s,t[8],1770035416,7),s=qi(s,n,i,r,t[9],2336552879,12),r=qi(r,s,n,i,t[10],4294925233,17),i=qi(i,r,s,n,t[11],2304563134,22),n=qi(n,i,r,s,t[12],1804603682,7),s=qi(s,n,i,r,t[13],4254626195,12),r=qi(r,s,n,i,t[14],2792965006,17),n=Ni(n,i=qi(i,r,s,n,t[15],1236535329,22),r,s,t[1],4129170786,5),s=Ni(s,n,i,r,t[6],3225465664,9),r=Ni(r,s,n,i,t[11],643717713,14),i=Ni(i,r,s,n,t[0],3921069994,20),n=Ni(n,i,r,s,t[5],3593408605,5),s=Ni(s,n,i,r,t[10],38016083,9),r=Ni(r,s,n,i,t[15],3634488961,14),i=Ni(i,r,s,n,t[4],3889429448,20),n=Ni(n,i,r,s,t[9],568446438,5),s=Ni(s,n,i,r,t[14],3275163606,9),r=Ni(r,s,n,i,t[3],4107603335,14),i=Ni(i,r,s,n,t[8],1163531501,20),n=Ni(n,i,r,s,t[13],2850285829,5),s=Ni(s,n,i,r,t[2],4243563512,9),r=Ni(r,s,n,i,t[7],1735328473,14),n=Ai(n,i=Ni(i,r,s,n,t[12],2368359562,20),r,s,t[5],4294588738,4),s=Ai(s,n,i,r,t[8],2272392833,11),r=Ai(r,s,n,i,t[11],1839030562,16),i=Ai(i,r,s,n,t[14],4259657740,23),n=Ai(n,i,r,s,t[1],2763975236,4),s=Ai(s,n,i,r,t[4],1272893353,11),r=Ai(r,s,n,i,t[7],4139469664,16),i=Ai(i,r,s,n,t[10],3200236656,23),n=Ai(n,i,r,s,t[13],681279174,4),s=Ai(s,n,i,r,t[0],3936430074,11),r=Ai(r,s,n,i,t[3],3572445317,16),i=Ai(i,r,s,n,t[6],76029189,23),n=Ai(n,i,r,s,t[9],3654602809,4),s=Ai(s,n,i,r,t[12],3873151461,11),r=Ai(r,s,n,i,t[15],530742520,16),n=Pi(n,i=Ai(i,r,s,n,t[2],3299628645,23),r,s,t[0],4096336452,6),s=Pi(s,n,i,r,t[7],1126891415,10),r=Pi(r,s,n,i,t[14],2878612391,15),i=Pi(i,r,s,n,t[5],4237533241,21),n=Pi(n,i,r,s,t[12],1700485571,6),s=Pi(s,n,i,r,t[3],2399980690,10),r=Pi(r,s,n,i,t[10],4293915773,15),i=Pi(i,r,s,n,t[1],2240044497,21),n=Pi(n,i,r,s,t[8],1873313359,6),s=Pi(s,n,i,r,t[15],4264355552,10),r=Pi(r,s,n,i,t[6],2734768916,15),i=Pi(i,r,s,n,t[13],1309151649,21),n=Pi(n,i,r,s,t[4],4149444226,6),s=Pi(s,n,i,r,t[11],3174756917,10),r=Pi(r,s,n,i,t[2],718787259,15),i=Pi(i,r,s,n,t[9],3951481745,21),this._a=this._a+n|0,this._b=this._b+i|0,this._c=this._c+r|0,this._d=this._d+s|0}_hash(){const t=e.allocUnsafe(16);return t.writeInt32LE(this._a,0),t.writeInt32LE(this._b,4),t.writeInt32LE(this._c,8),t.writeInt32LE(this._d,12),t}}],["sha-1",Bi],["sha-256",Hi],["sha-512",rr],["sha1",Bi],["sha256",Hi],["sha512",rr]]);function ar(e){e=e.toLowerCase();const t=sr.get(e);if(t)return new t;throw new Error("Unsupported hash algorithm: "+e)}const or=e.alloc(128);class cr extends c.Transform{constructor(t,n){super(),"string"==typeof n&&(n=e.from(n));const i="sha512"===t?128:64;this._alg=t,n.length>i?n=ar(t).update(n).digest():n.length<i&&(n=e.concat([n,or],i)),this._ipad=e.alloc(i),this._opad=e.alloc(i);for(let e=0;e<i;e++)this._ipad[e]=54^n[e],this._opad[e]=92^n[e];this._hash=ar(t).update(this._ipad)}_transform(e,t,n){let i;try{this.update(e,t)}catch(e){i=e}finally{n(i)}}_flush(e){let t;try{this.push(this._final())}catch(e){t=e}e(t)}_final(){const e=this._hash.digest();return ar(this._alg).update(this._opad).update(e).digest()}update(e,t){return this._hash.update(e,t),this}digest(t){const n=this._final()||e.alloc(0);return t?n.toString(t):n}}let lr;function ur(t){const n=new Uint8Array(t);return t>0&&(lr.crypto||lr.msCrypto).getRandomValues(n),e.from(n.buffer)}"undefined"!=typeof window?lr=window:void 0!==i&&(lr=i);const pr=fetch,dr=WebSocket;class hr{constructor(e){this.authenticated=!1,this.mutuallyAuthenticated=!1,this.name=e}getCacheableCredentials(){return null}processChallenge(e){}processSuccess(e){this.authenticated=!0,e&&this.processChallenge(e)}finalize(){return{authenticated:this.authenticated,mutuallyAuthenticated:this.mutuallyAuthenticated}}}class fr{constructor(){this.mechanisms=[]}register(e,t,n){this.mechanisms.push({constructor:t,name:e.toUpperCase(),priority:n||this.mechanisms.length}),this.mechanisms.sort((e,t)=>t.priority-e.priority)}disable(e){const t=e.toUpperCase();this.mechanisms=this.mechanisms.filter(e=>e.name!==t)}createMechanism(e){const t=e.map(e=>e.toUpperCase());for(const e of this.mechanisms)for(const n of t)if(n===e.name)return new e.constructor(e.name);return null}}function mr(t,n){const i=[];if(t.length>n.length)for(let e=0;e<n.length;e++)i.push(t[e]^n[e]);else for(let e=0;e<t.length;e++)i.push(t[e]^n[e]);return e.from(i)}function gr(e,t,n="sha-1"){return function(e,t){return new cr(e.toLowerCase(),t)}(n,e).update(t).digest()}function br(e=32){return ur(e).toString("hex")}function yr(e){const t={},n=e.toString().split(/,(?=(?:[^"]|"[^"]*")*$)/);for(let e=0,i=n.length;e<i;e++){const i=/(\w+)=["]?([^"]+)["]?$/.exec(n[e]);i&&(t[i[1]]=i[2])}return t}class vr extends hr{getExpectedCredentials(){return{optional:["trace"],required:[]}}createResponse(t){return e.from(t.trace||"")}}class wr extends hr{getExpectedCredentials(){return{optional:["authzid"],required:[]}}createResponse(t){return e.from(t.authzid||"")}}class _r extends hr{getExpectedCredentials(){return{optional:["authzid"],required:["username","password"]}}createResponse(t){return e.from((t.authzid||"")+"\0"+t.username+"\0"+t.password)}}class Sr extends hr{constructor(e){super(e),this.name=e}getExpectedCredentials(){return{optional:[],required:["token"]}}createResponse(t){return e.from(t.token)}}class xr extends hr{constructor(e){super(e),this.providesMutualAuthentication=!1,this.name=e}processChallenge(e){const t=yr(e);this.authenticated=!!t.rspauth,this.realm=t.realm,this.nonce=t.nonce,this.charset=t.charset}getExpectedCredentials(){return{optional:["authzid","realm","clientNonce"],required:["host","password","serviceName","serviceType","username"]}}createResponse(t){if(this.authenticated)return null;let n=t.serviceType+"/"+t.host;t.serviceName&&t.host!==t.serviceName&&(n+="/"+t.serviceName);const i=t.realm||this.realm||"",r=t.clientNonce||br(16),s="00000001";let a="";a+='username="'+t.username+'"',i&&(a+=',realm="'+i+'"'),a+=',nonce="'+this.nonce+'"',a+=',cnonce="'+r+'"',a+=",nc="+s,a+=",qop=auth",a+=',digest-uri="'+n+'"';const o=ar("md5").update(t.username).update(":").update(i).update(":").update(t.password).digest(),c=ar("md5").update(o).update(":").update(this.nonce).update(":").update(r);t.authzid&&c.update(":").update(t.authzid);const l=c.digest("hex"),u=ar("md5").update("AUTHENTICATE:").update(n).digest("hex");return a+=",response="+ar("md5").update(l).update(":").update(this.nonce).update(":").update(s).update(":").update(r).update(":").update("auth").update(":").update(u).digest("hex"),"utf-8"===this.charset&&(a+=",charset=utf-8"),t.authzid&&(a+='authzid="'+t.authzid+'"'),e.from(a)}}class jr{constructor(e){this.providesMutualAuthentication=!0,this.name=e,this.state="INITIAL",this.useChannelBinding=this.name.toLowerCase().endsWith("-plus"),this.algorithm=this.name.toLowerCase().split("scram-")[1].split("-plus")[0]}getExpectedCredentials(){const e=["username","password"];return this.useChannelBinding&&e.push("tlsUnique"),{optional:["authzid"],required:e}}getCacheableCredentials(){return this.cache}createResponse(e){switch(this.state){case"INITIAL":return this.initialResponse(e);case"CHALLENGE":return this.challengeResponse(e)}return null}processChallenge(t){const n=yr(t);this.salt=e.from(n.s||"","base64"),this.iterationCount=parseInt(n.i,10),this.nonce=n.r,this.verifier=n.v,this.error=n.e,this.challenge=t}processSuccess(e){this.processChallenge(e)}finalize(e){return this.verifier?this.serverSignature.toString("base64")!==this.verifier?{authenticated:!1,error:"Mutual authentication failed",mutuallyAuthenticated:!1}:{authenticated:!0,mutuallyAuthenticated:!0}:{authenticated:!1,error:this.error,mutuallyAuthenticated:!1}}initialResponse(t){const n=this.escapeUsername(t.authzid),i=this.escapeUsername(t.username);this.clientNonce=t.clientNonce||br();let r="n";t.tlsUnique&&(r=this.useChannelBinding?"p=tls-unique":"y"),this.gs2Header=e.from(n?`${r},a=${n},`:`${r},,`),this.clientFirstMessageBare=e.from(`n=${i},r=${this.clientNonce}`);const s=e.concat([this.gs2Header,this.clientFirstMessageBare]);return this.state="CHALLENGE",s}challengeResponse(t){const n=e.from("Client Key"),i=e.from("Server Key"),r=e.concat([this.gs2Header,t.tlsUnique||e.from("")]).toString("base64"),s=e.from(`c=${r},r=${this.nonce}`);let a,o,c;const l=t.salt&&0===e.compare(t.salt,this.salt);l&&t.clientKey&&t.serverKey?(o=e.from(t.clientKey),c=e.from(t.serverKey)):l&&t.saltedPassword?(o=gr(a=e.from(t.saltedPassword),n,this.algorithm),c=gr(a,i,this.algorithm)):(a=function(t,n,i,r="sha-1"){let s=gr(t,e.concat([n,e.from("00000001","hex")]),r),a=s;for(let e=0;e<i-1;e++)a=mr(a,s=gr(t,s,r));return a}(e.from(t.password||""),this.salt,this.iterationCount,this.algorithm),o=gr(a,n,this.algorithm),c=gr(a,i,this.algorithm));const u=function(e,t="sha-1"){return ar(t).update(e).digest()}(o,this.algorithm),p=e.from(","),d=e.concat([this.clientFirstMessageBare,p,this.challenge,p,s]),h=mr(o,gr(u,d,this.algorithm)).toString("base64");this.serverSignature=gr(c,d,this.algorithm);const f=e.concat([s,e.from(`,p=${h}`)]);return this.state="FINAL",this.cache={clientKey:o,salt:this.salt,saltedPassword:a,serverKey:c},f}escapeUsername(e=""){const t=[];for(const n of e)","===n?t.push("=2C"):"="===n?t.push("=3D"):t.push(n);return t.join("")}}var kr=Object.freeze({__proto__:null,SimpleMech:hr,Factory:fr,ANONYMOUS:vr,EXTERNAL:wr,PLAIN:_r,OAUTH:Sr,DIGEST:xr,SCRAM:jr});function Tr(e){e.getAccountInfo=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({account:{},to:t,type:"get"})).account})),e.updateAccount=(t,n)=>e.sendIQ({account:n,to:t,type:"set"}),e.deleteAccount=t=>e.sendIQ({account:{remove:!0},to:t,type:"set"}),e.getPrivateData=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({privateStorage:{[t]:{}},type:"get"})).privateStorage[t]})),e.setPrivateData=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){return e.sendIQ({privateStorage:{[t]:n},type:"set"})})),e.getVCard=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({to:t,type:"get",vcard:{format:Jt}})).vcard})),e.publishVCard=t=>Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({type:"set",vcard:t})})),e.enableNotifications=(t,n,i=[])=>e.sendIQ({push:{action:"enable",form:{fields:[{name:"FORM_TYPE",type:"hidden",value:"http://jabber.org/protocol/pubsub#publish-options"},...i],type:"submit"},jid:t,node:n},type:"set"}),e.disableNotifications=(t,n)=>e.sendIQ({push:{action:"disable",jid:t,node:n},type:"set"})}function Ir(e){e.disco.addFeature(_n(on)),e.on("pubsub:published",t=>{if(t.pubsub.items.node!==on)return;const n=t.pubsub.items.published[0].content;e.emit("avatar",{avatars:n.versions||[],jid:t.from,source:"pubsub"})}),e.on("presence",t=>{t.vcardAvatar&&"string"==typeof t.vcardAvatar&&e.emit("avatar",{avatars:[{id:t.vcardAvatar}],jid:t.from,source:"vcard"})}),e.publishAvatar=(t,n)=>e.publish("",an,{data:n,itemType:an},t),e.useAvatars=(t,n=[])=>e.publish("",on,{itemType:on,pointers:n,versions:t},"current"),e.getAvatar=(t,n)=>e.getItem(t,an,n)}function Er(e){e.registerFeature("bind",300,(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){try{const i=yield e.sendIQ({bind:{resource:e.config.resource},type:"set"});e.features.negotiated.bind=!0,e.emit("session:prebind",i.bind.jid);const r=!t.legacySession||t.legacySession&&t.legacySession.optional;return!e.sessionStarted&&r&&e.emit("session:started",e.jid),n()}catch(e){return console.error(e),n("disconnect","JID binding failed")}}))),e.registerFeature("legacySession",1e3,(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){if(e.sessionStarted||t.legacySession&&t.legacySession.optional)return e.features.negotiated.session=!0,n();try{return yield e.sendIQ({legacySession:!0,type:"set"}),e.features.negotiated.session=!0,e.sessionStarted||(e.sessionStarted=!0,e.emit("session:started",e.jid)),n()}catch(e){return n("disconnect","Session requeset failed")}}))),e.on("session:started",()=>{e.sessionStarted=!0}),e.on("session:prebind",t=>{e.jid=t,e.emit("session:bound",e.jid)}),e.on("disconnected",()=>{e.sessionStarted=!1,e.features.negotiated.bind=!1,e.features.negotiated.session=!1})}function Or(e){e.disco.addFeature(Ht),e.disco.addItem({name:"Ad-Hoc Commands",node:Ht}),e.getCommands=t=>e.getDiscoItems(t,Ht)}const Cr=[];for(let e=0;e<256;++e)Cr[e]=(e+256).toString(16).substr(1);function Rr(e,t,n=(()=>void 0)){return Object(r.a)(this,void 0,void 0,(function*(){let i;const r=yield Promise.race([e,new Promise((e,r)=>{i=setTimeout(()=>r(n()),t)})]);return i&&clearTimeout(i),r}))}function qr(e){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise(t=>{setTimeout(()=>t(),e)})}))}function Nr(t,n){const i="string"==typeof t?e.from(t,"utf8"):t,r="string"==typeof n?e.from(n,"utf8"):n;return i.compare(r)}function Ar(){const e=ur(16);e[6]=15&e[6]|64,e[8]=63&e[8]|128;let t=0;return[Cr[e[t++]],Cr[e[t++]],Cr[e[t++]],Cr[e[t++]],"-",Cr[e[t++]],Cr[e[t++]],"-",Cr[e[t++]],Cr[e[t++]],"-",Cr[e[t++]],Cr[e[t++]],"-",Cr[e[t++]],Cr[e[t++]],Cr[e[t++]],Cr[e[t++]],Cr[e[t++]],Cr[e[15]]].join("")}const Pr=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)(?:Z|((\+|-)([\d|:]*)))?$/;var Fr=Object.freeze({__proto__:null,timeoutPromise:Rr,sleep:qr,octetCompare:Nr,uuid:Ar,reviveData:function(t,n){return n&&"string"==typeof n&&Pr.test(n)?new Date(n):n&&"object"==typeof n&&"Buffer"===n.type&&Array.isArray(n.data)?e.from(n):n}});function Mr(e,t){e.features.negotiated.clientStateIndication&&e.send("csi",{type:t})}function Lr(e){e.disco.addFeature(qn),e.on("iq:get:ping",t=>{e.sendIQResult(t)}),e.on("disconnected",()=>{e.disableKeepAlive(),e.features.negotiated.streamManagement=!1,e.features.negotiated.clientStateIndication=!1}),e.markActive=()=>Mr(e,"active"),e.markInactive=()=>Mr(e,"inactive"),e.ping=t=>Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({ping:!0,to:t,type:"get"})})),e.enableKeepAlive=(t={})=>{const n=t.interval||300,i=t.timeout||e.config.timeout||15;e._keepAliveInterval=setInterval((function(){return Object(r.a)(this,void 0,void 0,(function*(){if(e.sessionStarted)try{yield Rr(function(e){return new Promise((t,n)=>Object(r.a)(this,void 0,void 0,(function*(){if(e.sm.started)e.once("stream:management:ack",()=>t()),e.sm.request();else try{yield e.ping(),t()}catch(e){e.error&&"timeout"!==e.error.condition?t():n()}})))}(e),1e3*i)}catch(t){e.emit("stream:error",{condition:"connection-timeout",text:"Server did not respond in "+i+" seconds"}),e.transport&&(e.transport.hasStream=!1,e.transport.disconnect())}}))}),1e3*n)},e.disableKeepAlive=()=>{e._keepAliveInterval&&(clearInterval(e._keepAliveInterval),delete e._keepAliveInterval)};const t=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){if(!e.config.useStreamManagement)return n();const t=i=>{switch(i.type){case"enabled":return e.sm.enabled(i),e.features.negotiated.streamManagement=!0,e.off("sm",t),n();case"resumed":return e.sm.resumed(i),e.features.negotiated.streamManagement=!0,e.features.negotiated.bind=!0,e.sessionStarted=!0,e.emit("stream:management:resumed",i),e.off("sm",t),n("break");case"failed":e.sm.failed(i),e.emit("session:end"),e.off("sm",t),n()}};e.on("sm",t),e.sm.id?e.sm.id&&e.sm.allowResume?e.sm.resume():(e.off("sm",t),n()):e.features.negotiated.bind?e.sm.enable():(e.off("sm",t),n())}));e.registerFeature("streamManagement",200,t),e.registerFeature("streamManagement",500,t),e.registerFeature("clientStateIndication",400,(t,n)=>{e.features.negotiated.clientStateIndication=!0,n()})}function Dr(t){return new e(t.replace(/</g,"&lt;"),"utf-8")}function Br(e=[]){const t=[];for(const n of e)"FORM_TYPE"!==n.name&&t.push({name:Dr(n.name),values:(n.rawValues||[]).map(e=>Dr(e)).sort(Nr)});t.sort((e,t)=>Nr(e.name,t.name));const n=[];for(const e of t){n.push(e.name);for(const t of e.values)n.push(t)}return n}function Ur(t,n){const i=[],r=new e("<"),s=(e,t)=>{i.push(e),i.push(r),t&&i.push(t)},a=function(e=[]){const t=[],n=new Set;for(const{category:i,type:r,lang:s,name:a}of e){const e=`${i}/${r}/${s||""}/${a||""}`;if(n.has(e))return null;n.add(e),t.push(Dr(e))}return t.sort(Nr),t}(t.identities),o=function(e=[]){const t=[],n=new Set;for(const i of e){if(n.has(i))return null;n.add(i),t.push(Dr(i))}return t.sort(Nr),t}(t.features),c=function(e=[]){const t=[],n=new Set;for(const i of e){let e;for(const t of i.fields||[])if("FORM_TYPE"===t.name&&"hidden"===t.type&&t.rawValues&&1===t.rawValues.length){e=Dr(t.rawValues[0]);break}if(e){if(n.has(e.toString()))return null;n.add(e.toString()),t.push({type:e,form:i})}}t.sort((e,t)=>Nr(e.type,t.type));const i=[];for(const e of t){i.push(e.type);const t=Br(e.form.fields);for(const e of t)i.push(e)}return i}(t.extensions);if(!a||!o||!c)return null;for(const e of a)s(e);for(const e of o)s(e);for(const e of c)s(e);let l=ar(n).update(e.concat(i)).digest("base64"),u=4-l.length%4;4===u&&(u=0);for(let e=0;e<u;e++)l+="=";return l}class zr{constructor(){this.capsAlgorithms=["sha-1"],this.features=new Map,this.identities=new Map,this.extensions=new Map,this.items=new Map,this.caps=new Map,this.features.set("",new Set),this.identities.set("",[]),this.extensions.set("",[])}getNodeInfo(e){return{extensions:[...this.extensions.get(e)||[]],features:[...this.features.get(e)||[]],identities:[...this.identities.get(e)||[]]}}addFeature(e,t=""){this.features.has(t)||this.features.set(t,new Set),this.features.get(t).add(e)}addIdentity(e,t=""){this.identities.has(t)||this.identities.set(t,[]),this.identities.get(t).push(e)}addItem(e,t=""){this.items.has(t)||this.items.set(t,[]),this.items.get(t).push(e)}addExtension(e,t=""){this.extensions.has(t)||this.extensions.set(t,[]),this.extensions.get(t).push(e)}updateCaps(e,t=this.capsAlgorithms){const n={extensions:[...this.extensions.get("")],features:[...this.features.get("")],identities:[...this.identities.get("")],type:"info"};for(const i of t){const t=Ur(n,i);if(!t){this.caps.delete(i);continue}this.caps.set(i,{algorithm:i,node:e,value:t});const r=`${e}#${t}`;for(const e of n.features)this.addFeature(e,r);for(const e of n.identities)this.addIdentity(e,r);for(const e of n.extensions)this.addExtension(e,r);this.identities.set(r,n.identities),this.features.set(r,new Set(n.features)),this.extensions.set(r,n.extensions)}return[...this.caps.values()]}getCaps(){return[...this.caps.values()]}}function $r(e){e.disco=new zr,e.disco.addFeature(Dt),e.disco.addFeature(Bt),e.disco.addIdentity({category:"client",type:"web"}),e.registerFeature("caps",100,(t,n)=>{const i=B(e.jid)||e.config.server;e.emit("disco:caps",{caps:t.legacyCapabilities||[],jid:i}),e.features.negotiated.caps=!0,n()}),e.getDiscoInfo=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){const i=yield e.sendIQ({disco:{node:n,type:"info"},to:t,type:"get"});return Object.assign({extensions:[],features:[],identities:[]},i.disco)})),e.getDiscoItems=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){const i=yield e.sendIQ({disco:{node:n,type:"items"},to:t,type:"get"});return Object.assign({items:[]},i.disco)})),e.updateCaps=()=>{const t=e.config.capsNode||"https://stanzajs.org";return e.disco.updateCaps(t)},e.getCurrentCaps=()=>{const t=e.disco.getCaps();if(!t)return;const n=`${t[0].node}#${t[0].value}`;return{info:e.disco.getNodeInfo(n),legacyCapabilities:t}},e.on("presence",t=>{t.legacyCapabilities&&e.emit("disco:caps",{caps:t.legacyCapabilities,jid:t.from})}),e.on("iq:get:disco",t=>{const{type:n,node:i}=t.disco;"info"===n&&e.sendIQResult(t,{disco:Object.assign(Object.assign({},e.disco.getNodeInfo(i||"")),{node:i,type:"info"})}),"items"===n&&e.sendIQResult(t,{disco:{items:e.disco.items.get(i||"")||[],type:"items"}})})}const Qr="12.4.2",Vr={Bosh:fn,Client:Ot,Component:"jabber:component:accept",Server:"jabber:server"},Gr={AccountDisabled:"account-disabled",CredentialsExpired:"credentials-expired",EncryptionRequired:"encryption-required",IncorrectEncoding:"incorrect-encoding",InvalidAuthzid:"invalid-authzid",InvalidMechanism:"invalid-mechanism",MalformedRequest:"malformed-request",MechanismTooWeak:"mechanism-too-weak",NotAuthorized:"not-authorized",TemporaryAuthFailure:"temporary-auth-failure"},Hr={BadFormat:"bad-format",BadNamespacePrefix:"bad-namespace-prefix",Conflict:"conflict",ConnectionTimeout:"connection-timeout",HostGone:"host-gone",HostUnknown:"host-unknown",ImproperAddressing:"improper-addressing",InternalServerError:"internal-server-error",InvalidFrom:"invalid-from",InvalidId:"invalid-id",InvalidNamespace:"invalid-namespace",InvalidXML:"invalid-xml",NotAuthorized:"not-authorized",NotWellFormed:"not-well-formed",PolicyViolation:"policy-violation",RemoteConnectionFailed:"remote-connection-failed",Reset:"reset",ResourceConstraint:"resource-constraint",RestrictedXML:"restricted-xml",SeeOtherHost:"see-other-host",SystemShutdown:"system-shutdown",UndefinedCondition:"undefined-condition",UnsupportedEncoding:"unsupported-encoding",UnsupportedStanzaType:"unsupported-stanza-type",UnsupportedVersion:"unsupported-version"},Jr={BadRequest:"bad-request",Conflict:"conflict",FeatureNotImplemented:"feature-not-implemented",Forbidden:"forbidden",Gone:"gone",InternalServerError:"internal-server-error",ItemNotFound:"item-not-found",JIDMalformed:"jid-malformed",NotAcceptable:"not-acceptable",NotAllowed:"not-allowed",NotAuthorized:"not-authorized",PolicyViolation:"policy-violation",RecipientUnavailable:"recipient-unavailable",Redirect:"redirect",RegistrationRequired:"registration-required",RemoteServerNotFound:"remote-server-not-found",RemoteServerTimeout:"remote-server-timeout",ResourceConstraint:"resource-constraint",ServiceUnavailable:"service-unavailable",SubscriptionRequired:"subscription-required",UndefinedCondition:"undefined-condition",UnexpectedRequest:"unexpected-request"},Wr={Available:void 0,Error:"error",Probe:"probe",Subscribe:"subscribe",Subscribed:"subscribed",Unavailable:"unavailable",Unsubscribe:"unsubscribe",Unsubscribed:"unsubscribed"},Yr={Boolean:"boolean",Fixed:"fixed",Hidden:"hidden",JID:"jid-single",JIDMultiple:"jid-multi",List:"list-single",ListMultiple:"list-multi",Password:"text-private",Text:"text-single",TextMultiple:"text-multi",TextPrivate:"text-private"},Kr={AffiliationChanged:"101",AffiliationLost:"321",Banned:"301",Error:"333",Kicked:"307",LoggingDisabled:"171",LoggingEnabled:"170",MembershipLost:"322",NickChanged:"303",NickChangedByService:"210",NonAnonymous:"172",NonAnonymousRoom:"100",NonPrivacyConfigurationChange:"104",RoomCreated:"201",SelfPresence:"110",SemiAnonymous:"173",Shutdown:"332",UnavailableMembersListed:"102",UnavailableMembersNotListed:"103"},Xr={ClosedNode:"closed-node",ConfigurationRequired:"configuration-required",InvalidJID:"invalid-jid",InvalidOptions:"invalid-options",InvalidPayload:"invalid-payload",InvalidSubscriptionId:"invalid-subid",ItemForbidden:"item-forbidden",ItemRequired:"item-required",JIDRequired:"jid-required",MaxItemsExceeded:"max-items-exceeded",MaxNodesExceeded:"max-nodes-exceeded",NodeIdRequired:"nodeid-required",NotInRosterGroup:"not-in-roster-group",NotSubscribed:"not-subscribed",PayloadRequired:"payload-required",PayloadTooBig:"payload-too-big",PendingSubscription:"pending-subscription",PresenceSubscriptionRequired:"presence-subscription-required",SubscriptionIdRequired:"subid-required",TooManySubscriptions:"too-many-subscriptions",Unsupported:"unsupported",UnsupportedAccessModel:"unsupported-access-model"},Zr={Active:"active",Composing:"composing",Gone:"gone",Inactive:"inactive",Paused:"paused"},es={Initiator:"initiator",Responder:"responder"},ts={Inactive:"inactive",Receive:"recvonly",Send:"sendonly",SendReceive:"sendrecv"},ns={Both:"both",Initiator:"initiator",None:"none",Responder:"responder"},is={ContentAccept:"content-accept",ContentAdd:"content-add",ContentModify:"content-modify",ContentReject:"content-reject",ContentRemove:"content-remove",DescriptionInfo:"description-info",SecurityInfo:"security-info",SessionAccept:"session-accept",SessionInfo:"session-info",SessionInitiate:"session-initiate",SessionTerminate:"session-terminate",TransportAccept:"transport-accept",TransportInfo:"transport-info",TransportReject:"transport-reject",TransportReplace:"transport-replace"},rs={OutOfOrder:"out-of-order",TieBreak:"tie-break",UnknownContent:"unknown-content",UnknownSession:"unknown-session",UnsupportedInfo:"unsupported-info"},ss={AlternativeSession:"alternative-session",Busy:"busy",Cancel:"cancel",ConnectivityError:"connectivity-error",Decline:"decline",Expired:"expired",FailedApplication:"failed-application",FailedTransport:"failed-transport",GeneralError:"general-error",Gone:"gone",IncompatibleParameters:"incompatible-parameters",MediaError:"media-error",SecurityError:"security-error",Success:"success",Timeout:"timeout",UnsupportedApplications:"unsupported-applications",UnsupportedTransports:"unsupported-transports"},as=["afraid","amazed","amorous","angry","annoyed","anxious","aroused","ashamed","bored","brave","calm","cautious","cold","confident","confused","contemplative","contented","cranky","crazy","creative","curious","dejected","depressed","disappointed","disgusted","dismayed","distracted","embarrassed","envious","excited","flirtatious","frustrated","grateful","grieving","grumpy","guilty","happy","hopeful","hot","humbled","humiliated","hungry","hurt","impressed","in_awe","in_love","indignant","interested","intoxicated","invincible","jealous","lonely","lost","lucky","mean","moody","nervous","neutral","offended","outraged","playful","proud","relaxed","relieved","remorseful","restless","sad","sarcastic","satisfied","serious","shocked","shy","sick","sleepy","spontaneous","stressed","strong","surprised","thankful","thirsty","tired","undefined","weak","worried"],os=["doing_chores","drinking","eating","exercising","grooming","having_appointment","inactive","relaxing","talking","traveling","undefined","working"],cs=["at_the_spa","brushing_teeth","buying_groceries","cleaning","coding","commuting","cooking","cycling","cycling","dancing","day_off","doing_maintenance","doing_the_dishes","doing_the_laundry","driving","fishing","gaming","gardening","getting_a_haircut","going_out","hanging_out","having_a_beer","having_a_snack","having_breakfast","having_coffee","having_dinner","having_lunch","having_tea","hiding","hiking","in_a_car","in_a_meeting","in_real_life","jogging","on_a_bus","on_a_plane","on_a_train","on_a_trip","on_the_phone","on_vacation","on_video_phone","other","partying","playing_sports","praying","reading","rehearsing","running","running_an_errand","scheduled_holiday","shaving","shopping","skiing","sleeping","smoking","socializing","studying","sunbathing","swimming","taking_a_bath","taking_a_shower","thinking","walking","walking_the_dog","watching_a_movie","watching_tv","working_out","writing"],ls=(e,t)=>`{${e}}${t}`,us=ls(jn,"mute"),ps=ls(jn,"unmute"),ds=ls(jn,"hold"),hs=ls(jn,"unhold"),fs=ls(jn,"active"),ms=ls(jn,"ringing"),gs=ls(Dn,"checksum"),bs=ls(Dn,"received");function ys(e){return Object.keys(e).map(t=>e[t])}function vs(e,t=ns.Both){const n=e===es.Initiator;switch(t){case ns.Initiator:return n?ts.Send:ts.Receive;case ns.Responder:return n?ts.Receive:ts.Send;case ns.Both:return ts.SendReceive}return ts.Inactive}function ws(e,t=ts.SendReceive){const n=e===es.Initiator;switch(t){case ts.Send:return n?ns.Initiator:ns.Responder;case ts.Receive:return n?ns.Responder:ns.Initiator;case ts.SendReceive:return ns.Both}return ns.None}var _s=Object.freeze({__proto__:null,VERSION:Qr,StreamType:Vr,SASLFailureCondition:Gr,StreamErrorCondition:Hr,StanzaErrorCondition:Jr,MessageType:{Chat:"chat",Error:"error",GroupChat:"groupchat",Headline:"headline",Normal:"normal"},PresenceType:Wr,IQType:{Error:"error",Get:"get",Result:"result",Set:"set"},PresenceShow:{Away:"away",Chat:"chat",DoNotDisturb:"dnd",ExtendedAway:"xa"},RosterSubscription:{Both:"both",From:"from",None:"none",ReceivePresenceOnly:"to",Remove:"remove",SendAndReceivePresence:"both",SendPresenceOnly:"from",To:"to"},DataFormType:{Cancel:"cancel",Form:"form",Result:"result",Submit:"submit"},DataFormFieldType:Yr,MUCAffiliation:{Admin:"admin",Banned:"outcast",Member:"member",None:"none",Outcast:"outcast",Owner:"owner"},MUCRole:{Moderator:"moderator",None:"none",Participant:"participant",Visitor:"visitor"},MUCStatusCode:Kr,PubsubErrorCondition:Xr,ChatState:Zr,JingleSessionRole:es,JingleApplicationDirection:ts,JingleContentSenders:ns,JingleAction:is,JingleErrorCondition:rs,JingleReasonCondition:ss,USER_MOODS:as,USER_ACTIVITY_GENERAL:os,USER_ACTIVITY_SPECIFIC:cs,JINGLE_INFO:ls,JINGLE_INFO_MUTE:us,JINGLE_INFO_UNMUTE:ps,JINGLE_INFO_HOLD:ds,JINGLE_INFO_UNHOLD:hs,JINGLE_INFO_ACTIVE:fs,JINGLE_INFO_RINGING:ms,JINGLE_INFO_CHECKSUM_5:gs,JINGLE_INFO_RECEIVED_5:bs,toList:ys,sendersToDirection:vs,directionToSenders:ws});function Ss(e){e.disco.addFeature("jid\\20escaping"),e.disco.addFeature(An),e.disco.addFeature(fi),e.disco.addFeature(Hn),e.disco.addFeature(Wn),e.disco.addFeature(Jn),e.disco.addFeature(ni),e.disco.addFeature(ai),e.disco.addFeature(tn),e.disco.addFeature(Zn),e.disco.addFeature(hi),e.disco.addFeature(mn),e.disco.addFeature(Mt),e.disco.addFeature(Pn),e.disco.addFeature(hn),e.disco.addFeature(bn);const t=["sha-1","sha-256","sha-512","md5"];for(const n of t)e.disco.addFeature(Yn(n));e.disco.addFeature(Nn),e.disco.addFeature(ln),e.on("iq:get:softwareVersion",t=>e.sendIQResult(t,{softwareVersion:e.config.softwareVersion||{name:"stanzajs.org",version:Qr}})),e.on("iq:get:time",t=>{const n=new Date;e.sendIQResult(t,{time:{tzo:n.getTimezoneOffset(),utc:n}})}),e.getSoftwareVersion=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({softwareVersion:{},to:t,type:"get"})).softwareVersion})),e.getTime=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({time:{},to:t,type:"get"})).time})),e.getLastActivity=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({lastActivity:{},to:t,type:"get"})).lastActivity}))}function xs(e){e.features={handlers:{},negotiated:{},order:[]},e.registerFeature=function(t,n,i){this.features.order.push({name:t,priority:n}),this.features.order.sort((e,t)=>e.priority-t.priority),this.features.handlers[t]=i.bind(e)},e.on("features",t=>Object(r.a)(this,void 0,void 0,(function*(){const n=[],i=e.features.negotiated,r=e.features.handlers;for(const s of e.features.order){const e=s.name;t[e]&&r[e]&&!i[e]&&n.push(()=>new Promise(n=>{i[e]?n():r[e](t,(e,t)=>{e?n({command:e,message:t}):n()})}))}for(const t of n){let n="",i="";try{const e=yield t();e&&(n=e.command,i=e.message||"")}catch(e){n="disconnect",i=e.message,console.error(e)}if(n)return"restart"===n&&e.transport&&e.transport.restart(),void("disconnect"===n&&(e.emit("stream:error",{condition:"policy-violation",text:"Failed to negotiate stream features: "+i}),e.disconnect()))}})))}function js(e,t){return Object(r.a)(this,void 0,void 0,(function*(){"string"==typeof t&&(t={host:t});const n=Object.assign({json:!0,ssl:!0,xrd:!0},t),i=n.ssl?"https://":"http://";return function(e){return Object(r.a)(this,void 0,void 0,(function*(){try{const t=yield Promise.all(e.map(e=>e.then(e=>Promise.reject(e),e=>Promise.resolve(e))));return Promise.reject(t)}catch(e){return Promise.resolve(e)}}))}([pr(`${i}${n.host}/.well-known/host-meta.json`).then(e=>Object(r.a)(this,void 0,void 0,(function*(){if(!e.ok)throw new Error("could-not-fetch-json");return e.json()}))),pr(`${i}${n.host}/.well-known/host-meta`).then(t=>Object(r.a)(this,void 0,void 0,(function*(){if(!t.ok)throw new Error("could-not-fetch-xml");const n=ge(yield t.text());if(n)return e.import(n)})))])}))}function ks(e,t){e.discoverBindings=e=>Object(r.a)(this,void 0,void 0,(function*(){try{const n=yield js(t,e),i={bosh:[],websocket:[]},r=n.links||[];for(const e of r)e.href&&e.rel===vn&&i.websocket.push(e.href),e.href&&e.rel===wn&&i.bosh.push(e.href);return i}catch(e){return{}}}))}function Ts(e){const t=Object(l.getMediaSections)(e),n=Object(l.getDescription)(e),i={groups:[],media:[]};for(const e of Object(l.matchPrefix)(n,"a=group:")){const t=e.split(" "),n=t.shift().substr(8);i.groups.push({mids:t,semantics:n})}for(const e of t){const t=Object(l.getKind)(e),r=Object(l.isRejected)(e),s=Object(l.parseMLine)(e),a={direction:Object(l.getDirection)(e,n),kind:t,mid:Object(l.getMid)(e),protocol:s.protocol};if(r||(a.iceParameters=Object(l.getIceParameters)(e,n),a.dtlsParameters=Object(l.getDtlsParameters)(e,n),a.setup=Object(l.matchPrefix)(e,"a=setup:")[0].substr(8)),"audio"===t||"video"===t){a.rtpParameters=Object(l.parseRtpParameters)(e),a.rtpEncodingParameters=Object(l.parseRtpEncodingParameters)(e),a.rtcpParameters=Object(l.parseRtcpParameters)(e);const t=Object(l.parseMsid)(e);a.streams=t?[t]:[]}else"application"===t&&(a.sctp=Object(l.parseSctpDescription)(e));a.candidates=Object(l.matchPrefix)(e,"a=candidate:").map(l.parseCandidate),i.media.push(a)}return i}function Is(e){const t=[];t.push(Object(l.writeSessionBoilerplate)(e.sessionId,e.sessionVersion),"a=msid-semantic:WMS *\r\n"),e.iceLite&&t.push("a=ice-lite\r\n");for(const n of e.groups||[])t.push(`a=group:${n.semantics} ${n.mids.join(" ")}\r\n`);for(const n of e.media||[]){const e=!(n.iceParameters&&n.dtlsParameters);if("application"===n.kind&&n.sctp)t.push(Object(l.writeSctpDescription)(n,n.sctp));else if(n.rtpParameters){let i=Object(l.writeRtpDescription)(n.kind,n.rtpParameters);e&&(i=i.replace(`m=${n.kind} 9 `,`m=${n.kind} 0 `)),t.push(i),t.push(`a=${n.direction||"sendrecv"}\r\n`);for(const e of n.streams||[])t.push(`a=msid:${e.stream} ${e.track}\r\n`);if(n.rtcpParameters&&n.rtcpParameters.cname&&(t.push(`a=ssrc:${n.rtcpParameters.ssrc} cname:${n.rtcpParameters.cname}\r\n`),n.rtpEncodingParameters&&n.rtpEncodingParameters[0].rtx)){const e=n.rtpEncodingParameters[0];t.push(`a=ssrc-group:FID ${e.ssrc} ${e.rtx.ssrc}\r\n`),t.push(`a=ssrc:${e.rtx.ssrc} cname:${n.rtcpParameters.cname}\r\n`)}}if(void 0!==n.mid&&t.push(`a=mid:${n.mid}\r\n`),n.iceParameters&&t.push(Object(l.writeIceParameters)(n.iceParameters)),n.dtlsParameters&&n.setup&&t.push(Object(l.writeDtlsParameters)(n.dtlsParameters,n.setup)),n.candidates&&n.candidates.length)for(const e of n.candidates)t.push(`a=${Object(l.writeCandidate)(e)}`)}return t.join("")}function Es(e,t){const n=e.rtpParameters,i=e.rtcpParameters||{},r=e.rtpEncodingParameters||[];let s=!1;r&&r.length&&(s=!!r[0].ssrc);const a={applicationType:xn,codecs:[],headerExtensions:[],media:e.kind,rtcpMux:i.mux,rtcpReducedSize:i.reducedSize,sourceGroups:[],sources:[],ssrc:s?r[0].ssrc.toString():void 0,streams:[]};for(const e of n.headerExtensions||[])a.headerExtensions.push({id:e.id,senders:e.direction&&"sendrecv"!==e.direction?ws(t,e.direction):void 0,uri:e.uri});i.ssrc&&i.cname&&(a.sources=[{parameters:{cname:i.cname},ssrc:i.ssrc.toString()}]),s&&r[0]&&r[0].rtx&&(a.sourceGroups=[{semantics:"FID",sources:[r[0].ssrc.toString(),r[0].rtx.ssrc.toString()]}]);for(const t of e.streams||[])a.streams.push({id:t.stream,track:t.track});for(const e of n.codecs||[]){const t={channels:e.channels,clockRate:e.clockRate,id:e.payloadType.toString(),maxptime:e.maxptime?e.maxptime.toString():void 0,name:e.name,parameters:e.parameters,rtcpFeedback:e.rtcpFeedback};for(const n of Object.keys(e.parameters||{}))"ptime"===n&&(t.ptime=e.parameters[n].toString());a.codecs.push(t)}return a}function Os(e){return{component:e.component,foundation:e.foundation,generation:void 0,id:void 0,ip:e.ip,network:void 0,port:e.port,priority:e.priority,protocol:e.protocol,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort,tcpType:e.tcpType,type:e.type}}function Cs(e,t){const n=e.iceParameters,i=e.dtlsParameters,r={candidates:[],transportType:t};n&&(r.usernameFragment=n.usernameFragment,r.password=n.password),i&&(r.fingerprints=i.fingerprints.map(t=>({algorithm:t.algorithm,setup:e.setup,value:t.value}))),e.sctp&&(r.sctp=e.sctp);for(const t of e.candidates||[])r.candidates.push(Os(t));return r}function Rs(e,t,n){return{contents:e.media.map(e=>{return{application:"audio"===e.kind||"video"===e.kind?Es(e,t):{applicationType:"datachannel",protocol:e.protocol},creator:es.Initiator,name:e.mid,senders:ws(t,e.direction),transport:Cs(e,n)}}),groups:e.groups?e.groups.map(e=>({contents:e.mids,semantics:e.semantics})):[]}}function qs(e,t){const n=e.application||{},i=e.transport,r=n&&n.applicationType===xn,s={direction:vs(t,e.senders),kind:n.media||"application",mid:e.name,protocol:r?"UDP/TLS/RTP/SAVPF":"UDP/DTLS/SCTP"};if(r){if(s.rtcpParameters={mux:n.rtcpMux,reducedSize:n.rtcpReducedSize},n.sources&&n.sources.length){const e=n.sources[0];s.rtcpParameters.ssrc=parseInt(e.ssrc,10),e.parameters&&(s.rtcpParameters.cname=e.parameters.cname)}if(s.rtpParameters={codecs:[],fecMechanisms:[],headerExtensions:[]},n.streams){s.streams=[];for(const e of n.streams)s.streams.push({stream:e.id,track:e.track})}if(n.ssrc&&(s.rtpEncodingParameters=[{ssrc:parseInt(n.ssrc,10)}],n.sourceGroups&&n.sourceGroups.length)){const e=n.sourceGroups[0];s.rtpEncodingParameters[0].rtx={ssrc:parseInt(e.sources[1],10)}}for(const e of n.codecs||[]){const t=e.parameters||{},n=[];for(const t of e.rtcpFeedback||[])n.push({parameter:t.parameter,type:t.type});s.rtpParameters.codecs.push({channels:e.channels,clockRate:e.clockRate,name:e.name,numChannels:e.channels,parameters:t,payloadType:parseInt(e.id,10),rtcpFeedback:n})}for(const e of n.headerExtensions||[])s.rtpParameters.headerExtensions.push({direction:e.senders&&"both"!==e.senders?vs(t,e.senders):void 0,id:e.id,uri:e.uri})}if(i&&(i.usernameFragment&&i.password&&(s.iceParameters={password:i.password,usernameFragment:i.usernameFragment}),i.fingerprints&&i.fingerprints.length)){s.dtlsParameters={fingerprints:[],role:"auto"};for(const e of i.fingerprints)s.dtlsParameters.fingerprints.push({algorithm:e.algorithm,value:e.value});i.sctp&&(s.sctp=i.sctp),s.setup=i.fingerprints[0].setup}return s}function Ns(e,t){const n={groups:[],media:[]};for(const t of e.groups||[])n.groups.push({mids:t.contents,semantics:t.semantics});for(const i of e.contents||[])n.media.push(qs(i,t));return n}const As={condition:Jr.BadRequest},Ps={condition:Jr.FeatureNotImplemented,jingleError:rs.UnsupportedInfo,type:"modify"};class Fs{constructor(e){this.parent=e.parent,this.sid=e.sid||Ar(),this.peerID=e.peerID,this.role=e.initiator?es.Initiator:es.Responder,this._sessionState="starting",this._connectionState="starting",this.pendingApplicationTypes=e.applicationTypes||[],this.pendingAction=void 0,this.processingQueue=Object(u.a)((e,t)=>Object(r.a)(this,void 0,void 0,(function*(){if("ended"===this.state)return"local"===e.type&&e.reject&&e.reject(new Error("Session ended")),void(t&&t());if("local"===e.type){this._log("debug","Processing local action:",e.name);try{const t=yield e.handler();e.resolve(t)}catch(t){e.reject(t)}return void(t&&t())}const{action:n,changes:i,cb:r}=e;return this._log("debug","Processing remote action:",n),new Promise(e=>{const s=(n,i)=>{r(n,i),t&&t(),e()};switch(n){case is.ContentAccept:return this.onContentAccept(i,s);case is.ContentAdd:return this.onContentAdd(i,s);case is.ContentModify:return this.onContentModify(i,s);case is.ContentReject:return this.onContentReject(i,s);case is.ContentRemove:return this.onContentRemove(i,s);case is.DescriptionInfo:return this.onDescriptionInfo(i,s);case is.SecurityInfo:return this.onSecurityInfo(i,s);case is.SessionAccept:return this.onSessionAccept(i,s);case is.SessionInfo:return this.onSessionInfo(i,s);case is.SessionInitiate:return this.onSessionInitiate(i,s);case is.SessionTerminate:return this.onSessionTerminate(i,s);case is.TransportAccept:return this.onTransportAccept(i,s);case is.TransportInfo:return this.onTransportInfo(i,s);case is.TransportReject:return this.onTransportReject(i,s);case is.TransportReplace:return this.onTransportReplace(i,s);default:this._log("error","Invalid or unsupported action: "+n),s({condition:Jr.BadRequest})}})})),1)}get isInitiator(){return this.role===es.Initiator}get peerRole(){return this.isInitiator?es.Responder:es.Initiator}get state(){return this._sessionState}set state(e){e!==this._sessionState&&(this._log("info","Changing session state to: "+e),this._sessionState=e,this.parent&&this.parent.emit("sessionState",this,e))}get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._log("info","Changing connection state to: "+e),this._connectionState=e,this.parent&&this.parent.emit("connectionState",this,e))}send(e,t){(t=t||{}).sid=this.sid,t.action=e,new Set([is.ContentAccept,is.ContentAdd,is.ContentModify,is.ContentReject,is.ContentRemove,is.SessionAccept,is.SessionInitiate,is.TransportAccept,is.TransportReject,is.TransportReplace]).has(e)?this.pendingAction=e:this.pendingAction=void 0,this.parent.signal(this,{id:Ar(),jingle:t,to:this.peerID,type:"set"})}processLocal(e,t){return new Promise((n,i)=>{this.processingQueue.push({handler:t,name:e,reject:i,resolve:n,type:"local"},1)})}process(e,t,n){this.processingQueue.push({action:e,cb:n,changes:t,type:"remote"},2)}start(e,t){this._log("error","Can not start base sessions"),this.end("unsupported-applications",!0)}accept(e,t){this._log("error","Can not accept base sessions"),this.end("unsupported-applications")}cancel(){this.end("cancel")}decline(){this.end("decline")}end(e="success",t=!1){this.state="ended",this.processingQueue.kill(),"string"==typeof e&&(e={condition:e}),t||this.send("session-terminate",{reason:e}),this.parent.emit("terminated",this,e),this.parent.forgetSession(this)}_log(e,t,...n){this.parent&&(t=this.sid+": "+t,this.parent.emit("log:"+e,t,...n))}onSessionInitiate(e,t){t()}onSessionAccept(e,t){t()}onSessionTerminate(e,t){this.end(e.reason,!0),t()}onSessionInfo(e,t){e.info?t(Ps):t()}onSecurityInfo(e,t){t(Ps)}onDescriptionInfo(e,t){t(Ps)}onTransportInfo(e,t){t(Ps)}onContentAdd(e,t){t(),this.send(is.ContentReject,{reason:{condition:ss.FailedApplication,text:"content-add is not supported"}})}onContentAccept(e,t){t(As)}onContentReject(e,t){t(As)}onContentModify(e,t){t(As)}onContentRemove(e,t){t(As)}onTransportReplace(e,t){t(),this.send(is.TransportReject,{reason:{condition:ss.FailedTransport,text:"transport-replace is not supported"}})}onTransportAccept(e,t){t(As)}onTransportReject(e,t){t(As)}}class Ms extends Fs{constructor(e){super(e),this.transportType=En,this.pc=new RTCPeerConnection(Object.assign(Object.assign({},e.config),{iceServers:e.iceServers}),e.constraints),this.pc.addEventListener("iceconnectionstatechange",()=>{this.onIceStateChange()}),this.pc.addEventListener("icecandidate",e=>{e.candidate?this.onIceCandidate(e):this.onIceEndOfCandidates()}),this.restrictRelayBandwidth(),this.bitrateLimit=0,this.maxRelayBandwidth=e.maxRelayBandwidth,this.candidateBuffer=[],this.restartingIce=!1}end(e="success",t=!1){this.pc.close(),super.end(e,t)}restartIce(){return Object(r.a)(this,void 0,void 0,(function*(){if(this.isInitiator){void 0!==this._maybeRestartingIce&&clearTimeout(this._maybeRestartingIce),this.restartingIce=!0;try{yield this.processLocal("restart-ice",()=>Object(r.a)(this,void 0,void 0,(function*(){const e=yield this.pc.createOffer({iceRestart:!0}),t=Ts(e.sdp);this.send(is.TransportInfo,{contents:t.media.map(e=>({creator:es.Initiator,name:e.mid,transport:Cs(e,this.transportType)})),sid:this.sid}),yield this.pc.setLocalDescription(e)})))}catch(e){this._log("error","Could not create WebRTC offer",e),this.end(ss.FailedTransport,!0)}}}))}setMaximumBitrate(e){return Object(r.a)(this,void 0,void 0,(function*(){if(this.maximumBitrate&&(e=Math.min(e,this.maximumBitrate)),this.currentBitrate=e,!(window.RTCRtpSender&&"getParameters"in window.RTCRtpSender.prototype))return;const t=this.pc.getSenders().find(e=>!!e.track&&"video"===e.track.kind);if(!t)return;let n="";window.navigator&&window.navigator.mozGetUserMedia?n="firefox":window.navigator&&window.navigator.webkitGetUserMedia&&(n="chrome");const i=t.getParameters();"firefox"!==n||i.encodings||(i.encodings=[{}]),0===e?delete i.encodings[0].maxBitrate:(i.encodings.length||(i.encodings[0]={}),i.encodings[0].maxBitrate=e);try{yield this.processLocal("set-bitrate",()=>Object(r.a)(this,void 0,void 0,(function*(){if("chrome"===n)yield t.setParameters(i);else if("firefox"===n)if("stable"!==this.pc.signalingState)yield t.setParameters(i);else if(this.pc.localDescription&&"offer"===this.pc.localDescription.type){yield t.setParameters(i);const e=yield this.pc.createOffer();yield this.pc.setLocalDescription(e),yield this.pc.setRemoteDescription(this.pc.remoteDescription),yield this.processBufferedCandidates()}else if(this.pc.localDescription&&"answer"===this.pc.localDescription.type){yield t.setParameters(i),yield this.pc.setRemoteDescription(this.pc.remoteDescription),yield this.processBufferedCandidates();const e=yield this.pc.createAnswer();yield this.pc.setLocalDescription(e)}})))}catch(e){this._log("error","setParameters failed",e)}}))}onTransportInfo(e,t){return Object(r.a)(this,void 0,void 0,(function*(){if(e.contents&&e.contents[0]&&e.contents[0].transport.gatheringComplete){try{"stable"===this.pc.signalingState?yield this.pc.addIceCandidate(null):this.candidateBuffer.push(null)}catch(e){this._log("debug","Could not add null ICE candidate")}finally{t()}return}if(this.pc.remoteDescription){const n=this.pc.remoteDescription,i=Ts(n.sdp),r=i.media.find(t=>t.mid===e.contents[0].name).iceParameters.usernameFragment,s=e.contents[0].transport.usernameFragment;if(s&&r!==s){if(e.contents.forEach((e,t)=>{const n=e.transport;i.media[t].iceParameters={password:n.password,usernameFragment:n.usernameFragment},i.media[t].candidates=[]}),"offer"===n.type){try{yield this.pc.setRemoteDescription(n),yield this.processBufferedCandidates();const e=yield this.pc.createAnswer(),i=Ts(e.sdp);this.send(is.TransportInfo,{contents:i.media.map(e=>({creator:es.Initiator,name:e.mid,transport:Cs(e,this.transportType)})),sid:this.sid}),yield this.pc.setLocalDescription(e),t()}catch(e){this._log("error","Could not do remote ICE restart",e),t(e),this.end(ss.FailedTransport)}return}try{yield this.pc.setRemoteDescription(n),yield this.processBufferedCandidates(),t()}catch(e){this._log("error","Could not do local ICE restart",e),t(e),this.end(ss.FailedTransport)}}}const n=(e.contents||[]).map(e=>{const t=e.name,n=(e.transport.candidates||[]).map(e=>Object(r.a)(this,void 0,void 0,(function*(){const n=Object(l.writeCandidate)(function(e){return{address:e.ip,component:e.component,foundation:e.foundation,ip:e.ip,port:e.port,priority:e.priority,protocol:e.protocol,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort,tcpType:e.tcpType,type:e.type}}(e));let i;const r=this.pc.remoteDescription.sdp,s=Object(l.getMediaSections)(r);for(let e=0;e<s.length;e++)if(Object(l.getMid)(s[e])===t){i=e;break}if("stable"===this.pc.signalingState)try{yield this.pc.addIceCandidate({sdpMid:t,sdpMLineIndex:i,candidate:n})}catch(e){this._log("error","Could not add ICE candidate",e)}else this.candidateBuffer.push({sdpMid:t,sdpMLineIndex:i,candidate:n})})));return Promise.all(n)});try{yield Promise.all(n),t()}catch(e){t(e)}}))}onSessionAccept(e,t){return Object(r.a)(this,void 0,void 0,(function*(){this.state="active";const n=Is(Ns(e,this.peerRole));try{yield this.pc.setRemoteDescription({type:"answer",sdp:n}),yield this.processBufferedCandidates(),this.parent.emit("accepted",this,void 0),t()}catch(e){this._log("error",`Could not process WebRTC answer: ${e}`),t({condition:"general-error"})}}))}onSessionTerminate(e,t){this._log("info","Terminating session"),this.pc.close(),super.end(e.reason,!0),t()}onIceCandidate(e){if(!e.candidate.candidate)return;const t=Object(l.parseCandidate)(e.candidate.candidate),n=function(e,t,n){return{contents:[{creator:es.Initiator,name:e,transport:{candidates:[Os(t)],transportType:n,usernameFragment:t.usernameFragment||void 0}}]}}(e.candidate.sdpMid,t,this.transportType);n.contents.forEach((e,t)=>{const n=e.transport;if(!n.usernameFragment){const e=Ts(this.pc.localDescription.sdp);n.usernameFragment=e.media[t].iceParameters.usernameFragment}}),this._log("info","Discovered new ICE candidate",n),this.send(is.TransportInfo,n)}onIceEndOfCandidates(){this._log("info","ICE end of candidates");const e=Ts(this.pc.localDescription.sdp).media[0];this.send(is.TransportInfo,{contents:[{creator:es.Initiator,name:e.mid,transport:{gatheringComplete:!0,transportType:this.transportType,usernameFragment:e.iceParameters.usernameFragment}}]})}onIceStateChange(){switch(this.pc.iceConnectionState){case"checking":this.connectionState="connecting";break;case"completed":case"connected":this.connectionState="connected",this.restartingIce=!1;break;case"disconnected":if("stable"===this.pc.signalingState?this.connectionState="interrupted":this.connectionState="disconnected",this.restartingIce)return void this.end(ss.FailedTransport);this.maybeRestartIce();break;case"failed":if("failed"===this.connectionState||this.restartingIce)return void this.end(ss.FailedTransport);this.connectionState="failed",this.restartIce();break;case"closed":this.connectionState="disconnected",this.restartingIce?this.end(ss.FailedTransport):this.end()}}processBufferedCandidates(){return Object(r.a)(this,void 0,void 0,(function*(){for(const e of this.candidateBuffer)try{yield this.pc.addIceCandidate(e)}catch(e){this._log("error","Could not add ICE candidate",e)}this.candidateBuffer=[]}))}restrictRelayBandwidth(){window.RTCRtpSender&&"getParameters"in window.RTCRtpSender.prototype&&this.pc.addEventListener("iceconnectionstatechange",()=>Object(r.a)(this,void 0,void 0,(function*(){if("completed"!==this.pc.iceConnectionState&&"connected"!==this.pc.iceConnectionState)return;if(this._firstTimeConnected)return;this._firstTimeConnected=!0;const e=yield this.pc.getStats();let t;if(e.forEach(n=>{"transport"===n.type&&(t=e.get(n.selectedCandidatePairId))}),t||e.forEach(e=>{"candidate-pair"===e.type&&e.selected&&(t=e)}),t){let n=!1;if(t.remoteCandidateId){const i=e.get(t.remoteCandidateId);i&&"relay"===i.candidateType&&(n=!0)}if(t.localCandidateId){const i=e.get(t.localCandidateId);i&&"relay"===i.candidateType&&(n=!0)}n&&(this.maximumBitrate=this.maxRelayBandwidth,this.currentBitrate&&this.setMaximumBitrate(Math.min(this.currentBitrate,this.maximumBitrate)))}})))}maybeRestartIce(){this.isInitiator&&(void 0!==this._maybeRestartingIce&&clearTimeout(this._maybeRestartingIce),this._maybeRestartingIce=setTimeout(()=>{delete this._maybeRestartingIce,"disconnected"===this.pc.iceConnectionState&&this.restartIce()},2e3))}}class Ls extends s.EventEmitter{constructor(e={}){super(),this.config=Object.assign({chunkSize:16384,hash:"sha-1"},e),this.file=void 0,this.channel=void 0,this.hash=ar(this.config.hash)}send(e,t){if(this.file&&this.channel)return;this.file=e,this.channel=t,this.channel.binaryType="arraybuffer";const n=new FileReader;let i=0,r=!1;n.addEventListener("load",t=>{const n=t.target.result;r=!1,i+=n.byteLength,this.channel.send(n),this.hash.update(new Uint8Array(n)),this.emit("progress",i,e.size,n),i<e.size?this.channel.bufferedAmount<=this.channel.bufferedAmountLowThreshold&&s():(this.emit("progress",e.size,e.size,null),this.emit("sentFile",{algorithm:this.config.hash,name:e.name,size:e.size,value:this.hash.digest()}))});const s=()=>{if(r||i>=e.size)return;r=!0;const t=e.slice(i,i+this.config.chunkSize);n.readAsArrayBuffer(t)};t.bufferedAmountLowThreshold=8*this.config.chunkSize,t.onbufferedamountlow=()=>{s()},s()}}class Ds extends s.EventEmitter{constructor(e={}){super(),this.config=Object.assign({hash:"sha-1"},e),this.receiveBuffer=[],this.received=0,this.channel=void 0,this.hash=ar(this.config.hash)}receive(e,t){this.metadata=e,this.channel=t,this.channel.binaryType="arraybuffer",this.channel.onmessage=e=>{const t=e.data.byteLength;this.received+=t,this.receiveBuffer.push(e.data),e.data&&this.hash.update(new Uint8Array(e.data)),this.emit("progress",this.received,this.metadata.size,e.data),this.received===this.metadata.size?(this.metadata.actualhash=this.hash.digest("hex"),this.emit("receivedFile",new Blob(this.receiveBuffer),this.metadata),this.receiveBuffer=[]):this.received>this.metadata.size&&(console.error("received more than expected, discarding..."),this.receiveBuffer=[])}}}class Bs extends Ms{constructor(e){super(e),this.sender=void 0,this.receiver=void 0,this.file=void 0}start(e,t){return Object(r.a)(this,void 0,void 0,(function*(){if(t=t||(()=>void 0),!e||"function"==typeof e)throw new Error("File object required");this.state="pending",this.role="initiator",this.file=e,this.sender=new Ls,this.sender.on("progress",(e,t)=>{this._log("info","Send progress "+e+"/"+t)}),this.sender.on("sentFile",e=>{this._log("info","Sent file",e.name),this.send(is.SessionInfo,{info:{creator:es.Initiator,file:{hashes:[{algorithm:e.algorithm,value:e.value}]},infoType:gs,name:this.contentName}}),this.parent.emit("sentFile",this,e)}),this.channel=this.pc.createDataChannel("filetransfer",{ordered:!0}),this.channel.onopen=()=>{this.sender.send(this.file,this.channel)};try{yield this.processLocal(is.SessionInitiate,()=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.pc.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1}),n=Rs(Ts(t.sdp),this.role,this.transportType);this.contentName=n.contents[0].name,n.sid=this.sid,n.action=is.SessionInitiate,n.contents[0].application={applicationType:Dn,file:{date:e.lastModified?new Date(e.lastModified):void 0,hashesUsed:[{algorithm:"sha-1"}],name:e.name,size:e.size}},this.send("session-initiate",n),yield this.pc.setLocalDescription(t)}))),t()}catch(e){return this._log("error","Could not create WebRTC offer",e),this.end("failed-application",!0)}}))}accept(e){return Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Accepted incoming session"),this.role="responder",this.state="active",e=e||(()=>void 0);try{yield this.processLocal(is.SessionAccept,()=>Object(r.a)(this,void 0,void 0,(function*(){const e=yield this.pc.createAnswer(),t=Rs(Ts(e.sdp),this.role,this.transportType);t.sid=this.sid,t.action="session-accept",t.contents.forEach(e=>{e.creator="initiator"}),this.contentName=t.contents[0].name,this.send("session-accept",t),yield this.pc.setLocalDescription(e)}))),e()}catch(e){this._log("error","Could not create WebRTC answer",e),this.end("failed-application")}}))}onSessionInitiate(e,t){return Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Initiating incoming session"),this.role="responder",this.state="pending",this.transportType=e.contents[0].transport.transportType;const n=Is(Ns(e,this.peerRole)),i=e.contents[0].application,r=i.file.hashesUsed?i.file.hashesUsed:i.file.hashes||[];this.receiver=new Ds({hash:r[0]&&r[0].algorithm}),this.receiver.on("progress",(e,t)=>{this._log("info","Receive progress "+e+"/"+t)}),this.receiver.on("receivedFile",e=>{this.receivedFile=e,this._maybeReceivedFile()}),this.receiver.metadata=i.file,this.pc.addEventListener("datachannel",e=>{this.channel=e.channel,this.receiver.receive(this.receiver.metadata,e.channel)});try{yield this.pc.setRemoteDescription({type:"offer",sdp:n}),yield this.processBufferedCandidates(),t()}catch(e){this._log("error","Could not create WebRTC answer",e),t({condition:"general-error"})}}))}onSessionInfo(e,t){const n=e.info;n&&n.file&&n.file.hashes&&(this.receiver.metadata.hashes=n.file.hashes,this.receiver.metadata.actualhash&&this._maybeReceivedFile(),t())}_maybeReceivedFile(){if(this.receiver.metadata.hashes&&this.receiver.metadata.hashes.length){for(const e of this.receiver.metadata.hashes||[])if(e.value&&e.value.toString("hex")===this.receiver.metadata.actualhash)return this._log("info","File hash matches"),this.parent.emit("receivedFile",this,this.receivedFile,this.receiver.metadata),void this.end("success");this._log("error","File hash does not match"),this.end("media-error")}}}function Us(e){const t=e.application;if(t.streams&&t.streams.length&&t.sources&&t.sources.length){const e=t.streams[0];t.sources[0].parameters.msid=`${e.id} ${e.track}`,t.sourceGroups&&t.sourceGroups.length>0&&t.sources.push({parameters:{cname:t.sources[0].parameters.cname,msid:`${e.id} ${e.track}`},ssrc:t.sourceGroups[0].sources[1]})}}class zs extends Ms{constructor(e){if(super(e),this._ringing=!1,this.pc.addEventListener("track",e=>{this.onAddTrack(e.track,e.streams[0])}),e.stream)for(const t of e.stream.getTracks())this.addTrack(t,e.stream)}get ringing(){return this._ringing}set ringing(e){e!==this._ringing&&(this._ringing=e)}get streams(){return"closed"!==this.pc.signalingState?this.pc.getRemoteStreams():[]}start(e,t){return Object(r.a)(this,arguments,void 0,(function*(){this.state="pending",1===arguments.length&&"function"==typeof e&&(t=e,e={}),t=t||(()=>void 0),e=e||{},this.role="initiator",this.offerOptions=e;try{yield this.processLocal(is.SessionInitiate,()=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.pc.createOffer(e),n=Rs(Ts(t.sdp),this.role,this.transportType);n.sid=this.sid,n.action=is.SessionInitiate;for(const e of n.contents||[])e.creator="initiator",Us(e);yield this.pc.setLocalDescription(t),this.send("session-initiate",n)}))),t()}catch(e){this._log("error","Could not create WebRTC offer",e),this.end("failed-application",!0)}}))}accept(e,t){return Object(r.a)(this,arguments,void 0,(function*(){1===arguments.length&&"function"==typeof e&&(t=e,e={}),t=t||(()=>void 0),e=e||{},this._log("info","Accepted incoming session"),this.state="active",this.role="responder";try{yield this.processLocal(is.SessionAccept,()=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.pc.createAnswer(e),n=Rs(Ts(t.sdp),this.role,this.transportType);n.sid=this.sid,n.action=is.SessionAccept;for(const e of n.contents||[])e.creator="initiator";yield this.pc.setLocalDescription(t),this.send("session-accept",n)}))),t()}catch(e){this._log("error","Could not create WebRTC answer",e),this.end("failed-application")}}))}end(e="success",t=!1){for(const e of this.pc.getReceivers())this.onRemoveTrack(e.track);super.end(e,t)}ring(){return this.processLocal("ring",()=>Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Ringing on incoming session"),this.ringing=!0,this.send(is.SessionInfo,{info:{infoType:ms}})})))}mute(e,t){return this.processLocal("mute",()=>Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Muting",t),this.send(is.SessionInfo,{info:{creator:e,infoType:us,name:t}})})))}unmute(e,t){return this.processLocal("unmute",()=>Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Unmuting",t),this.send(is.SessionInfo,{info:{creator:e,infoType:ps,name:t}})})))}hold(){return this.processLocal("hold",()=>Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Placing on hold"),this.send("session-info",{info:{infoType:ds}})})))}resume(){return this.processLocal("resume",()=>Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Resuming from hold"),this.send("session-info",{info:{infoType:fs}})})))}addTrack(e,t,n){return this.processLocal("addtrack",()=>Object(r.a)(this,void 0,void 0,(function*(){this.pc.addTrack?this.pc.addTrack(e,t):this.pc.addStream(t),n&&n()})))}removeTrack(e,t){return Object(r.a)(this,void 0,void 0,(function*(){return this.processLocal("removetrack",()=>Object(r.a)(this,void 0,void 0,(function*(){if(this.pc.removeTrack(e),t)return t()})))}))}onAddTrack(e,t){this._log("info","Track added"),this.parent.emit("peerTrackAdded",this,e,t)}onRemoveTrack(e){this._log("info","Track removed"),this.parent.emit("peerTrackRemoved",this,e)}onSessionInitiate(e,t){return Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Initiating incoming session"),this.state="pending",this.role="responder",this.transportType=e.contents[0].transport.transportType;const n=Ns(e,this.peerRole);n.media.forEach(e=>{e.streams||(e.streams=[{stream:"legacy",track:e.kind}])});const i=Is(n);try{return yield this.pc.setRemoteDescription({type:"offer",sdp:i}),yield this.processBufferedCandidates(),t()}catch(e){return this._log("error","Could not create WebRTC answer",e),t({condition:"general-error"})}}))}onSessionTerminate(e,t){for(const e of this.pc.getReceivers())this.onRemoveTrack(e.track);super.onSessionTerminate(e,t)}onSessionInfo(e,t){const n=e.info||{infoType:""};switch(n.infoType){case ms:return this._log("info","Outgoing session is ringing"),this.ringing=!0,this.parent.emit("ringing",this),t();case ds:return this._log("info","On hold"),this.parent.emit("hold",this),t();case hs:case fs:return this._log("info","Resuming from hold"),this.parent.emit("resumed",this),t();case us:return this._log("info","Muting",n),this.parent.emit("mute",this,n),t();case ps:return this._log("info","Unmuting",n),this.parent.emit("unmute",this,n),t()}return t()}}const $s=786432;class Qs extends s.EventEmitter{constructor(e={}){super(),e=e||{},this.selfID=e.selfID,this.sessions={},this.peers={},this.iceServers=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],this.prepareSession=e.prepareSession||(e=>e.applicationTypes.indexOf(xn)>=0?new zs(e):e.applicationTypes.indexOf(Dn)>=0?new Bs(e):void 0),this.performTieBreak=e.performTieBreak||((e,t)=>{const n=(t.jingle.contents||[]).map(e=>{if(e.application)return e.application.applicationType});return(e.pendingApplicationTypes||[]).filter(e=>n.includes(e)).length>0}),this.config=Object.assign({debug:!1,peerConnectionConfig:{bundlePolicy:e.bundlePolicy||"balanced",iceTransportPolicy:e.iceTransportPolicy||"all",rtcpMuxPolicy:e.rtcpMuxPolicy||"require",sdpSemantics:e.sdpSemantics||"plan-b"},peerConnectionConstraints:{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!1}]}},e)}addICEServer(e){"string"==typeof e&&(e={urls:e}),this.iceServers.push(e)}resetICEServers(){this.iceServers=[]}addSession(e){e.parent=this;const t=e.sid,n=e.peerID;return this.sessions[t]=e,this.peers[n]||(this.peers[n]=[]),this.peers[n].push(e),this.emit("createdSession",e),e}forgetSession(e){const t=this.peers[e.peerID]||[];t.length&&t.splice(t.indexOf(e),1),delete this.sessions[e.sid]}createMediaSession(e,t,n){const i=new zs({config:this.config.peerConnectionConfig,constraints:this.config.peerConnectionConstraints,iceServers:this.iceServers,initiator:!0,maxRelayBandwidth:$s,parent:this,peerID:e,sid:t,stream:n});return this.addSession(i),i}createFileTransferSession(e,t){const n=new Bs({config:this.config.peerConnectionConfig,constraints:this.config.peerConnectionConstraints,iceServers:this.iceServers,initiator:!0,maxRelayBandwidth:$s,parent:this,peerID:e,sid:t});return this.addSession(n),n}endPeerSessions(e,t,n=!1){const i=this.peers[e]||[];delete this.peers[e],i.forEach(e=>{e.end(t||"gone",n)})}endAllSessions(e,t=!1){Object.keys(this.peers).forEach(n=>{this.endPeerSessions(n,e,t)})}process(e){const t=this,n=e.jingle?e.jingle.sid:void 0;let i=n?this.sessions[n]:void 0;const r=e.id,s=e.from;if(!s)return;if("error"===e.type){const t=e.error&&"tie-break"===e.error.jingleError;return i&&"pending"===i.state&&t?i.end("alternative-session",!0):void(i&&(i.pendingAction=void 0))}if("result"===e.type)return void(i&&(i.pendingAction=void 0));const a=e.jingle.action,o=e.jingle.contents||[],c=o.map(e=>e.application?e.application.applicationType:void 0),l=o.map(e=>e.transport?e.transport.transportType:void 0);if(a!==is.SessionInitiate){if(!i)return"session-terminate"===a?void this.emit("send",{id:r,to:s,type:"result"}):(this._log("error","Unknown session",n),this._sendError(s,r,{condition:"item-not-found",jingleError:"unknown-session"}));if(i.peerID!==s||"ended"===i.state)return this._log("error","Session has ended, or action has wrong sender"),this._sendError(s,r,{condition:"item-not-found",jingleError:"unknown-session"});if("session-accept"===a&&"pending"!==i.state)return this._log("error","Tried to accept session twice",n),this._sendError(s,r,{condition:"unexpected-request",jingleError:"out-of-order"});if("session-terminate"!==a&&a===i.pendingAction&&(this._log("error","Tie break during pending request"),i.isInitiator))return this._sendError(s,r,{condition:"conflict",jingleError:"tie-break"})}else if(i){if(i.peerID!==s)return this._log("error","Duplicate sid from new sender"),this._sendError(s,r,{condition:"service-unavailable"});if("pending"!==i.state)return this._log("error","Someone is doing this wrong"),this._sendError(s,r,{condition:"unexpected-request",jingleError:"out-of-order"});if(this.selfID&&this.selfID>i.peerID&&this.performTieBreak(i,e))return this._log("error","Tie break new session because of duplicate sids"),this._sendError(s,r,{condition:"conflict",jingleError:"tie-break"})}else if(this.peers[s]&&this.peers[s].length)for(let t=0,i=this.peers[s].length;t<i;t++){const i=this.peers[s][t];if(i&&"pending"===i.state&&n&&Nr(i.sid,n)>0&&this.performTieBreak(i,e))return this._log("info","Tie break session-initiate"),this._sendError(s,r,{condition:"conflict",jingleError:"tie-break"})}if("session-initiate"===a){if(!o.length)return t._sendError(s,r,{condition:"bad-request"});i=this._createIncomingSession({applicationTypes:c,config:this.config.peerConnectionConfig,constraints:this.config.peerConnectionConstraints,iceServers:this.iceServers,initiator:!1,parent:this,peerID:s,sid:n,transportTypes:l},e)}i.process(a,e.jingle,t=>{t?(this._log("error","Could not process request",e,t),this._sendError(s,r,t)):(this.emit("send",{id:r,to:s,type:"result"}),"session-initiate"===a&&this.emit("incoming",i))})}signal(e,t){const n=t.jingle&&t.jingle.action;e.isInitiator&&n===is.SessionInitiate&&this.emit("outgoing",e),this.emit("send",t)}_createIncomingSession(e,t){let n;return this.prepareSession&&(n=this.prepareSession(e,t)),n||(n=new Fs(e)),this.addSession(n),n}_sendError(e,t,n){n.type||(n.type="cancel"),this.emit("send",{error:n,id:t,to:e,type:"error"})}_log(e,t,...n){this.emit("log:"+e,t,...n)}}var Vs=Object.freeze({__proto__:null,Session:Fs,ICESession:Ms,MediaSession:zs,FileSession:Bs,SessionManager:Qs});let Gs;try{Gs=window}catch(e){Gs=i}function Hs(e){const t=e.jingle=new Qs;if(e.disco.addFeature(Sn),Gs.RTCPeerConnection){const t=[xn,Vn,Gn,ci,ii,oi,di,En,kn,Tn,Ln,li,"urn:ietf:rfc:3264","urn:ietf:rfc:5576","urn:ietf:rfc:5888"];for(const n of t)e.disco.addFeature(n)}const n=["outgoing","incoming","accepted","terminated","ringing","mute","unmute","hold","resumed"];for(const i of n)t.on(i,(t,n)=>{e.emit("jingle:"+i,t,n)});t.on("createdSession",t=>{e.emit("jingle:created",t)}),t.on("send",n=>Object(r.a)(this,void 0,void 0,(function*(){try{if("set"===n.type){const i=yield e.sendIQ(n);i.jingle||(i.jingle={}),i.jingle.sid=n.jingle.sid,t.process(i)}"result"===n.type&&e.sendIQResult({type:"set",id:n.id,from:n.to},n),"error"===n.type&&e.sendIQError({type:"set",id:n.id,from:n.to},n)}catch(e){console.error(e),e.jingle||(e.jingle={}),e.jingle.sid=n.jingle.sid,t.process(e)}}))),e.on("session:bound",e=>{t.selfID=e}),e.on("iq:set:jingle",e=>{t.process(e)}),e.on("unavailable",e=>{t.endPeerSessions(e.from,void 0,!0)}),e.getServices=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){const i=(yield e.sendIQ({externalServices:{type:n},to:t,type:"get"})).externalServices;return i.services=i.services||[],i})),e.getServiceCredentials=(t,n,i,s)=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({externalServiceCredentials:{host:n,port:s,type:i},to:t,type:"get"})).externalServiceCredentials})),e.discoverICEServers=()=>Object(r.a)(this,void 0,void 0,(function*(){try{const t=(yield e.getServices(e.config.server)).services||[],n=[];for(const e of t){const t={urls:[]},i=`${e.type}:${e.host}`,r=e.port?`:${e.port}`:"",s=e.transport?`?transport=${e.transport}`:"";"stun"!==e.type&&"stuns"!==e.type||(t.urls=[`${i}${r}`]),"turn"!==e.type&&"turns"!==e.type||(e.username&&(t.username=e.username),e.password&&(t.credential=e.password),t.urls=[`${i}${r}${s}`]),t.urls.length&&n.push(t)}for(const t of n)e.jingle.addICEServer(t);return n}catch(e){return[]}}))}function Js(e){e.getHistorySearchForm=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({archive:{type:"query"},to:t,type:"get"})).archive.form})),e.searchHistory=(t,n={})=>Object(r.a)(this,void 0,void 0,(function*(){const i=e.nextId();let r="";"string"==typeof t?r=t:(r=t.to||"",n=t),n.queryId=i;const s=n.form||{};s.type="submit";const a=s.fields||[],o=[{name:"FORM_TYPE",type:"hidden",value:ei}];n.with&&o.push({name:"with",type:"text-single",value:n.with}),n.start&&o.push({name:"start",type:"text-single",value:n.start.toISOString()}),n.end&&o.push({name:"end",type:"text-single",value:n.end.toISOString()}),s.fields=function(e,t){const n=[],i=new Map;for(const e of t)e.name&&i.set(e.name,e);const r=new Set;for(const t of e)t.name&&i.has(t.name)?(n.push(Object.assign(Object.assign({},t),i.get(t.name))),r.add(t.name)):n.push(Object.assign({},t));for(const e of t)(!e.name||e.name&&!r.has(e.name))&&n.push(Object.assign({},e));return n}(o,a),n.form=s;const c=M(e.jid,r),l=[],u=e=>{c.has(e.from)&&e.archive&&e.archive.queryId===i&&l.push(e.archive)};e.on("mam:item",u);try{const t=yield e.sendIQ({archive:n,id:i,to:r,type:"set"});return Object.assign(Object.assign({},t.archive),{results:l})}finally{e.off("mam:item",u)}})),e.getHistoryPreferences=()=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({archive:{type:"preferences"},type:"get"})).archive})),e.setHistoryPreferences=t=>e.sendIQ({archive:Object.assign({type:"preferences"},t),type:"set"}),e.on("message",t=>{t.archive&&e.emit("mam:item",t)})}const Ws=new Set(["chat","headline","normal"]),Ys=new Set(["chat","groupchat","normal"]),Ks=e=>!!e.carbon&&"received"===e.carbon.type,Xs=e=>!!e.carbon&&"sent"===e.carbon.type,Zs=e=>!!e.chatState,ea=e=>!!e.receipt,ta=e=>!!e.rtt,na=e=>!!e.replace,ia=(e,t)=>e.marker&&"markable"===e.marker.type&&!1!==t.config.chatMarkers,ra=e=>!!e.forms&&e.forms.length>0;function sa(e,t){return Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({carbons:{action:t},type:"set"})}))}function aa(e,t,n){if(ia(t,e)){const i="groupchat"===t.type?z(t.from):t.from;e.sendMessage({body:"",marker:{id:t.id,type:n},to:i,type:t.type})}}function oa(e){e.disco.addFeature(Fn),e.disco.addFeature(ri),e.disco.addFeature(cn),e.disco.addFeature(Xn),e.disco.addFeature(Cn),e.disco.addFeature(Kn),e.enableCarbons=()=>sa(e,"enable"),e.disableCarbons=()=>sa(e,"disable"),e.markReceived=t=>aa(e,t,"received"),e.markDisplayed=t=>aa(e,t,"displayed"),e.markAcknowledged=t=>aa(e,t,"acknowledged"),e.getAttention=(t,n={})=>e.sendMessage(Object.assign(Object.assign({},n),{requestingAttention:!0,to:t,type:"headline"})),e.on("message",t=>{if(t.carbon&&L(t.from,e.jid)){const n=t.carbon.forward.message;n.delay||(n.delay=t.carbon.forward.delay||{timestamp:new Date(Date.now())}),Ks(t)&&(e.emit("carbon:received",t),e.emit("message",n)),Xs(t)&&(e.emit("carbon:sent",t),e.emit("message:sent",n,!0))}if(ra(t)&&e.emit("dataform",t),t.requestingAttention&&e.emit("attention",t),ta(t)&&e.emit("rtt",t),na(t)&&e.emit("replace",t),Zs(t)&&Ys.has(t.type||"normal")&&e.emit("chat:state",t),ia(t,e)&&e.markReceived(t),t.marker&&"markable"!==t.marker.type&&e.emit(`marker:${t.marker.type}`,t),ea(t)){!1!==e.config.sendReceipts&&Ws.has(t.type||"normal")&&"request"===t.receipt.type&&e.sendMessage({id:t.id,receipt:{id:t.id,type:"received"},to:t.from,type:t.type}),"received"===t.receipt.type&&e.emit("receipt",t)}})}function ca(e){function t(){const t=e.joiningRooms;e.joiningRooms=new Map;for(const[n,i]of t)e.joinRoom(n,i);const n=e.joinedRooms;e.joinedRooms=new Map;for(const[t,i]of n)e.joinRoom(t,i)}e.disco.addFeature(zt),e.disco.addFeature(Un),e.disco.addFeature(ti),e.joinedRooms=new Map,e.joiningRooms=new Map,e.on("session:started",t),e.on("stream:management:resumed",t),e.on("message",t=>{if("groupchat"===t.type&&t.hasSubject)e.emit("muc:topic",{from:t.from,room:z(t.from),topic:t.subject||""});else if(t.muc)if("direct-invite"===t.muc.type||!t.muc.invite&&t.legacyMUC){const n="direct-invite"===t.muc.type?t.muc:t.legacyMUC;e.emit("muc:invite",{from:t.from,password:n.password,reason:n.reason,room:n.jid,thread:n.thread,type:"direct"})}else t.muc.invite?e.emit("muc:invite",{from:t.muc.invite[0].from,password:t.muc.password,reason:t.muc.invite[0].reason,room:t.from,thread:t.muc.invite[0].thread,type:"mediated"}):t.muc.decline?e.emit("muc:declined",{from:t.muc.decline.from,reason:t.muc.decline.reason,room:t.from}):e.emit("muc:other",t)}),e.on("presence",t=>{const n=z(t.from);if(e.joiningRooms.has(n)&&"error"===t.type)return e.joiningRooms.delete(n),e.emit("muc:failed",t),void e.emit("muc:error",t);if(!function(e){return!!e.muc}(t))return;const i=t.muc.statusCodes&&t.muc.statusCodes.indexOf(Kr.SelfPresence)>=0;if("error"!==t.type){if("unavailable"===t.type)return e.emit("muc:unavailable",t),i&&(e.emit("muc:leave",t),e.joinedRooms.delete(n)),void(t.muc.destroy&&e.emit("muc:destroyed",{newRoom:t.muc.destroy.jid,password:t.muc.destroy.password,reason:t.muc.destroy.reason,room:n}));e.emit("muc:available",t),i&&!e.joinedRooms.has(n)&&(e.emit("muc:join",t),e.joinedRooms.set(n,U(t.from)),e.joiningRooms.delete(n))}else e.emit("muc:error",t)}),e.joinRoom=(t,n,i={})=>{t=z(t),e.joiningRooms.set(t,n),e.sendPresence(Object.assign(Object.assign({},i),{muc:Object.assign(Object.assign({},i.muc),{type:"join"}),to:`${t}/${n}`}))},e.leaveRoom=(t,n,i={})=>{e.sendPresence(Object.assign(Object.assign({},i),{to:`${t}/${n}`,type:"unavailable"}))},e.ban=(t,n,i)=>e.setRoomAffiliation(t,n,"outcast",i),e.kick=(t,n,i)=>e.setRoomRole(t,n,"none",i),e.invite=(t,n=[])=>{Array.isArray(n)||(n=[n]),e.sendMessage({muc:{invite:n,type:"info"},to:t})},e.directInvite=(t,n,i={})=>{e.sendMessage({muc:Object.assign(Object.assign({},i),{jid:t,type:"direct-invite"}),to:n})},e.declineInvite=(t,n,i)=>{e.sendMessage({muc:{decline:{reason:i,to:n},type:"info"},to:t})},e.changeNick=(t,n)=>{e.sendPresence({to:`${z(t)}/${n}`})},e.setSubject=(t,n)=>{e.sendMessage({subject:n,to:t,type:"groupchat"})},e.getReservedNick=t=>Object(r.a)(this,void 0,void 0,(function*(){try{const n=(yield e.getDiscoInfo(t,"x-roomuser-item")).identities[0];if(n.name)return n.name;throw new Error("No nickname reserved")}catch(e){throw new Error("No nickname reserved")}})),e.requestRoomVoice=t=>{e.sendMessage({forms:[{fields:[{name:"FORM_TYPE",type:"hidden",value:"http://jabber.org/protocol/muc#request"},{name:"muc#role",type:"text-single",value:"participant"}],type:"submit"}],to:t})},e.setRoomAffiliation=(t,n,i,r)=>e.sendIQ({muc:{type:"user-list",users:[{affiliation:i,jid:n,reason:r}]},to:t,type:"set"}),e.setRoomRole=(t,n,i,r)=>e.sendIQ({muc:{type:"user-list",users:[{nick:n,reason:r,role:i}]},to:t,type:"set"}),e.getRoomMembers=(t,n={})=>e.sendIQ({muc:{type:"user-list",users:[n]},to:t,type:"get"}),e.getRoomConfig=t=>Object(r.a)(this,void 0,void 0,(function*(){const n=yield e.sendIQ({muc:{type:"configure"},to:t,type:"get"});if(!n.muc.form)throw new Error("No configuration form returned");return n.muc.form})),e.configureRoom=(t,n={})=>e.sendIQ({muc:{form:Object.assign(Object.assign({},n),{type:"submit"}),type:"configure"},to:t,type:"set"}),e.destroyRoom=(t,n={})=>e.sendIQ({muc:{destroy:n,type:"configure"},to:t,type:"set"}),e.getUniqueRoomName=function(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.sendIQ({muc:{type:"unique"},to:e,type:"get"});if(!t.muc.name)throw new Error("No unique name returned");return t.muc.name}))},e.getBookmarks=()=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield e.getPrivateData("bookmarks");return t&&t.rooms?t.rooms:[]})),e.setBookmarks=t=>e.setPrivateData("bookmarks",{rooms:t}),e.addBookmark=t=>Object(r.a)(this,void 0,void 0,(function*(){const n=yield e.getBookmarks(),i=[];let r=!1;for(const e of n)L(e.jid,t.jid)?(i.push(Object.assign(Object.assign({},e),t)),r=!0):i.push(e);return r||i.push(t),e.setBookmarks(i)})),e.removeBookmark=t=>Object(r.a)(this,void 0,void 0,(function*(){const n=(yield e.getBookmarks()).filter(e=>!L(e.jid,t));return e.setBookmarks(n)}))}function la(e){e.disco.addFeature(pn),e.disco.addFeature(sn),e.disco.addFeature(un),e.disco.addFeature(In),e.disco.addFeature(dn),e.disco.addFeature(_n(pn)),e.disco.addFeature(_n(sn)),e.disco.addFeature(_n(un)),e.disco.addFeature(_n(In)),e.disco.addFeature(_n(dn)),e.publishActivity=t=>e.publish("",pn,Object.assign({itemType:pn},t)),e.publishGeoLoc=t=>e.publish("",sn,Object.assign({itemType:sn},t)),e.publishMood=t=>e.publish("",un,Object.assign({itemType:un},t)),e.publishNick=t=>e.publish("",In,{itemType:In,nick:t}),e.publishTune=t=>e.publish("",dn,Object.assign({itemType:dn},t)),e.on("pubsub:published",t=>{const n=t.pubsub.items.published[0].content;switch(t.pubsub.items.node){case pn:return e.emit("activity",{activity:n,jid:t.from});case sn:return e.emit("geoloc",{geoloc:n,jid:t.from});case un:return e.emit("mood",{jid:t.from,mood:n});case In:return e.emit("nick",{jid:t.from,nick:n.nick});case dn:return e.emit("tune",{jid:t.from,tune:t.pubsub.items.published[0].content})}})}function ua(e){e.disco.addFeature(`${mn}#SubID`,mn),e.on("message",t=>{!function(e){return!!e.pubsub&&!(e.pubsub.context&&"user"!==e.pubsub.context||!e.pubsub.affiliations)}(t)?function(e){return!!e.pubsub}(t)&&(e.emit("pubsub:event",t),!function(e){return!!e.pubsub.items&&!!e.pubsub.items.published}(t)?!function(e){return!!e.pubsub.items&&!!e.pubsub.items.retracted}(t)?!function(e){return"purge"===e.pubsub.eventType}(t)?!function(e){return"purge"===e.pubsub.eventType}(t)?!function(e){return"subscription"===e.pubsub.eventType}(t)?function(e){return"configuration"===e.pubsub.eventType}(t)&&e.emit("pubsub:config",t):e.emit("pubsub:subscription",t):e.emit("pubsub:deleted",t):e.emit("pubsub:purged",t):e.emit("pubsub:retracted",t):e.emit("pubsub:published",t)):e.emit("pubsub:affiliations",t)}),e.subscribeToNode=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){const i={};let r;"string"==typeof n?(i.node=n,i.jid=z(e.jid)):(i.node=n.node,i.jid=n.jid||(n.useBareJID?z(e.jid):e.jid),r=n.options);const s=yield e.sendIQ({pubsub:{context:"user",subscribe:i,subscriptionOptions:r?{form:r}:void 0},to:t,type:"set"}),a=s.pubsub.subscription||{};return s.pubsub.subscriptionOptions&&(a.options=s.pubsub.subscriptionOptions.form),a})),e.unsubscribeFromNode=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){const i={};"string"==typeof n?(i.node=n,i.jid=z(e.jid)):(i.node=n.node,i.subid=n.subid,i.jid=n.jid||(n.useBareJID?z(e.jid):e.jid));const r=yield e.sendIQ({pubsub:{context:"user",unsubscribe:i},to:t,type:"set"});return r.pubsub&&r.pubsub.subscription?r.pubsub.subscription:Object.assign(Object.assign({},i),{state:"none"})})),e.publish=(t,n,i,r)=>e.sendIQ({pubsub:{context:"user",publish:{item:{content:i,id:r},node:n}},to:t,type:"set"}),e.getItem=(t,n,i)=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{context:"user",fetch:{items:[{id:i}],node:n}},to:t,type:"get"})).pubsub.fetch.items[0]})),e.getItems=(t,n,i={})=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{context:"user",fetch:{max:i.max,node:n},paging:i},to:t,type:"get"})).pubsub.fetch})),e.retract=(t,n,i,r)=>e.sendIQ({pubsub:{context:"user",retract:{id:i,node:n,notify:r}},to:t,type:"set"}),e.purgeNode=(t,n)=>e.sendIQ({pubsub:{context:"owner",purge:n},to:t,type:"set"}),e.deleteNode=(t,n,i)=>e.sendIQ({pubsub:{context:"owner",destroy:{node:n,redirect:i}},to:t,type:"set"}),e.createNode=(t,n,i)=>Object(r.a)(this,void 0,void 0,(function*(){const r=yield e.sendIQ({pubsub:{configure:i?{form:i}:void 0,context:"user",create:{node:n}},to:t,type:"set"});return r.pubsub&&r.pubsub.create?r.pubsub.create:{node:n}})),e.getSubscriptions=(t,n={})=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{context:"user",subscriptions:n},to:t,type:"get"})).pubsub.subscriptions})),e.getAffiliations=(t,n)=>e.sendIQ({pubsub:{affiliations:{node:n}},to:t,type:"get"}),e.getNodeSubscribers=(t,n,i={})=>("string"==typeof n?i.node=n:i=Object.assign(Object.assign({},i),n),e.sendIQ({pubsub:{context:"owner",subscriptions:i},to:t,type:"get"})),e.updateNodeSubscriptions=(t,n,i)=>e.sendIQ({pubsub:{context:"owner",subscriptions:{items:i,node:n}},to:t,type:"set"}),e.getNodeAffiliations=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{affiliations:{node:n},context:"owner"},to:t,type:"get"})).pubsub.affiliations})),e.updateNodeAffiliations=(t,n,i)=>e.sendIQ({pubsub:{affiliations:{items:i,node:n},context:"owner"},to:t,type:"set"}),e.getNodeConfig=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{configure:{node:n},context:"owner"},to:t,type:"get"})).pubsub.configure.form||{}})),e.getDefaultNodeConfig=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{context:"owner",defaultConfiguration:{}},to:t,type:"get"})).pubsub.defaultConfiguration.form||{}})),e.configureNode=(t,n,i)=>Object(r.a)(this,void 0,void 0,(function*(){return e.sendIQ({pubsub:{configure:{form:i,node:n},context:"owner"},to:t,type:"set"})})),e.getDefaultSubscriptionOptions=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{defaultSubscriptionOptions:{}},to:t,type:"get"})).pubsub.defaultSubscriptionOptions.form||{}}))}function pa(e){function t(t,n){return Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({blockList:{action:t,jids:[n]},type:"set"})}))}e.on("iq:set:roster",t=>{if(!M(e.jid).has(t.from))return e.sendIQError(t,{error:{condition:"service-unavailable",type:"cancel"}});e.emit("roster:update",t),e.sendIQResult(t)}),e.on("iq:set:blockList",t=>{const n=t.blockList;e.emit(n.action,{jids:n.jids||[]}),e.sendIQResult(t)}),e.getRoster=()=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield e.sendIQ({roster:{version:e.config.rosterVer},type:"get"});if(t.roster){const n=t.roster.version;return n&&(e.config.rosterVer=n,e.emit("roster:ver",n)),t.roster.items=t.roster.items||[],t.roster}return{items:[]}})),e.updateRosterItem=t=>Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({roster:{items:[t]},type:"set"})})),e.removeRosterItem=t=>e.updateRosterItem({jid:t,subscription:"remove"}),e.subscribe=t=>{e.sendPresence({type:"subscribe",to:t})},e.unsubscribe=t=>{e.sendPresence({type:"unsubscribe",to:t})},e.acceptSubscription=t=>{e.sendPresence({type:"subscribed",to:t})},e.denySubscription=t=>{e.sendPresence({type:"unsubscribed",to:t})},e.getBlocked=()=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield e.sendIQ({blockList:{action:"list"},type:"get"});return Object.assign({jids:[]},t.blockList)})),e.block=e=>Object(r.a)(this,void 0,void 0,(function*(){return t("block",e)})),e.unblock=e=>Object(r.a)(this,void 0,void 0,(function*(){return t("unblock",e)})),e.goInvisible=(t=!1)=>Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({type:"set",visiblity:{probe:t,type:"invisible"}})})),e.goVisible=()=>Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({type:"set",visiblity:{type:"visible"}})}))}function da(e){e.registerFeature("sasl",100,(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){const i=e.sasl.createMechanism(t.sasl.mechanisms),s=t=>Object(r.a)(this,void 0,void 0,(function*(){if(i)switch(t.type){case"success":return e.features.negotiated.sasl=!0,e.off("sasl",s),e.emit("auth:success",e.config.credentials),void n("restart");case"challenge":i.processChallenge(t.value);try{const t=yield e.getCredentials(),n=i.createResponse(t);n||""===n?e.send("sasl",{type:"response",value:n}):e.send("sasl",{type:"response"});const r=i.getCacheableCredentials();r&&(e.config.credentials||(e.config.credentials={}),e.config.credentials=Object.assign(Object.assign({},e.config.credentials),r),e.emit("credentials:update",e.config.credentials))}catch(t){console.error(t),e.send("sasl",{type:"abort"})}return;case"failure":case"abort":return e.off("sasl",s),e.emit("auth:failed"),void n("disconnect","authentication failed")}}));if(!i)return e.off("sasl",s),e.emit("auth:failed"),n("disconnect","authentication failed");e.on("sasl",s),e.once("disconnected",()=>{e.features.negotiated.sasl=!1,e.off("sasl",s)});try{const t=yield e.getCredentials();e.send("sasl",{mechanism:i.name,type:"auth",value:i.createResponse(t)})}catch(t){console.error(t),e.send("sasl",{type:"abort"})}})))}function ha(e){function t(t){return Object(r.a)(this,void 0,void 0,(function*(){const n=yield e.getDiscoInfo(t);if(!n.features||!n.features.includes(pi))return;let i;for(const e of n.extensions||[]){const n=e.fields||[];if(n.some(e=>"FORM_TYPE"===e.name&&e.value===pi)){const e=n.find(e=>"max-file-size"===e.name);return e&&(i=parseInt(e.value,10)),{jid:t,maxSize:i}}}}))}e.disco.addFeature(Mn),e.getBits=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({bits:{cid:n},to:t,type:"get"})).bits})),e.getUploadService=(n=B(e.jid))=>Object(r.a)(this,void 0,void 0,(function*(){const i=yield t(n);if(i)return i;const r=yield e.getDiscoItems(n);for(const e of r.items||[]){if(!e.jid)continue;const n=yield t(e.jid);if(n)return n}throw new Error("No upload service discovered on: "+n)})),e.getUploadSlot=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({httpUpload:Object.assign({type:"request"},n),to:t,type:"get"})).httpUpload}))}function fa(e){e.use(xs),e.use($r),e.use(Er),e.use(Lr),e.use(ks),e.use(da)}function ma(e){e.use(Tr),e.use(oa),e.use(Ir),e.use(Or),e.use(Ss),e.use(Hs),e.use(Js),e.use(ca),e.use(la),e.use(ua),e.use(pa),e.use(ha)}const ga={aliases:["features.legacySession","iq.legacySession"],element:"session",fields:{optional:lt(null,"optional")},namespace:Rt},ba={defaultType:"stream",element:"stream",fields:{from:Le("from"),id:Le("id"),lang:tt(),to:Le("to"),version:Le("version")},namespace:Nt,path:"stream",type:"stream",typeField:"action"},ya={element:"features",namespace:Nt,path:"features"},va={element:"error",fields:{alternateLanguageText:vt(At,"text"),condition:ft(At,ys(Hr),Hr.UndefinedCondition),seeOtherHost:nt(At,Hr.SeeOtherHost),text:nt(At,"text")},namespace:Nt,path:"streamError"},wa=Object.values(Vr).map(e=>({aliases:["stanzaError","message.error","presence.error","iq.error"],defaultType:Ot,element:"error",fields:{alternateLanguageText:vt(qt,"text"),by:yi("by"),condition:ft(qt,ys(Jr),Jr.UndefinedCondition),gone:nt(qt,Jr.Gone),redirect:nt(qt,Jr.Redirect),text:nt(qt,"text"),type:Le("type")},namespace:e,type:e,typeField:"streamType"})),_a=new Set(["from","id","lang","to","type","payloadType","error"]),Sa=Object.values(Vr).map(e=>({defaultType:Ot,element:"iq",fields:{from:yi("from"),id:Le("id"),lang:tt(),payloadType:{order:-1e4,importer(e,t){if("get"!==t.data.type&&"set"!==t.data.type)return;if(1!==e.children.filter(e=>"string"!=typeof e).length)return"invalid-payload-count";const n=Object.keys(t.data).filter(e=>!_a.has(e));return 1!==n.length?"unknown-payload":n[0]}},to:yi("to"),type:Le("type")},namespace:e,path:"iq",type:e,typeField:"streamType"})),xa=Object.values(Vr).map(e=>({defaultType:Ot,element:"message",fields:{from:yi("from"),id:Le("id"),lang:tt(),to:yi("to")},namespace:e,path:"message",type:e,typeField:"streamType"})),ja=Object.values(Vr).map(e=>({defaultType:Ot,element:"presence",fields:{from:yi("from"),id:Le("id"),lang:tt(),to:yi("to")},namespace:e,path:"presence",type:e,typeField:"streamType"})),ka=[ba,ya,va,...wa,...[{element:"mechanisms",fields:{mechanisms:gt(null,"mechanism")},namespace:Ct,path:"features.sasl"},{element:"abort",namespace:Ct,path:"sasl",type:"abort",typeField:"type"},{element:"auth",fields:{mechanism:Le("mechanism"),value:et("base64")},namespace:Ct,path:"sasl",type:"auth",typeField:"type"},{element:"challenge",fields:{value:et("base64")},namespace:Ct,path:"sasl",type:"challenge",typeField:"type"},{element:"response",fields:{value:et("base64")},namespace:Ct,path:"sasl",type:"response",typeField:"type"},{element:"success",fields:{value:et("base64")},namespace:Ct,path:"sasl",type:"success",typeField:"type"},{element:"failure",fields:{alternateLanguageText:vt(Ct,"text"),condition:ft(Ct,ys(Gr)),text:nt(Ct,"text")},namespace:Ct,path:"sasl",type:"failure",typeField:"type"}],...[{aliases:["features.tls"],defaultType:"start",element:"starttls",fields:{required:lt(null,"required")},namespace:Pt,path:"tls",type:"start",typeField:"type"},{element:"proceed",namespace:Pt,path:"tls",type:"proceed",typeField:"type"},{element:"failure",namespace:Pt,path:"tls",type:"failure",typeField:"type"}],...Sa,...xa,...ja,{aliases:["features.bind","iq.bind"],element:"bind",fields:{jid:nt(null,"jid"),resource:nt(null,"resource")},namespace:Et}],Ta=[ki({rosterPreApproval:lt("urn:xmpp:features:pre-approval","sub"),rosterVersioning:lt("urn:xmpp:features:rosterver","ver")}),Si({alternateLanguageBodies:vt(null,"body"),alternateLanguageSubjects:vt(null,"subject"),body:nt(null,"body"),hasSubject:lt(null,"subject"),parentThread:Je(null,"thread","parent"),subject:nt(null,"subject"),thread:nt(null,"thread"),type:Le("type")}),xi({alternateLanguageStatuses:vt(null,"status"),priority:st(null,"priority",0),show:nt(null,"show"),status:nt(null,"status"),type:Le("type")}),{element:"query",fields:{version:Le("ver",void 0,{emitEmpty:!0})},namespace:"jabber:iq:roster",path:"iq.roster"},{aliases:[{path:"iq.roster.items",multiple:!0}],element:"item",fields:{groups:gt(null,"group"),jid:yi("jid"),name:Le("name"),pending:Le("ask"),preApproved:De("approved"),subscription:Le("subscription")},namespace:"jabber:iq:roster"}],Ia=[{element:"open",fields:{from:Le("from"),id:Le("id"),lang:tt(),to:Le("to"),version:Le("version")},namespace:Ft,path:"stream",type:"open"},{element:"close",fields:{seeOtherURI:Le("see-other-uri")},namespace:Ft,path:"stream",type:"close"}],Ea=[{aliases:[{path:"message.forms",multiple:!0}],element:"x",fields:{instructions:Object.assign(Object.assign({},gt(null,"instructions")),{exportOrder:2}),reported:Object.assign(Object.assign({},_t(null,"reported","dataformField",!0)),{exportOrder:3}),title:Object.assign(Object.assign({},nt(null,"title")),{exportOrder:1}),type:Le("type")},namespace:Mt,optionalNamespaces:{xdv:hn},path:"dataform"},{aliases:[{path:"dataform.fields",multiple:!0},{path:"dataform.items.fields",multiple:!0}],element:"field",fields:{description:nt(null,"desc"),label:Le("label"),name:Le("var"),rawValues:Object.assign(Object.assign({},gt(null,"value")),{exporter:()=>null}),required:lt(null,"required"),type:Le("type"),value:{importer(e,t){const n=e.getAttribute("type"),i=gt(Mt,"value").importer(e,t),r=i[0];switch(n){case Yr.TextMultiple:case Yr.ListMultiple:case Yr.JIDMultiple:return i;case Yr.Hidden:case Yr.Fixed:return 1===i.length?r:i;case Yr.Boolean:if(r)return"1"===r||"true"===r;break;default:return r}},exporter(e,t,n){const i=gt(null,"value");let r=[];const s=n.data&&n.data.rawValues?n.data.rawValues[0]:void 0;if("boolean"==typeof t)r="true"===s||"false"===s?[s]:[t?"1":"0"];else if(Array.isArray(t))for(const e of t)r.push(e.toString());else r=[t.toString()];i.exporter(e,r,Object.assign({},n,{namespace:Mt}))}}},namespace:Mt,path:"dataformField"},{aliases:[{path:"dataform.fields.options",multiple:!0}],element:"option",fields:{label:Le("label"),value:nt(null,"value")},namespace:Mt},{aliases:[{path:"dataform.items",multiple:!0}],element:"item",namespace:Mt},{element:"validate",fields:{listMax:Ye(null,"list-range","max"),listMin:Ye(null,"list-range","min"),method:ft(null,["basic","open","range","regex"],"basic"),rangeMax:Je(null,"range","max"),rangeMin:Je(null,"range","min"),regex:nt(null,"regex"),type:Le("datatype","xs:string")},namespace:hn,path:"dataform.fields.validation"}],Oa=[{aliases:["presence.legacyLastActivity","iq.lastActivity"],element:"query",fields:{seconds:Be("seconds"),status:Ze()},namespace:"jabber:iq:last"}],Ca=[{element:"query",fields:{activeList:Je(null,"active","name"),defaultList:Je(null,"default","name")},namespace:Lt,path:"iq.privacy"},{aliases:[{path:"iq.privacy.lists",multiple:!0}],element:"list",fields:{name:Le("name")},namespace:Lt},{aliases:[{path:"iq.privacy.lists.items",multiple:!0}],element:"item",fields:{action:Le("action"),incomingPresence:lt(null,"presence-in"),iq:lt(null,"iq"),messages:lt(null,"message"),order:Be("order"),outgoingPresence:lt(null,"presence-out"),type:Le("type"),value:Le("value")},namespace:Lt}],Ra=[{aliases:["iq.disco","message.disco","features.disco"],childrenExportOrder:{identities:100},element:"query",fields:{features:bt(null,"feature","var"),node:Le("node")},namespace:Dt,path:"disco",type:"info",typeField:"type"},{aliases:[{path:"disco.identities",selector:"info",multiple:!0}],element:"identity",fields:{category:Le("category"),lang:tt(),name:Le("name"),type:Le("type")},namespace:Dt},{aliases:[{path:"disco.items",multiple:!0,selector:"items"}],element:"item",fields:{jid:yi("jid"),name:Le("name"),node:Le("node")},namespace:Bt},{aliases:[{path:"disco.items",multiple:!0,selector:"info"}],element:"item",fields:{category:yi("category"),lang:tt(),name:Le("name"),type:Le("type")},namespace:Dt},_i(Mt,"x",[{path:"disco.extensions",multiple:!0,selector:"info"}]),_i(Wt,"set",[{path:"disco.paging",selector:"items"}]),{aliases:["iq.disco","message.disco","features.disco"],element:"query",fields:{node:Le("node")},namespace:Bt,path:"disco",type:"items",typeField:"type"}],qa=[Si({addresses:_t(Ut,"addresses","extendedAddress",!0)}),xi({addresses:_t(Ut,"addresses","extendedAddress",!0)}),{element:"address",fields:{alternateLanguageDescriptions:vt(null,"desc"),delivered:De("delivered"),description:Le("desc"),jid:yi("jid"),node:Le("node"),type:Le("type"),uri:Le("uri")},namespace:Ut,path:"extendedAddress"}],Na=[_i(Mt,"x",[{path:"iq.muc.form",selector:"configure"}]),{defaultType:"info",element:"x",fields:{password:nt(null,"password")},namespace:zt,path:"presence.muc",type:"join",typeField:"type"},{aliases:[{path:"presence.muc.history",selector:"join"}],element:"history",fields:{maxCharacters:Be("maxchars"),maxStanzas:Be("maxstanzas"),seconds:Be("seconds"),since:ze("since")},namespace:zt},{aliases:["presence.muc","message.muc"],defaultType:"info",element:"x",fields:{action:ft(null,["invite","decline","destroy"]),actor:_t(null,"item","mucactor"),affiliation:Je(null,"item","affiliation"),jid:vi(null,"item","jid"),nick:Je(null,"item","nick"),password:nt(null,"password"),reason:pt([{namespace:null,element:"item"},{namespace:null,element:"reason"}]),role:Je(null,"item","role"),statusCodes:bt(null,"status","code")},namespace:Vt,type:"info",typeField:"type",typeOrder:1},{element:"actor",fields:{jid:yi("jid"),nick:Le("nick")},namespace:Vt,path:"mucactor"},{element:"destroy",fields:{jid:yi("jid"),reason:nt(null,"reason")},namespace:Vt,path:"presence.muc.destroy"},{aliases:[{path:"message.muc.invite",multiple:!0}],element:"invite",fields:{continue:lt(null,"continue"),from:yi("from"),reason:nt(null,"reason"),thread:Je(null,"continue","thread"),to:yi("to")},namespace:Vt},{element:"decline",fields:{from:yi("from"),reason:nt(null,"reason"),to:yi("to")},namespace:Vt,path:"message.muc",type:"decline"},{element:"query",namespace:$t,path:"iq.muc",type:"user-list",typeField:"type"},{aliases:[{path:"iq.muc.users",multiple:!0,selector:"user-list"}],element:"item",fields:{affiliation:Le("affiliation"),jid:yi("jid"),nick:Le("nick"),reason:nt(null,"reason"),role:Le("role")},namespace:$t},{aliases:["iq.muc.users.actor"],element:"actor",fields:{jid:yi("jid"),nick:Le("nick")},namespace:$t},{element:"query",namespace:Qt,path:"iq.muc",type:"configure",typeField:"type"},{aliases:[{path:"iq.muc.destroy",selector:"configure"}],element:"destroy",fields:{jid:yi("jid"),password:nt(null,"password"),reason:nt(null,"reason")},namespace:Qt},{element:"x",fields:{action:St("invite"),continue:De("continue"),jid:yi("jid"),legacyReason:Ze(),password:Le("password"),reason:Le("reason"),thread:Le("thread")},namespace:Un,path:"message.muc",type:"direct-invite",typeOrder:2},{element:"unique",fields:{name:Ze()},namespace:"http://jabber.org/protocol/muc#unique",path:"iq.muc",type:"unique"},Si({legacyMUC:{exporter(e,t,n){const i=n.registry?n.registry.export("message.muc",Object.assign(Object.assign({},t),{type:"direct-invite"})):void 0;i&&e.appendChild(i)},exportOrder:100001,importer(e,t){if(!_e(e,Vt,"x")[0])return;const n=_e(e,Un,"x")[0];return n&&t.registry?t.registry.import(n,Object.assign(Object.assign({},t),{path:"message"})):void 0},importOrder:-1}})],Aa=[{aliases:["iq.ibb","message.ibb"],element:"open",fields:{ack:{importer:(e,t)=>"message"!==Le("stanza","iq").importer(e,t),exporter(e,t,n){Le("stanza").exporter(e,t?"iq":"message",n)}},blockSize:Be("block-size"),sid:Le("sid")},namespace:Gt,type:"open",typeField:"action"},{aliases:["iq.ibb","message.ibb"],element:"close",fields:{sid:Le("sid")},namespace:Gt,type:"close",typeField:"action"},{aliases:["iq.ibb","message.ibb"],element:"data",fields:{data:et("base64"),seq:Be("seq"),sid:Le("sid")},namespace:Gt,type:"data",typeField:"action"}],Pa=[{aliases:[{path:"bookmarkStorage",impliedType:!0},{path:"iq.privateStorage.bookmarks",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"storage",namespace:"storage:bookmarks",type:"storage:bookmarks",typeField:"itemType"},{aliases:[{path:"bookmarkStorage.rooms",multiple:!0}],element:"conference",fields:{autoJoin:De("autojoin"),jid:yi("jid"),name:Le("name"),nick:nt(null,"nick"),password:nt(null,"password")},namespace:"storage:bookmarks"}],Fa={element:"query",namespace:"jabber:iq:private",path:"iq.privateStorage"},Ma=[_i(Mt,"x",["iq.command.form"]),Ti({commandError:ft(Ht,["bad-action","bad-locale","bad-payload","bad-sessionid","malformed-action","session-expired"])}),{element:"command",fields:{action:Le("action"),node:Le("node"),sid:Le("sessionid"),status:Le("status")},namespace:Ht,path:"iq.command"},{element:"actions",fields:{complete:lt(null,"complete"),execute:Le("execute"),next:lt(null,"next"),prev:lt(null,"prev")},namespace:Ht,path:"iq.command.availableActions"},{aliases:[{path:"iq.command.notes",multiple:!0}],element:"note",fields:{type:Le("type"),value:Ze()},namespace:Ht}],La="vcardTemp.records";function Da(e,t){return{aliases:[{multiple:!0,path:La}],element:e,fields:{value:Ze()},namespace:Jt,type:t,typeField:"type"}}const Ba=[{aliases:[{path:"iq.vcard"}],defaultType:Jt,element:"vCard",fields:{fullName:nt(null,"FN")},namespace:Jt,path:"vcardTemp",type:Jt,typeField:"format"},{element:"N",fields:{additional:Object.assign(Object.assign({},nt(null,"MIDDLE")),{order:3}),family:Object.assign(Object.assign({},nt(null,"FAMILY")),{order:1}),given:Object.assign(Object.assign({},nt(null,"GIVEN")),{order:2}),prefix:Object.assign(Object.assign({},nt(null,"PREFIX")),{order:4}),suffix:Object.assign(Object.assign({},nt(null,"SUFFIX")),{order:5})},namespace:Jt,path:"vcardTemp.name"},Da("NICKNAME","nickname"),Da("BDAY","birthday"),Da("JABBERID","jid"),Da("TZ","timezone"),Da("TITLE","title"),Da("ROLE","role"),Da("URL","url"),Da("NOTE","note"),Da("SORT-STRING","sort"),Da("UID","uid"),Da("REV","revision"),Da("PRODID","productId"),Da("DESC","description"),{aliases:[{multiple:!0,path:La}],element:"EMAIL",fields:{preferred:lt(null,"PREF"),types:wt(null,[["home","HOME"],["work","WORK"],["internet","INTERNET"]]),value:nt(null,"USERID")},namespace:Jt,type:"email"},{aliases:[{path:La,multiple:!0}],element:"ORG",fields:{units:Object.assign(Object.assign({},gt(null,"ORGUNIT")),{order:2}),value:Object.assign(Object.assign({},nt(null,"ORGNAME")),{order:1})},namespace:Jt,type:"organization",typeField:"type"},{aliases:[{multiple:!0,path:La}],element:"ADR",fields:{city:nt(null,"LOCALITY"),code:nt(null,"PCODE"),country:nt(null,"CTRY"),pobox:nt(null,"POBOX"),preferred:lt(null,"PREF"),region:nt(null,"REGION"),street:nt(null,"STREET"),street2:nt(null,"EXTADD"),types:wt(null,[["home","HOME"],["work","WORK"],["domestic","DOM"],["international","INTL"],["postal","POSTAL"],["parcel","PARCEL"]])},namespace:Jt,type:"address",typeField:"type"},{aliases:[{multiple:!0,path:La}],element:"LABEL",fields:{lines:gt(null,"LINE"),preferred:lt(null,"PREF"),types:wt(null,[["home","HOME"],["work","WORK"]])},namespace:Jt,type:"addressLabel",typeField:"type"},{aliases:[{multiple:!0,path:La}],element:"TEL",fields:{preferred:lt(null,"PREF"),types:wt(null,[["home","HOME"],["work","WORK"],["cell","CELL"],["fax","FAX"],["voice","VOICE"],["msg","MSG"]]),value:nt(null,"NUMBER","")},namespace:Jt,type:"tel",typeField:"type"},{aliases:[{multiple:!0,path:La}],element:"PHOTO",fields:{data:nt(null,"BINVAL"),mediaType:nt(null,"TYPE"),url:nt(null,"EXTVAL")},namespace:Jt,type:"photo",typeField:"type"},{aliases:[{multiple:!0,path:La}],element:"LOGO",fields:{data:nt(null,"BINVAL"),mediaType:nt(null,"TYPE"),url:nt(null,"EXTVAL")},namespace:Jt,type:"logo",typeField:"type"},{aliases:[{multiple:!0,path:La}],element:"CATEGORIES",fields:{value:gt(null,"KEYWORD")},namespace:Jt,type:"categories",typeField:"type"}],Ua=[_i(Mt,"x",["iq.search.form"]),{element:"query",fields:{email:nt(null,"email"),familyName:nt(null,"last"),givenName:nt(null,"first"),instructions:nt(null,"instructions"),nick:nt(null,"nick")},namespace:"jabber:iq:search",path:"iq.search"},{aliases:[{path:"iq.search.items",multiple:!0}],element:"item",fields:{email:nt(null,"email"),familyName:nt(null,"last"),givenName:nt(null,"first"),jid:yi("jid"),nick:nt(null,"nick")},namespace:"jabber:iq:search"}],za={aliases:["iq.pubsub.paging"],element:"set",fields:{after:nt(null,"after"),before:nt(null,"before"),count:st(null,"count"),first:nt(null,"first"),firstIndex:Ye(null,"first","index"),index:st(null,"index"),last:nt(null,"last"),max:st(null,"max")},namespace:Wt,path:"paging"},$a={configurable:lt(null,"subscribe-options"),configurationRequired:ht([{namespace:null,element:"subscribe-options"},{namespace:null,element:"required"}]),jid:yi("jid"),node:Le("node"),state:Le("subscription"),subid:Le("subid")},Qa={node:Le("node")},Va=[{aliases:["pubsub","iq.pubsub","message.pubsub"],childrenExportOrder:{configure:0,create:100,publish:100,subscribe:100,subscriptionOptions:0},defaultType:"user",element:"pubsub",fields:{publishOptions:_t(null,"publish-options","dataform")},namespace:Yt,type:"user",typeField:"context"},{aliases:["pubsub","iq.pubsub","message.pubsub"],defaultType:"user",element:"pubsub",fields:{purge:Je(null,"purge","node")},namespace:Zt,type:"owner",typeField:"context"},_i(Mt,"x",["iq.pubsub.configure.form","iq.pubsub.defaultConfiguration.form","iq.pubsub.defaultSubscriptionOptions.form","iq.pubsub.subscriptionOptions.forms","message.pubsub.configuration.form"]),_i(Wt,"set",["iq.pubsub.fetch.paging"]),Ti({pubsubError:ft(Kt,ys(Xr)),pubsubUnsupportedFeature:Je(Kt,"unsupported","feature")}),{element:"subscribe",fields:{jid:yi("jid"),node:Le("node")},namespace:Yt,path:"iq.pubsub.subscribe"},{element:"unsubscribe",fields:{jid:yi("jid"),node:Le("node"),subid:Le("subid")},namespace:Yt,path:"iq.pubsub.unsubscribe"},{element:"options",fields:{jid:yi("jid"),node:Le("node"),subid:Le("subid")},namespace:Yt,path:"iq.pubsub.subscriptionOptions"},{aliases:[{path:"iq.pubsub.subscriptions",selector:"user",impliedType:!0}],element:"subscriptions",fields:{jid:yi("jid"),node:Le("node")},namespace:Yt,type:"user"},{aliases:[{path:"iq.pubsub.subscriptions",selector:"owner",impliedType:!0}],element:"subscriptions",fields:{jid:yi("jid"),node:Le("node")},namespace:Zt,type:"owner"},{aliases:["iq.pubsub.subscription",{impliedType:!0,multiple:!0,path:"iq.pubsub.subscriptions.items",selector:"user"}],element:"subscription",fields:$a,namespace:Yt},{aliases:[{impliedType:!0,multiple:!0,path:"iq.pubsub.subscriptions.items",selector:"owner"}],element:"subscription",fields:$a,namespace:Zt},{aliases:[{path:"iq.pubsub.affiliations",selector:"user",impliedType:!0},{path:"message.pubsub.affiliations",selector:"user",impliedType:!0}],element:"affiliations",fields:Qa,namespace:Yt,type:"user"},{aliases:[{path:"iq.pubsub.affiliations",selector:"owner",impliedType:!0}],element:"affiliations",fields:Qa,namespace:Zt,type:"owner"},{aliases:[{impliedType:!0,multiple:!0,path:"iq.pubsub.affiliations.items",selector:"user"},{impliedType:!0,multiple:!0,path:"message.pubsub.affiliations.items",selector:"user"}],element:"affiliation",fields:{affiliation:Le("affiliation"),jid:yi("jid"),node:Le("node")},namespace:Yt,type:"user"},{aliases:[{impliedType:!0,multiple:!0,path:"iq.pubsub.affiliations.items",selector:"owner"}],element:"affiliation",fields:{affiliation:Le("affiliation"),jid:yi("jid"),node:Le("node")},namespace:Zt,type:"owner"},{element:"create",fields:Qa,namespace:Yt,path:"iq.pubsub.create"},{aliases:[{path:"iq.pubsub.destroy",selector:"owner"}],element:"delete",fields:{node:Le("node"),redirect:Je(null,"redirect","uri")},namespace:Zt},{aliases:[{path:"iq.pubsub.configure",selector:"owner",impliedType:!0}],element:"configure",fields:Qa,namespace:Zt,type:"owner"},{aliases:[{path:"iq.pubsub.configure",selector:"user",impliedType:!0}],element:"configure",fields:Qa,namespace:Yt,type:"user"},{element:"default",fields:{},namespace:Yt,path:"iq.pubsub.defaultSubscriptionOptions"},{element:"default",fields:{},namespace:Zt,path:"iq.pubsub.defaultConfiguration"},{element:"publish",fields:Qa,namespace:Yt,path:"iq.pubsub.publish"},{element:"retract",fields:{id:Je(null,"item","id"),node:Le("node"),notify:De("notify")},namespace:Yt,path:"iq.pubsub.retract"},{element:"items",fields:{max:Be("max_items"),node:Le("node")},namespace:Yt,path:"iq.pubsub.fetch"},{aliases:["pubsubitem","iq.pubsub.publish.item",{multiple:!0,path:"iq.pubsub.fetch.items"}],element:"item",fields:{id:Le("id"),publisher:yi("publisher")},namespace:Yt},{element:"event",fields:{eventType:ft(null,["purge","delete","subscription","configuration","items"])},namespace:Xt,path:"message.pubsub",type:"event",typeField:"context"},{aliases:[{path:"message.pubsub.items.published",multiple:!0}],element:"item",fields:{id:Le("id"),publisher:yi("publisher")},namespace:Xt,path:"pubsubeventitem"},{element:"purge",fields:Qa,namespace:Xt,path:"message.pubsub.purge"},{element:"delete",fields:{node:Le("node"),redirect:Je(null,"redirect","uri")},namespace:Xt,path:"message.pubsub.delete"},{element:"subscription",fields:{expires:(e=>({importer(t){const n=t.getAttribute(e);return"presence"===n?n:n?new Date(n):void 0},exporter(t,n){let i;i="string"==typeof n?n:n.toISOString(),t.setAttribute(e,i)}}))("expiry"),jid:yi("jid"),node:Le("node"),subid:Le("subid"),type:Le("subscription")},namespace:Xt,path:"message.pubsub.subscription"},{element:"configuration",fields:Qa,namespace:Xt,path:"message.pubsub.configuration"},{element:"items",fields:{node:Le("node"),retracted:bt(null,"retracted","id")},namespace:Xt,path:"message.pubsub.items"}],Ga=[{element:"query",fields:{activate:nt(null,"activate"),address:Le("dstaddr"),candidateUsed:vi(null,"streamhost-used","jid"),mode:Le("mode","tcp"),sid:Le("sid"),udpSuccess:Je(null,"udpsuccess","dstaddr")},namespace:en,path:"iq.socks5"},{aliases:[{multiple:!0,path:"iq.socks5.candidates"}],element:"streamhost",fields:{host:Le("host"),jid:yi("jid"),port:Be("port"),uri:Le("uri")},namespace:en}],Ha=[{aliases:[{multiple:!0,path:"message.links"}],element:"x",fields:{description:nt(null,"desc"),url:nt(null,"url")},namespace:tn},{element:"query",fields:{description:nt(null,"desc"),url:nt(null,"url")},namespace:"jabber:iq:oob",path:"iq.transferLink"}],Ja={element:"html",fields:{alternateLanguageBodies:jt(nn,"body","xhtmlim"),body:xt(nn,"body","xhtmlim")},namespace:rn,path:"message.html"},Wa=[ki({inbandRegistration:lt("http://jabber.org/features/iq-register","register")}),_i(Mt,"x",["iq.account.form"]),_i(tn,"x",["iq.account.registrationLink"]),{element:"query",fields:{address:nt(null,"address"),date:rt(null,"date"),email:nt(null,"email"),familyName:nt(null,"last"),fullName:nt(null,"name"),givenName:nt(null,"first"),instructions:nt(null,"instructions"),key:nt(null,"key"),locality:nt(null,"city"),misc:nt(null,"misc"),nick:nt(null,"nick"),password:nt(null,"password"),phone:nt(null,"phone"),postalCode:nt(null,"zip"),region:nt(null,"state"),registered:lt(null,"registered"),remove:lt(null,"remove"),text:nt(null,"text"),uri:nt(null,"uri"),username:nt(null,"username")},namespace:"jabber:iq:register",path:"iq.account"}],Ya={aliases:[{path:"message.geoloc",impliedType:!0},{path:"dataform.fields.geoloc",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"geoloc",fields:{accuracy:at(null,"accuracy"),altitude:at(null,"alt"),altitudeAccuracy:at(null,"altaccuracy"),area:nt(null,"area"),building:nt(null,"building"),country:nt(null,"country"),countryCode:nt(null,"countrycode"),datum:nt(null,"datum"),description:nt(null,"description"),error:at(null,"error"),floor:nt(null,"floor"),heading:at(null,"bearing"),lang:tt(),latitude:at(null,"lat"),locality:nt(null,"locality"),longitude:at(null,"lon"),postalCode:nt(null,"postalcode"),region:nt(null,"region"),room:nt(null,"room"),speed:at(null,"speed"),street:nt(null,"street"),text:nt(null,"text"),timestamp:rt(null,"timestamp"),tzo:ct(null,"tzo"),uri:nt(null,"uri")},namespace:sn,type:sn},Ka=[{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"data",fields:{data:et("base64")},namespace:an,path:"avatar",type:an,typeField:"itemType"},{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"metadata",namespace:on,path:"avatar",type:on,typeField:"itemType"},{aliases:[{multiple:!0,path:"avatar.versions",selector:on}],element:"info",fields:{bytes:Be("bytes"),height:Be("height"),id:Le("id"),mediaType:Le("type"),uri:Le("url"),width:Be("width")},namespace:on},{aliases:[{multiple:!0,path:"avatar.pointers",selector:on}],element:"pointer",fields:{bytes:Be("bytes"),height:Be("height"),id:Le("id"),mediaType:Le("type"),uri:Le("url"),width:Be("width")},namespace:on}];var Xa=Si({chatState:ft(cn,ys(Zr))});const Za={element:"query",fields:{name:nt(null,"name"),os:nt(null,"os"),version:nt(null,"version")},namespace:ln,path:"iq.softwareVersion"},eo={aliases:[{path:"message.mood",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"mood",fields:{alternateLanguageText:vt(null,"text"),text:nt(null,"text"),value:ft(null,as)},namespace:un,type:un},to={aliases:[{path:"activity",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"activity",fields:{activity:mt(null,os,cs),alternateLanguageText:vt(null,"text"),text:nt(null,"text")},namespace:pn,type:pn},no={element:"handshake",fields:{value:et("hex")},namespace:"jabber:component:accept",path:"handshake"},io={aliases:[{path:"presence.legacyCapabilities",multiple:!0},{path:"features.legacyCapabilities",multiple:!0}],element:"c",fields:{algorithm:Le("hash"),legacy:St(!0),node:Le("node"),value:Le("ver")},namespace:"http://jabber.org/protocol/caps"},ro={aliases:[{impliedType:!0,path:"tune"},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"tune",fields:{artist:nt(null,"artist"),length:st(null,"length"),rating:st(null,"rating"),source:nt(null,"source"),title:nt(null,"title"),track:nt(null,"track"),uri:nt(null,"uri")},namespace:dn,type:dn},so=["dataformLayout",{multiple:!0,path:"dataformLayout.contents"},{multiple:!0,path:"dataform.layout.contents"}],ao=[{aliases:[{multiple:!0,path:"dataform.layout"}],element:"page",fields:{label:Le("label")},namespace:bn},{aliases:so,element:"section",fields:{label:Le("label")},namespace:bn,type:"section",typeField:"type"},{aliases:so,element:"text",fields:{value:Ze()},namespace:bn,type:"text",typeField:"type"},{aliases:so,element:"fieldref",fields:{field:Le("var")},namespace:bn,type:"fieldref",typeField:"type"},{aliases:so,element:"reportedref",namespace:bn,type:"reportedref",typeField:"type"}];function oo(){return{importer(e,t){let n=_e(e,Vn,"rtcp-fb");const i=Le("type").importer,r=Le("subtype").importer,s=Le("value").importer,a=[];for(const e of n){const n=i(e,t),s=r(e,t);a.push(s?{type:n,parameter:s}:{type:n})}n=_e(e,Vn,"rtcp-fb-trr-int");for(const e of n){const n=s(e,t);a.push(n?{type:"trr-int",parameter:n}:{type:"trr-int"})}return a},exporter(e,t,n){const i=Le("type").exporter,r=Le("subtype").exporter,s=Le("value").exporter;for(const a of t){let t;"trr-int"===a.type?(t=ye(Vn,"rtcp-fb-trr-int",n.namespace,e),a.parameter&&s(t,a.parameter,n)):(i(t=ye(Vn,"rtcp-fb",n.namespace,e),a.type,n),a.parameter&&r(t,a.parameter,n)),e.appendChild(t)}}}}const co="iq.jingle.info",lo=e=>[{element:"transport",fields:{gatheringComplete:lt(null,"gathering-complete"),password:Le("pwd"),usernameFragment:Le("ufrag")},namespace:e,path:"iq.jingle.contents.transport",type:e,typeField:"transportType"},{aliases:[{path:"iq.jingle.contents.transport.remoteCandidate",selector:e}],element:"remote-candidate",fields:{component:Be("component"),ip:Le("ip"),port:Be("port")},namespace:e},{aliases:[{multiple:!0,path:"iq.jingle.contents.transport.candidates",selector:e}],element:"candidate",fields:{component:Be("component"),foundation:Le("foundation"),generation:Be("generation"),id:Le("id"),ip:Le("ip"),network:Be("network"),port:Be("port"),priority:Be("priority"),protocol:Le("protocol"),relatedAddress:Le("rel-addr"),relatedPort:Le("rel-port"),tcpType:Le("tcptype"),type:Le("type")},namespace:e}];const uo="message.marker";const po=[ga,ka,Ta,Ia,Ea,Oa,Ca,Ra,qa,Na,Aa,Pa,Fa,Ma,Ba,Ua,za,Va,Ga,Ha,Ja,Wa,Ya,Ka,Xa,Za,eo,to,no,io,ro,{element:"body",fields:{acceptMediaTypes:Le("accept"),ack:Be("ack"),authId:Le("authid"),characterSets:Le("charsets"),condition:Le("condition"),from:yi("from"),key:Le("key"),lang:tt(),maxClientRequests:Be("requests"),maxHoldOpen:Be("hold"),maxInactivityTime:Be("inactivity"),maxSessionPause:Be("maxpause"),maxWaitTime:Be("wait"),mediaType:Le("content"),minPollingInterval:Be("polling"),newKey:Le("newkey"),pauseSession:Be("pause"),report:Be("report"),rid:Be("rid"),route:Le("string"),seeOtherURI:nt(null,"uri"),sid:Le("sid"),stream:Le("stream"),time:Be("time"),to:yi("to"),type:Le("type"),version:Le("ver"),xmppRestart:Qe("xmpp","urn:xmpp:xbosh","restart"),xmppRestartLogic:Qe("xmpp","urn:xmpp:xbosh","restartlogic"),xmppVersion:$e("xmpp","urn:xmpp:xbosh","version")},namespace:fn,path:"bosh"},[Si({headers:_t(mn,"headers","header",!0)}),xi({headers:_t(mn,"headers","header",!0)}),{element:"header",fields:{name:Le("name"),value:Ze()},namespace:mn,path:"header"}],[{element:"compression",fields:{methods:gt(null,"method")},namespace:"http://jabber.org/features/compress",path:"features.compression"},{element:"compress",fields:{method:nt(null,"method")},namespace:gn,path:"compression",type:"start",typeField:"type"},{aliases:["error.compressionError"],element:"failure",fields:{condition:ft(null,["unsupported-method","setup-failed","processing-failed"])},namespace:gn,path:"compression",type:"failure",typeField:"type"},{element:"compressed",namespace:gn,path:"compression",type:"success",typeField:"type"}],ao,[Si({rosterExchange:_t(yn,"x","rosterExchange",!0)}),ji({rosterExchange:_t(yn,"x","rosterExchange",!0)}),{element:"item",fields:{action:Le("action"),groups:gt(null,"group"),jid:yi("jid"),name:Le("name")},namespace:yn,path:"rosterExchange"}],xi({vcardAvatar:{importer(e){const t=_e(e,"vcard-temp:x:update","x");if(!t.length)return;const n=_e(t[0],"vcard-temp:x:update","photo");return!n.length||n[0].getText()},exporter(e,t){const n=Se(e,"vcard-temp:x:update","x");if(""===t)Se(n,"vcard-temp:x:update","photo");else{if(!0===t)return;if(t){Se(n,"vcard-temp:x:update","photo").children.push(t)}}}}}),[Si({captcha:_t("urn:xmpp:captcha","captcha","dataform")}),ji({captcha:_t("urn:xmpp:captcha","captcha","dataform")})],[Ti({jingleError:ft("urn:xmpp:jingle:errors:1",ys(rs))}),{element:"jingle",fields:{action:Le("action"),initiator:yi("initiator"),responder:yi("responder"),sid:Le("sid")},namespace:Sn,path:"iq.jingle"},{aliases:[{multiple:!0,path:"iq.jingle.contents"}],element:"content",fields:{creator:Le("creator"),disposition:Le("disposition","session"),name:Le("name"),senders:Le("senders","both")},namespace:Sn},{element:"reason",fields:{alternativeSession:nt(null,"alternative-session"),condition:ft(null,ys(ss)),text:nt(null,"text")},namespace:Sn,path:"iq.jingle.reason"}],[{aliases:["iq.jingle.contents.application"],childrenExportOrder:{codecs:4,encryption:5,headerExtensions:6,sourceGroups:8,sources:7,streams:9},element:"description",fields:{media:Le("media"),rtcpFeedback:Object.assign(Object.assign({},oo()),{exportOrder:3}),rtcpMux:Object.assign(Object.assign({},lt(null,"rtcp-mux")),{exportOrder:1}),rtcpReducedSize:Object.assign(Object.assign({},lt(null,"rtcp-reduced-size")),{exportOrder:2}),ssrc:Le("ssrc")},namespace:xn,optionalNamespaces:{rtcpf:Vn,rtph:Gn},type:xn},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.headerExtensions",selector:xn}],element:"rtp-hdrext",fields:{id:Be("id"),senders:Le("senders"),uri:Le("uri")},namespace:Gn},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.codecs",selector:xn},"rtpcodec"],element:"payload-type",fields:{channels:Be("channels"),clockRate:Be("clockrate"),id:Le("id"),maxptime:Be("maxptime"),name:Le("name"),parameters:kt(xn,"parameter","name","value"),ptime:Be("ptime"),rtcpFeedback:oo()},namespace:xn},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.sources",selector:xn}],element:"source",fields:{parameters:kt(ci,"parameter","name","value"),ssrc:Le("ssrc")},namespace:ci},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.sourceGroups",selector:xn}],element:"ssrc-group",fields:{semantics:Le("semantics"),sources:bt(null,"source","ssrc")},namespace:ci},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.streams",selector:xn}],element:"stream",fields:{id:Le("id"),track:Le("track")},namespace:"urn:xmpp:jingle:apps:rtp:msid:0"},{aliases:[{path:"iq.jingle.contents.application.encryption",selector:xn}],element:"encryption",fields:{required:De("required")},namespace:xn},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.encryption.sdes",selector:xn}],element:"crypto",fields:{cryptoSuite:Le("crypto-suite"),keyParameters:Le("key-params"),sessionParameters:Le("session-params"),tag:Be("tag")},namespace:xn},{aliases:[{path:"iq.jingle.contents.application.encryption.zrtp",selector:xn}],element:"zrtp-hash",fields:{value:et("hex"),version:Le("version")},namespace:xn},{element:"mute",fields:{creator:Le("creator"),name:Le("name")},namespace:jn,path:co,type:us},{element:"unmute",fields:{creator:Le("creator"),name:Le("name")},namespace:jn,path:co,type:ps},{element:"hold",namespace:jn,path:co,type:ds},{element:"unhold",namespace:jn,path:co,type:hs},{element:"active",namespace:jn,path:co,type:fs},{element:"ringing",namespace:jn,path:co,type:ms}],[Si({nick:nt(In,"nick")}),xi({nick:nt(In,"nick")}),{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"nick",fields:{nick:Ze()},namespace:In,type:In}],[...lo(di),...lo(En)],[{element:"transport",fields:{gatheringComplete:lt(null,"gathering-complete"),password:Le("pwd"),usernameFragment:Le("ufrag")},namespace:On,path:"iq.jingle.contents.transport",type:On,typeField:"transportType"},{aliases:[{multiple:!0,path:"iq.jingle.contents.transport.candidates",selector:On}],element:"candidate",fields:{component:Le("component"),foundation:Le("foundation"),generation:Le("generation"),id:Le("id"),ip:Le("ip"),port:Be("port"),type:Le("type")},namespace:On}],[{element:"request",namespace:Cn,path:"message.receipt",type:"request",typeField:"type"},{element:"received",fields:{id:Le("id")},namespace:Cn,path:"message.receipt",type:"received",typeField:"type"}],[{element:"invisible",fields:{probe:De("probe")},namespace:"urn:xmpp:invisible:0",path:"iq.visibility",type:"invisible",typeField:"type"},{element:"visible",namespace:"urn:xmpp:invisible:0",path:"iq.visibility",type:"visible"}],[Ti({blocked:lt("urn:xmpp:blocking:errors","blocked")}),{element:"blocklist",fields:{jids:bt(null,"item","jid")},namespace:"urn:xmpp:blocking",path:"iq.blockList",type:"list",typeField:"action"},{element:"block",fields:{jids:bt(null,"item","jid")},namespace:"urn:xmpp:blocking",path:"iq.blockList",type:"block",typeField:"action"},{element:"unblock",fields:{jids:bt(null,"item","jid")},namespace:"urn:xmpp:blocking",path:"iq.blockList",type:"unblock",typeField:"action"}],[ki({streamManagement:lt(Rn,"sm")}),{element:"a",fields:{handled:Be("h",0)},namespace:Rn,path:"sm",type:"ack",typeField:"type"},{element:"r",namespace:Rn,path:"sm",type:"request",typeField:"type"},{element:"enable",fields:{allowResumption:De("resume")},namespace:Rn,path:"sm",type:"enable",typeField:"type"},{element:"enabled",fields:{id:Le("id"),resume:De("resume")},namespace:Rn,path:"sm",type:"enabled",typeField:"type"},{element:"resume",fields:{handled:Be("h",0),previousSession:Le("previd")},namespace:Rn,path:"sm",type:"resume",typeField:"type"},{element:"resumed",fields:{handled:Be("h",0),previousSession:Le("previd")},namespace:Rn,path:"sm",type:"resumed",typeField:"type"},{element:"failed",fields:{handled:Be("h",0)},namespace:Rn,path:"sm",type:"failed",typeField:"type"}],ji({ping:lt(qn,"ping")}),{element:"time",fields:{tzo:ct(null,"tzo"),utc:rt(null,"utc")},namespace:Nn,path:"iq.time"},{aliases:["message.delay","presence.delay"],element:"delay",fields:{from:yi("from"),reason:Ze(),timestamp:ze("stamp")},namespace:An},[{aliases:["iq.externalServiceCredentials"],defaultType:"1",element:"credentials",fields:{expires:Xe(null,"service","expires"),host:Je(null,"service","host"),name:Je(null,"service","name"),password:Je(null,"service","password"),port:Ye(null,"service","port"),restricuted:We(null,"service","restricted"),transport:Je(null,"service","transport"),type:Je(null,"service","type"),username:Je(null,"service","username")},namespace:"urn:xmpp:extdisco:1",type:"1",typeField:"version"},{aliases:["iq.externalServices"],defaultType:"1",element:"services",fields:{type:Le("type")},namespace:"urn:xmpp:extdisco:1",type:"1",typeField:"version"},{aliases:[{path:"iq.externalServices.services",multiple:!0}],defaultType:"1",element:"service",fields:{expires:ze("expires"),host:Le("host"),name:Le("name"),password:Le("password"),port:Be("port"),restricuted:De("restricted"),transport:Le("transport"),type:Le("type"),username:Le("username")},namespace:"urn:xmpp:extdisco:1",type:"1",typeField:"version"}],[{element:"media",fields:{height:Be("height"),width:Be("width")},namespace:Pn,path:"dataform.fields.media"},{aliases:[{multiple:!0,path:"dataform.fields.media.sources"}],element:"uri",fields:{mediaType:Le("type"),uri:Ze()},namespace:Pn}],Si({requestingAttention:lt(Fn,"attention")}),{aliases:["iq.bits",{path:"message.bits",multiple:!0},{path:"presence.bits",multiple:!0},{path:"iq.jingle.bits",multiple:!0}],element:"data",fields:{cid:Le("cid"),data:et("base64"),maxAge:Be("max-age"),mediaType:Le("type")},namespace:Mn},[_i(Wn,"hash",[{path:"file.hashes",multiple:!0}]),_i(Wn,"hash-used",[{path:"file.hashesUsed",multiple:!0}]),_i("urn:xmpp:thumbs:1","thumbnail",[{path:"file.thumbnails",multiple:!0}]),{aliases:["file",{path:"iq.jingle.contents.application.file",selector:Dn},{path:"iq.jingle.info.file",selector:`{${Dn}}checksum`}],element:"file",fields:{date:rt(null,"date"),description:nt(null,"desc"),mediaType:nt(null,"media-type"),name:nt(null,"name"),size:st(null,"size")},namespace:Dn},{element:"range",fields:{length:Be("length"),offset:Be("offset",0)},namespace:Dn,path:"file.range"},{element:"description",namespace:Dn,path:"iq.jingle.contents.application",type:Dn,typeField:"applicationType"},{element:"received",fields:{creator:Le("creator"),name:Le("name")},namespace:Dn,path:"iq.jingle.info",type:`{${Dn}}received`,typeField:"infoType"},{element:"checksum",fields:{creator:Le("creator"),name:Le("name")},namespace:Dn,path:"iq.jingle.info",type:`{${Dn}}checksum`,typeField:"infoType"}],{element:"description",namespace:Bn,path:"iq.jingle.contents.application",type:Bn,typeField:"applicationType"},[{element:"transport",fields:{activated:Je(null,"activated","cid"),address:Le("dstaddr"),candidateError:lt(null,"candidate-error"),candidateUsed:Je(null,"candidate-used","cid"),mode:Le("mode","tcp"),proxyError:lt(null,"proxy-error"),sid:Le("sid")},namespace:zn,path:"iq.jingle.contents.transport",type:zn,typeField:"transportType"},{aliases:[{multiple:!0,path:"iq.jingle.contents.transport.candidates",selector:zn}],element:"candidate",fields:{cid:Le("cid"),host:Le("host"),jid:yi("jid"),port:Be("port"),priority:Be("priority"),type:Le("type"),uri:Le("uri")},namespace:zn}],{element:"transport",fields:{ack:{importer:(e,t)=>"message"!==Le("stanza","iq").importer(e,t),exporter(e,t,n){Le("stanza").exporter(e,t?"iq":"message",n)}},blockSize:Be("block-size"),sid:Le("sid")},namespace:$n,path:"iq.jingle.contents.transport",type:$n,typeField:"transportType"},[_i(Mn,"data",[{path:"iq.jingle.bits",multiple:!0}]),{element:"thumbnail",fields:{height:Be("height"),mediaType:Le("media-type"),uri:Le("uri"),width:Be("width")},namespace:"urn:xmpp:thumbs:1",path:"thumbnail"}],[_i(Hn,"forwarded",["message.carbon.forward"]),{element:"enable",namespace:Qn,path:"iq.carbons",type:"enable",typeField:"action"},{element:"disable",namespace:Qn,path:"iq.carbons",type:"disable",typeField:"action"},{element:"sent",namespace:Qn,path:"message.carbon",type:"sent",typeField:"type"},{element:"received",namespace:Qn,path:"message.carbon",type:"received",typeField:"type"}],[...Object.values(Vr).map(e=>_i(e,"message",["forward.message"])),...Object.values(Vr).map(e=>_i(e,"presence",["forward.presence"])),...Object.values(Vr).map(e=>_i(e,"iq",["forward.iq"])),_i(An,"delay",["forward.delay"]),{aliases:["message.forward"],element:"forwarded",namespace:Hn,path:"forward"}],[{defaultType:"2",element:"hash",fields:{algorithm:Le("algo"),value:et("base64"),version:St("2")},namespace:Wn,path:"hash",typeField:"version"},{element:"hash-used",fields:{algorithm:Le("algo"),version:St("2")},namespace:Wn,path:"hashUsed"},{element:"hash",fields:{algorithm:Le("algo"),value:et("hex"),version:St("1")},namespace:Jn,path:"hash",typeField:"version"}],[{element:"rtt",fields:{event:Le("event","edit"),id:Le("id"),seq:Be("seq")},namespace:Kn,path:"message.rtt"},{aliases:[{path:"message.rtt.actions",multiple:!0}],element:"t",fields:{position:Be("p"),text:Ze()},namespace:Kn,type:"insert",typeField:"type"},{aliases:[{path:"message.rtt.actions",multiple:!0}],element:"e",fields:{length:Be("n",1),position:Be("p")},namespace:Kn,type:"erase",typeField:"type"},{aliases:[{multiple:!0,path:"message.rtt.actions"}],element:"w",fields:{duration:Be("n",0)},namespace:Kn,type:"wait",typeField:"type"}],Si({replace:Je(Xn,"replace","id")}),[_i(Mt,"x",["iq.archive.form"]),_i(Hn,"forwarded",["message.archive.item"]),_i(Wt,"set",["iq.archive.paging"]),{defaultType:"query",element:"query",fields:{queryId:Le("queryid")},namespace:ei,path:"iq.archive",type:"query",typeField:"type"},{element:"fin",fields:{complete:De("complete"),stable:De("stable")},namespace:ei,path:"iq.archive",type:"result"},{element:"prefs",fields:{default:Le("default")},namespace:ei,path:"iq.archive",type:"preferences"},{element:"result",fields:{id:Le("id"),queryId:Le("queryid")},namespace:ei,path:"message.archive"}],[xi({hats:_t(ti,"hats","hat",!0)}),{element:"hat",fields:{id:Le("name"),name:Le("displayName")},namespace:ti,path:"hat"}],xi({idleSince:rt(ni,"since")}),{aliases:[{multiple:!0,path:"iq.jingle.contents.transport.fingerprints",selector:En},{multiple:!0,path:"iq.jingle.contents.transport.fingerprints",selector:di},{multiple:!0,path:"iq.jingle.contents.application.encryption.dtls",selector:xn}],element:"fingerprint",fields:{algorithm:Le("hash"),setup:Le("setup"),value:Ze()},namespace:ii},[{element:"markable",namespace:ri,path:uo,type:"markable",typeField:"type"},{element:"received",fields:{id:Le("id")},namespace:ri,path:uo,type:"received"},{element:"displayed",fields:{id:Le("id")},namespace:ri,path:uo,type:"displayed"},{element:"acknowledged",fields:{id:Le("id")},namespace:ri,path:uo,type:"acknowledged"}],Si({processingHints:{importer(e){const t={};let n=!1;for(const i of e.children)if("string"!=typeof i&&i.getNamespace()===si)switch(i.getName()){case"no-copy":t.noCopy=!0,n=!0;break;case"no-permanent-store":t.noPermanentStore=!0,n=!0;break;case"no-store":t.noStore=!0,n=!0;break;case"store":t.store=!0,n=!0}return n?t:void 0},exporter(e,t,n){t.noCopy&&e.appendChild(ye(si,"no-copy",n.namespace,e)),t.noPermanentStore&&e.appendChild(ye(si,"no-permanent-store",n.namespace,e)),t.noStore&&e.appendChild(ye(si,"no-store",n.namespace,e)),t.store&&e.appendChild(ye(si,"store",n.namespace,e))}}}),[Si({json:ot(ai,"json")}),{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"json",fields:{json:ot(ai,"json")},namespace:ai,type:ai}],[{aliases:[{path:"iq.jingle.groups",multiple:!0}],element:"group",fields:{contents:bt(null,"content","name"),semantics:Le("semantics")},namespace:oi}],{aliases:[{path:"iq.jingle.contents.transport.sctp",selector:En},{path:"iq.jingle.contents.transport.sctp",selector:di}],element:"sctpmap",fields:{port:Be("number"),protocol:Le("protocol"),streams:Le("streams")},namespace:li},[{element:"active",namespace:"urn:xmpp:csi:0",path:"csi",type:"active",typeField:"state"},{element:"inactive",namespace:"urn:xmpp:csi:0",path:"csi",type:"inactive",typeField:"state"}],[_i(Mt,"x",["iq.push.form","pushNotification.form"]),{element:"enable",fields:{jid:yi("jid"),node:Le("node")},namespace:ui,path:"iq.push",type:"enable",typeField:"action"},{element:"disable",fields:{jid:yi("jid"),node:Le("node")},namespace:ui,path:"iq.push",type:"disable",typeField:"action"},{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"notification",namespace:ui,path:"pushNotification",type:ui,typeField:"itemType"}],[Si({originId:Je("urn:xmpp:sid:0","origin-id","id")}),{aliases:[{path:"message.stanzaIds",multiple:!0}],element:"stanza-id",fields:{by:yi("by"),id:Le("id")},namespace:"urn:xmpp:sid:0"}],[Ti({httpUploadError:ft(pi,["file-too-large","retry"]),httpUploadMaxFileSize:dt([{namespace:pi,element:"file-too-large"},{namespace:pi,element:"max-file-size"}]),httpUploadRetry:Xe(pi,"retry","stamp")}),{element:"request",fields:{mediaType:Le("content-type"),name:Le("filename"),size:Be("size")},namespace:pi,path:"iq.httpUpload",type:"request",typeField:"type"},{element:"slot",fields:{download:Je(null,"get","url")},namespace:pi,path:"iq.httpUpload",type:"slot"},{aliases:[{path:"iq.httpUpload.upload",selector:"slot"}],element:"put",fields:{url:Le("url")},namespace:pi},{aliases:[{path:"iq.httpUpload.upload.headers",multiple:!0}],element:"header",fields:{name:Le("name"),value:Ze()},namespace:pi}],{element:"encryption",fields:{id:Le("namespace"),name:Le("name")},namespace:fi,path:"message.encryptionMethod"},[{aliases:["message.omemo"],element:"encrypted",fields:{payload:it(null,"payload","base64")},namespace:mi,path:"omemo"},{element:"header",fields:{iv:it(null,"iv","base64"),sid:Be("sid")},namespace:mi,path:"omemo.header"},{aliases:[{path:"omemo.header.keys",multiple:!0}],element:"key",fields:{preKey:De("prekey"),rid:Be("rid"),value:et("base64")},namespace:mi},{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"list",fields:{devices:yt(null,"device","id")},namespace:mi,type:"eu.siacs.conversations.axolotl.devicelist",typeField:"itemType"},{element:"preKeyPublic",fields:{id:Be("preKeyId"),value:et("base64")},namespace:mi,path:"omemoPreKey"},{element:"signedPreKeyPublic",fields:{id:Be("signedPreKeyId"),value:et("base64")},namespace:mi,path:"omemoDevice.signedPreKeyPublic"},{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"bundle",fields:{identityKey:it(null,"identityKey","base64"),preKeys:_t(null,"prekeys","omemoPreKey",!0),signedPreKeySignature:it(null,"signedPreKeySignature","base64")},namespace:mi,path:"omemoDevice",type:"eu.siacs.conversations.axolotl.bundles",typeField:"itemType"}],[{element:"XRD",fields:{subject:nt(null,"Subject")},namespace:gi,path:"xrd"},{aliases:[{path:"xrd.links",multiple:!0}],element:"Link",fields:{href:Le("href"),rel:Le("rel"),type:Le("type")},namespace:gi}]];var ho=Object.freeze({__proto__:null,default:po});const fo=Math.pow(2,32),mo=(e,t)=>(e%t+t)%t;class go{constructor(e){this.allowResume=!0,this.lastAck=0,this.handled=0,this.windowSize=1,this.unacked=[],this.pendingAck=!1,this.inboundStarted=!1,this.outboundStarted=!1,this.client=e,this.id=void 0,this.allowResume=!0,this.started=!1,this.cacheHandler=()=>null,this._reset()}get started(){return this.outboundStarted&&this.inboundStarted}set started(e){e||(this.outboundStarted=!1,this.inboundStarted=!1)}load(e){this.id=e.id,this.allowResume=!0,this.handled=e.handled,this.lastAck=e.lastAck,this.unacked=e.unacked,e.jid&&(this.client.jid=e.jid,this.client.emit("session:bound",e.jid))}cache(e){this.cacheHandler=e}enable(){this.client.send("sm",{allowResumption:this.allowResume,type:"enable"}),this.handled=0,this.pendingAck=!1,this.outboundStarted=!0}resume(){this.client.send("sm",{handled:this.handled,previousSession:this.id,type:"resume"}),this.pendingAck=!1,this.outboundStarted=!0}enabled(e){this.id=e.id,this.handled=0,this.inboundStarted=!0,this._cache()}resumed(e){this.id=e.previousSession,void 0!==e.handled&&this.process(e,!0),this.inboundStarted=!0,this._cache()}failed(e){void 0!==e.handled&&this.process(e);for(const[e,t]of this.unacked)this.client.emit("stanza:failed",{kind:e,stanza:t});this._reset(),this._cache()}ack(){this.client.send("sm",{handled:this.handled,type:"ack"})}request(){this.pendingAck=!0,this.client.send("sm",{type:"request"})}process(e,t=!1){if(void 0===e.handled)return;const n=mo(e.handled-this.lastAck,fo);this.pendingAck=!1;for(let e=0;e<n&&this.unacked.length>0;e++){const[e,t]=this.unacked.shift();this.client.emit("stanza:acked",{kind:e,stanza:t})}if(this.lastAck=e.handled,t){const e=this.unacked;this.unacked=[];for(const[t,n]of e)this.client.send(t,n)}this._cache(),this.needAck()&&this.request()}track(e,t){"message"!==e&&"presence"!==e&&"iq"!==e||this.outboundStarted&&(this.unacked.push([e,t]),this._cache(),this.needAck()&&this.request())}handle(){this.inboundStarted&&(this.handled=mo(this.handled+1,fo),this._cache())}needAck(){return!this.pendingAck&&this.unacked.length>=this.windowSize}_cache(){this.cacheHandler({handled:this.handled,id:this.id,jid:this.client.jid,lastAck:this.lastAck,unacked:this.unacked})}_reset(){this.inboundStarted=!1,this.outboundStarted=!1,this.lastAck=0,this.handled=0,this.unacked=[],this.pendingAck=!1}}class bo{constructor(e,t,n){this.maxRequests=2,this.maxHoldOpen=1,this.minPollingInterval=5,this.client=e,this.sm=t,this.stanzas=n,this.sendBuffer=[],this.requests=new Set,this.authenticated=!1,this.lastResponseTime=Date.now(),this.pollingInterval=setInterval(()=>{this.authenticated&&0===this.requests.size&&0===this.sendBuffer.length&&Date.now()-this.lastResponseTime>=1e3*this.minPollingInterval&&this.longPoll()},1e3)}connect(e){if(this.config=Object.assign({maxRetries:5,rid:Math.ceil(9999999999*Math.random()),wait:30},e),this.hasStream=!1,this.sm.started=!1,this.url=this.config.url,this.sid=this.config.sid,this.rid=this.config.rid,this.requests.clear(),this.sid)return this.hasStream=!0,this.stream={},this.client.emit("connected"),this.client.emit("session:prebind",this.config.jid),void this.client.emit("session:started");this.rid++,this.request({lang:this.config.lang,maxHoldOpen:1,maxWaitTime:this.config.wait,to:this.config.server,version:"1.6",xmppVersion:"1.0"})}disconnect(){clearInterval(this.pollingInterval),this.hasStream?(this.rid++,this.request({type:"terminate"})):(this.stream=void 0,this.sid=void 0,this.rid=void 0,this.client.emit("disconnected",void 0))}restart(){this.hasStream=!1,this.rid++,this.request({lang:this.config.lang,to:this.config.server,xmppRestart:!0})}send(e,t){if(t){const n=this.stanzas.export(e,t);n&&this.sendBuffer.push(n.toString())}else this.sendBuffer.push(e);this.longPoll()}longPoll(){const e=!this.maxRequests||this.requests.size<this.maxRequests,t=!this.maxRequests||this.sendBuffer.length>0&&this.requests.size<this.maxRequests;if(!this.sid||!e&&!t)return;const n=this.sendBuffer;this.sendBuffer=[],this.rid++,this.request({},n)}request(t,n=[]){return Object(r.a)(this,void 0,void 0,(function*(){const i=this.rid;this.requests.add(i),t.rid=this.rid,t.sid=this.sid;const s=this.stanzas.export("bosh",t),a=[s.openTag(),...n,s.closeTag()].join("");this.client.emit("raw","outgoing",a);try{const n=yield function(e,t,n,i=5){return Object(r.a)(this,void 0,void 0,(function*(){let r=0;for(;r<=i;){try{const i=yield Rr(pr(e,t),1e3*n,()=>new Error("Request timed out"));if(!i.ok)throw new Error("HTTP Status Error: "+i.status);return i.text()}catch(e){if((r+=1)>i)throw e}yield qr(1e3*Math.pow(r,2))}throw new Error("Request failed")}))}(this.url,{body:a,headers:{"Content-Type":"text/xml"},method:"POST"},1.1*this.config.wait,this.config.maxRetries);if(this.requests.delete(i),this.lastResponseTime=Date.now(),n){const t=e.from(n,"utf8").toString().trim();if(""===t)return;this.client.emit("raw","incoming",t);const i=new Ei({acceptLanguages:this.config.acceptLanguages,allowComments:!1,lang:this.config.lang,registry:this.stanzas,rootKey:"bosh",wrappedStream:!0});i.on("error",e=>{const t={condition:Hr.InvalidXML};return this.client.emit("stream:error",t,e),this.send("error",t),this.disconnect()}),i.on("data",e=>{if("stream-start"===e.event)return"terminate"===e.stanza.type?(this.hasStream=!1,this.rid=void 0,this.sid=void 0,this.client.emit("bosh:terminate",e.stanza),this.client.emit("stream:end"),void this.client.emit("disconnected",void 0)):void(this.hasStream||(this.hasStream=!0,this.stream=e.stanza,this.sid=e.stanza.sid||this.sid,this.maxHoldOpen=e.stanza.maxHoldOpen||this.maxHoldOpen,this.maxRequests=e.stanza.maxRequests||this.maxRequests,this.minPollingInterval=e.stanza.minPollingInterval||this.minPollingInterval,this.client.emit("stream:start",e.stanza)));e.event||this.client.emit("stream:data",e.stanza,e.kind)}),i.write(t)}"terminate"===t.type&&(this.closing=!0),this.hasStream&&!this.closing&&!this.requests.size&&this.authenticated&&(clearTimeout(this.idleTimeout),this.idleTimeout=setTimeout(()=>{this.longPoll()},100))}catch(e){this.hasStream=!1,this.client.emit("stream:error",{condition:"connection-timeout"},e),this.disconnect()}}))}}const yo=1;class vo{constructor(t,n,i){this.sm=n,this.stanzas=i,this.closing=!1,this.client=t,this.sendQueue=Object(u.a)((t,n)=>{this.conn&&(t=e.from(t,"utf8").toString(),this.client.emit("raw","outgoing",t),this.conn.readyState===yo&&this.conn.send(t)),n()},1)}connect(t){this.config=t,this.hasStream=!1,this.closing=!1,this.parser=new Ei({acceptLanguages:this.config.acceptLanguages,allowComments:!1,lang:this.config.lang,registry:this.stanzas,wrappedStream:!1}),this.parser.on("data",e=>{const t=e.kind,n=e.stanza;if("stream"===t){if("open"===n.action)return this.hasStream=!0,this.stream=n,this.client.emit("stream:start",n);if("close"===n.action)return this.client.emit("stream:end"),this.disconnect()}this.client.emit("stream:data",n,t)}),this.parser.on("error",e=>{const t={condition:Hr.InvalidXML};return this.client.emit("stream:error",t,e),this.send(this.stanzas.export("error",t).toString()),this.disconnect()}),this.conn=new dr(t.url,"xmpp"),this.conn.onerror=e=>{e.preventDefault&&e.preventDefault(),console.error(e)},this.conn.onclose=e=>{this.client.emit("disconnected",e)},this.conn.onopen=()=>{this.sm.started=!1,this.client.emit("connected"),this.send(this.startHeader())},this.conn.onmessage=t=>{const n=e.from(t.data,"utf8").toString();this.client.emit("raw","incoming",n),this.parser&&this.parser.write(n)}}disconnect(){this.conn&&!this.closing&&this.hasStream?(this.closing=!0,this.send(this.closeHeader())):(this.hasStream=!1,this.stream=void 0,this.conn&&this.conn.readyState===yo&&this.conn.close(),this.conn=void 0)}send(e,t){if(t){const n=this.stanzas.export(e,t);n&&this.sendQueue.push(n.toString(),0)}else this.sendQueue.push(e,0)}restart(){this.hasStream=!1,this.send(this.startHeader())}startHeader(){return this.stanzas.export("stream",{action:"open",lang:this.config.lang,to:this.config.server,version:"1.0"}).toString()}closeHeader(){return this.stanzas.export("stream",{action:"close"}).toString()}}class wo extends s.EventEmitter{constructor(e={}){super(),this.setMaxListeners(100),this.off=this.removeListener,this._initConfig(e),this.jid="",this.sasl=new fr,this.sasl.register("EXTERNAL",wr,1e3),this.sasl.register("SCRAM-SHA-256-PLUS",jr,350),this.sasl.register("SCRAM-SHA-256",jr,300),this.sasl.register("SCRAM-SHA-1-PLUS",jr,250),this.sasl.register("SCRAM-SHA-1",jr,200),this.sasl.register("DIGEST-MD5",xr,100),this.sasl.register("X-OAUTH2",Sr,100),this.sasl.register("PLAIN",_r,1),this.sasl.register("ANONYMOUS",vr,0),this.stanzas=new It,this.stanzas.define(po),this.use(fa),this.sm=new go(this),this.transports={bosh:bo,websocket:vo},this.on("stream:data",(e,t)=>{if(this.emit(t,e),"message"===t||"presence"===t||"iq"===t)this.sm.handle(),this.emit("stanza",e);else if("sm"===t)return"ack"===e.type&&(this.emit("stream:management:ack",e),this.sm.process(e)),void("request"===e.type&&this.sm.ack());e.id&&this.emit(t+":id:"+e.id,e)}),this.on("disconnected",()=>{this.transport&&delete this.transport}),this.on("auth:success",()=>{this.transport&&(this.transport.authenticated=!0)}),this.on("iq",e=>{const t=e.type,n=e.payloadType,i="iq:"+t+":"+n;if("get"===t||"set"===t){if("invalid-payload-count"===n)return this.sendIQError(e,{error:{condition:"bad-request",type:"modify"}});if("unknown-payload"===n||0===this.listenerCount(i))return this.sendIQError(e,{error:{condition:"service-unavailable",type:"cancel"}});this.emit(i,e)}}),this.on("message",e=>{const t=e.alternateLanguageBodies&&e.alternateLanguageBodies.length||e.links&&e.links.length,n=e.marker&&"markable"!==e.marker.type;t&&!n&&("chat"===e.type||"normal"===e.type?this.emit("chat",e):"groupchat"===e.type&&this.emit("groupchat",e)),"error"===e.type&&this.emit("message:error",e)}),this.on("presence",e=>{let t=e.type||"available";"error"===t&&(t="presence:error"),this.emit(t,e)})}get stream(){return this.transport?this.transport.stream:void 0}emit(e,...t){const n=super.emit(e,...t);return"raw"===e?(super.emit(`raw:${t[0]}`,t[1]),super.emit("raw:*",`raw:${t[0]}`,t[1]),super.emit("*",`raw:${t[0]}`,t[1])):super.emit("*",e,...t),n}use(e){"function"==typeof e&&e(this,this.stanzas,this.config)}nextId(){return Ar()}getCredentials(){return Object(r.a)(this,void 0,void 0,(function*(){return this._getConfiguredCredentials()}))}connect(){return Object(r.a)(this,void 0,void 0,(function*(){const e=["websocket","bosh"];let t;for(const n of e){let e=this.config.transports[n];if(e){if("string"==typeof e)e={url:e};else if(!0===e){if(!t)try{t=yield this.discoverBindings(this.config.server)}catch(e){console.error(e);continue}if(t[n]=(t[n]||[]).filter(e=>e.startsWith("wss:")||e.startsWith("https:")),!t[n]||!t[n].length)continue;e={url:t[n][0]}}return this.transport=new this.transports[n](this,this.sm,this.stanzas),void this.transport.connect(Object.assign({acceptLanguages:this.config.acceptLanguages||["en"],jid:this.config.jid,lang:this.config.lang||"en",server:this.config.server,url:e.url},e))}}return console.error("No endpoints found for the requested transports."),this.disconnect()}))}disconnect(){this.sessionStarted&&!this.sm.started&&this.emit("session:end"),this.sessionStarted=!1,this.transport?this.transport.disconnect():this.emit("disconnected")}send(e,t){this.sm.track(e,t),this.transport&&this.transport.send(e,t)}sendMessage(e){const t=e.id||this.nextId(),n=Object.assign({id:t,originId:t},e);return this.emit("message:sent",n,!1),this.send("message",n),n.id}sendPresence(e={}){const t=Object.assign({id:this.nextId()},e);return this.send("presence",t),t.id}sendIQ(e){const t=Object.assign({id:this.nextId()},e),n=M(this.jid,e.to),i="iq:id:"+t.id,r=new Promise((e,t)=>{const r=s=>{n.has(s.from)&&("result"!==s.type&&"error"!==s.type||(this.off(i,r),"result"===s.type?e(s):t(s)))};this.on(i,r)});return this.send("iq",t),Rr(r,1e3*(this.config.timeout||15),()=>({error:{condition:"timeout"},id:t.id,type:"error"}))}sendIQResult(e,t){this.send("iq",Object.assign(Object.assign({},t),{id:e.id,to:e.from,type:"result"}))}sendIQError(e,t){this.send("iq",Object.assign(Object.assign({},t),{id:e.id,to:e.from,type:"error"}))}sendStreamError(e){this.emit("stream:error",e),this.send("error",e),this.disconnect()}_getConfiguredCredentials(){const e=this.config.credentials||{},t=F(this.config.jid||""),n=e.username||t.local,i=e.host||t.domain;return Object.assign({host:i,password:this.config.password,realm:i,serviceName:i,serviceType:"xmpp",username:n},e)}_initConfig(e={}){const t=this.config||{};this.config=Object.assign(Object.assign({jid:"",transports:{bosh:!0,websocket:!0},useStreamManagement:!0},t),e),this.config.server||(this.config.server=B(this.config.jid)),this.config.password&&(this.config.credentials=this.config.credentials||{},this.config.credentials.password=this.config.password,delete this.config.password)}}function _o(e,t){const n=e.length,i=t.length,r=Math.min(n,i);let s=0;for(s=0;s<r&&e[s]===t[s];s++);let a=0;for(a=0;a<r-s&&e[n-a-1]===t[i-a-1];a++);const c=s+a,l=[];if(c<n&&l.push({length:n-c,position:n-a,type:"erase"}),c<i){const e=t.slice(s,s+i-c);l.push({position:s,text:o.a.ucs2.encode(e),type:"insert"})}return l}var So=Object.freeze({__proto__:null,diff:_o,DisplayBuffer:class{constructor(e,t=!1){this.synced=!1,this.cursorPosition=0,this.sequenceNumber=0,this.ignoreWaits=!1,this.onStateChange=e||function(){},this.ignoreWaits=t,this.buffer=[],this.resetActionQueue()}get text(){return o.a.ucs2.encode(this.buffer.slice())}commit(){this.resetActionQueue()}process(e){if("cancel"===e.event||"init"===e.event?this.resetActionQueue():"reset"===e.event||"new"===e.event?(this.resetActionQueue(),e.seq&&(this.sequenceNumber=e.seq)):e.seq!==this.sequenceNumber&&(this.synced=!1),e.actions){const t=Date.now();let n=0;for(const i of e.actions)i.baseTime=t+n,"wait"===i.type&&(n+=i.duration),this.actionQueue.push(i,0)}this.sequenceNumber=this.sequenceNumber+1}insert(e="",t=this.buffer.length){e.normalize&&(e=e.normalize("NFC"));const n=o.a.ucs2.decode(e);this.buffer.splice(t,0,...n),this.cursorPosition=t+n.length,this.emitState()}erase(e=1,t=this.buffer.length){t=Math.max(Math.min(t,this.buffer.length),0),e=Math.max(Math.min(e,this.text.length),0),this.buffer.splice(Math.max(t-e,0),e),this.cursorPosition=Math.max(t-e,0),this.emitState()}emitState(e={}){this.onStateChange(Object.assign({cursorPosition:this.cursorPosition,synced:this.synced,text:this.text},e))}resetActionQueue(){this.actionQueue&&this.actionQueue.kill(),this.sequenceNumber=0,this.synced=!0,this.buffer=[],this.emitState(),this.actionQueue=Object(u.a)((e,t)=>{const n=Date.now();return"insert"===e.type?(this.insert(e.text,e.position),t()):"erase"===e.type?(this.erase(e.length,e.position),t()):"wait"!==e.type?t():this.ignoreWaits?t():(e.duration>700&&(e.duration=700),n>=e.baseTime+e.duration?t():void setTimeout(()=>t(),e.duration))},1)}},InputBuffer:class{constructor(e,t=!1){this.resetInterval=1e4,this.ignoreWaits=!1,this.isStarting=!1,this.isReset=!1,this.changedBetweenResets=!1,this.onStateChange=e||function(){},this.ignoreWaits=t,this.buffer=[],this.actionQueue=[],this.sequenceNumber=0}get text(){return o.a.ucs2.encode(this.buffer.slice())}update(e){let t=[];if(void 0!==e){e.normalize&&(e=e.normalize("NFC"));const n=o.a.ucs2.decode(e||"");t=_o(this.buffer,n.slice()),this.buffer=n,this.emitState()}const n=Date.now();if(this.changedBetweenResets&&n-this.lastResetTime>this.resetInterval)this.actionQueue=[],this.actionQueue.push({position:0,text:this.text,type:"insert"}),this.isReset=!0,this.lastActionTime=n,this.lastResetTime=n,this.changedBetweenResets=!1;else if(t.length){const e=n-(this.lastActionTime||n);e>0&&!this.ignoreWaits&&this.actionQueue.push({duration:e,type:"wait"});for(const e of t)this.actionQueue.push(e);this.lastActionTime=n,this.changedBetweenResets=!0}}start(e=this.resetInterval){return this.commit(),this.isStarting=!0,this.resetInterval=e,this.sequenceNumber=Math.floor(1e4*Math.random()+1),{event:"init"}}stop(){return this.commit(),{event:"cancel"}}diff(){if(this.update(),!this.actionQueue.length)return null;const e={actions:this.actionQueue,seq:this.sequenceNumber++};return this.isStarting?(e.event="new",this.isStarting=!1,this.lastResetTime=Date.now()):this.isReset&&(e.event="reset",this.isReset=!1),this.actionQueue=[],e}commit(){this.sequenceNumber=0,this.lastActionTime=0,this.actionQueue=[],this.buffer=[]}emitState(){this.onStateChange({text:this.text})}}});const xo=Qr;function jo(e){const t=new wo(e);return t.use(ma),t}}.call(this,n(8).Buffer,n(3))},function(e,t,n){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,i=l(e),a=i[0],o=i[1],c=new s(function(e,t,n){return 3*(t+n)/4-n}(0,a,o)),u=0,p=o>0?a-4:a;for(n=0;n<p;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;2===o&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[u++]=255&t);1===o&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,s=[],a=0,o=n-r;a<o;a+=16383)s.push(u(e,a,a+16383>o?o:a+16383));1===r?(t=e[n-1],s.push(i[t>>2]+i[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],s.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"="));return s.join("")};for(var i=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,c=a.length;o<c;++o)i[o]=a[o],r[a.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,n){for(var r,s,a=[],o=t;o<n;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(i[(s=r)>>18&63]+i[s>>12&63]+i[s>>6&63]+i[63&s]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,i,r){var s,a,o=8*r-i-1,c=(1<<o)-1,l=c>>1,u=-7,p=n?r-1:0,d=n?-1:1,h=e[t+p];for(p+=d,s=h&(1<<-u)-1,h>>=-u,u+=o;u>0;s=256*s+e[t+p],p+=d,u-=8);for(a=s&(1<<-u)-1,s>>=-u,u+=i;u>0;a=256*a+e[t+p],p+=d,u-=8);if(0===s)s=1-l;else{if(s===c)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,i),s-=l}return(h?-1:1)*a*Math.pow(2,s-i)},t.write=function(e,t,n,i,r,s){var a,o,c,l=8*s-r-1,u=(1<<l)-1,p=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=i?0:s-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+p>=1?d/c:d*Math.pow(2,1-p))*c>=2&&(a++,c/=2),a+p>=u?(o=0,a=u):a+p>=1?(o=(t*c-1)*Math.pow(2,r),a+=p):(o=t*Math.pow(2,p-1)*Math.pow(2,r),a=0));r>=8;e[n+h]=255&o,h+=f,o/=256,r-=8);for(a=a<<r|o,l+=r;l>0;e[n+h]=255&a,h+=f,a/=256,l-=8);e[n+h-f]|=128*m}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){},function(e,t,n){"use strict";var i=n(13).Buffer,r=n(27);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t,n,r,s=i.allocUnsafe(e>>>0),a=this.head,o=0;a;)t=a.data,n=s,r=o,t.copy(n,r),o+=a.data.length,a=a.next;return s},e}(),r&&r.inspect&&r.inspect.custom&&(e.exports.prototype[r.inspect.custom]=function(){var e=r.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function s(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new s(r.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new s(r.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(29),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(3))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var i,r,s,a,o,c=1,l={},u=!1,p=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick((function(){f(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((s=new MessageChannel).port1.onmessage=function(e){f(e.data)},i=function(e){s.port2.postMessage(e)}):p&&"onreadystatechange"in p.createElement("script")?(r=p.documentElement,i=function(e){var t=p.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):i=function(e){setTimeout(f,0,e)}:(a="setImmediate$"+Math.random()+"$",o=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&f(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),i=function(t){e.postMessage(a+t,"*")}),d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return l[c]=r,i(c),c++},d.clearImmediate=h}function h(e){delete l[e]}function f(e){if(u)setTimeout(f,0,e);else{var t=l[e];if(t){u=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}(t)}finally{h(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(3),n(9))},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var i=!1;return function(){if(!i){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),i=!0}return e.apply(this,arguments)}}}).call(this,n(3))},function(e,t,n){var i=n(8),r=i.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(s(i,t),t.Buffer=a),s(r,a),a.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},function(e,t,n){"use strict";e.exports=s;var i=n(20),r=n(6);function s(e){if(!(this instanceof s))return new s(e);i.call(this,e)}r.inherits=n(7),r.inherits(s,i),s.prototype._transform=function(e,t,n){n(null,e)}}]);